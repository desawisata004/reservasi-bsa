<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reservasi Kemah Keluarga - Bukit Sampalan Asri</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #4caf50;
            --accent-color: #ff9800;
            --light-color: #f1f8e9;
            --dark-color: #1b5e20;
            --danger-color: #f44336;
            --warning-color: #ffc107;
            --success-color: #4caf50;
            --gray-color: #757575;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles - Mobile Friendly */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        
        .header-content h1 {
            font-size: 1.3rem;
            margin-bottom: 3px;
            line-height: 1.2;
        }
        
        .header-content p {
            opacity: 0.9;
            font-size: 0.75rem;
            display: none;
        }
        
        .auth-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }
        
        .auth-container span {
            margin-right: 8px;
            font-size: 0.85rem;
        }
        
        .logout-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 36px;
            min-width: 36px;
        }
        
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 8px;
            margin-left: 10px;
            min-height: 36px;
            min-width: 36px;
        }
        
        nav {
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            flex-wrap: wrap;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        nav a:hover, nav a.active {
            background-color: var(--dark-color);
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            margin: 15px 0;
            gap: 15px;
        }
        
        .content-section {
            flex: 1;
            min-width: 280px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .card {
            background-color: white;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
        }
        
        .card-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .card-value {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .card-label {
            color: var(--gray-color);
            font-size: 0.8rem;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px !important;
            transition: border 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 150px;
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            min-height: 44px;
            min-width: 44px;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-color);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-sm {
            padding: 6px 10px;
            font-size: 0.8rem;
            min-height: 36px;
        }
        
        /* Table Styles - IMPROVED FOR MOBILE */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            margin-bottom: 1rem;
            scrollbar-width: thin;
        }
        
        .table-responsive::-webkit-scrollbar {
            height: 6px;
        }
        
        .table-responsive::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            min-width: 600px;
        }
        
        .table th, .table td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
            vertical-align: middle;
        }
        
        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            font-weight: 600;
            white-space: nowrap;
        }
        
        .table tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Lapak Visualization */
        .lapak-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
            gap: 6px;
            margin-top: 15px;
        }
        
        .lapak-item {
            height: 55px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-size: 0.85rem;
            min-height: 44px;
            min-width: 44px;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .lapak-item:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .lapak-item .lapak-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            display: none;
            z-index: 10;
        }
        
        .lapak-item:hover .lapak-tooltip {
            display: block;
        }
        
        .lapak-tersedia {
            background-color: var(--success-color);
        }
        
        .lapak-terpakai {
            background-color: var(--danger-color);
        }
        
        .lapak-dipilih {
            background-color: var(--warning-color);
            transform: scale(1.03);
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
        }
        
        .lapak-item:hover {
            transform: scale(1.03);
        }
        
        /* Invoice Styles */
        .invoice {
            border: 2px solid var(--light-color);
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 12px;
        }
        
        .invoice-details {
            margin-bottom: 15px;
        }
        
        .invoice-items {
            margin-bottom: 15px;
        }
        
        .invoice-total {
            text-align: right;
            font-size: 1rem;
            font-weight: bold;
            border-top: 2px solid var(--light-color);
            padding-top: 12px;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 15px 0;
            margin-top: 25px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .footer-section {
            margin-bottom: 15px;
        }
        
        .footer-section h3 {
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* Tabs Styles - IMPROVED FOR MOBILE */
        .tabs-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.85rem;
            flex-shrink: 0;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tab:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Visualisasi Grid */
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        
        .grid-item {
            height: 40px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.7rem;
        }
        
        /* Responsive Styles */
        @media (max-width: 992px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .visualization-grid {
                grid-template-columns: repeat(8, 1fr);
            }
            
            .footer-content {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .menu-toggle {
                display: flex;
            }
            
            .header-content p {
                display: block;
            }
            
            nav ul {
                flex-direction: column;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
                gap: 3px;
                margin-top: 8px;
            }
            
            nav ul.active {
                max-height: 500px;
            }
            
            nav a {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .main-content {
                flex-direction: column;
                gap: 12px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-row .form-group {
                min-width: 100%;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lapak-container {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
            
            .lapak-item {
                height: 50px;
                font-size: 0.8rem;
            }
            
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .visualization-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .grid-item {
                height: 35px;
                font-size: 0.65rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .table {
                min-width: 650px;
            }
            
            .table th, .table td {
                padding: 8px 6px;
                font-size: 0.82rem;
            }
            
            .content-section {
                padding: 12px;
            }
            
            .btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
        }
        
        @media (max-width: 576px) {
            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .logo-container {
                width: 100%;
                justify-content: space-between;
                margin-bottom: 10px;
            }
            
            .menu-toggle {
                display: flex;
                order: 1;
            }
            
            .header-content h1 {
                font-size: 1.1rem;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            .auth-container {
                margin-left: 0;
                width: 100%;
                justify-content: space-between;
            }
            
            .logout-btn {
                padding: 5px 8px;
                font-size: 0.8rem;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .card {
                padding: 10px;
            }
            
            .card-value {
                font-size: 1.2rem;
            }
            
            .lapak-container {
                grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            }
            
            .lapak-item {
                height: 45px;
                font-size: 0.75rem;
            }
            
            .tab {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .visualization-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .grid-item {
                height: 30px;
                font-size: 0.6rem;
            }
            
            .table th, .table td {
                padding: 6px 4px;
                font-size: 0.78rem;
            }
            
            .section-title {
                font-size: 1rem;
                flex-wrap: wrap;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 0.82rem;
            }
            
            .form-control {
                padding: 8px 10px;
            }
        }
        
        @media (max-width: 360px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .lapak-container {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
            
            .lapak-item {
                height: 40px;
                font-size: 0.7rem;
            }
            
            .tab {
                padding: 6px 8px;
                font-size: 0.75rem;
            }
            
            .visualization-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .grid-item {
                height: 25px;
                font-size: 0.55rem;
            }
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-2 {
            margin-bottom: 10px;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        .mb-4 {
            margin-bottom: 20px;
        }
        
        .mt-2 {
            margin-top: 10px;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .mt-4 {
            margin-top: 20px;
        }
        
        .ml-2 {
            margin-left: 10px;
        }
        
        .ml-3 {
            margin-left: 15px;
        }
        
        .alert {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 12px;
            font-size: 0.85rem;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning-color);
            color: #333;
        }
        
        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .badge-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-tersedia {
            background-color: var(--success-color);
        }
        
        .status-terpakai {
            background-color: var(--danger-color);
        }
        
        .status-dipilih {
            background-color: var(--warning-color);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--gray-color);
            padding: 5px;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Login Styles */
        .login-container {
            max-width: 350px;
            margin: 60px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .login-logo i {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .login-logo h2 {
            color: var(--primary-color);
            font-size: 1.3rem;
        }
        
        /* Glamping Selection */
        .glamping-option {
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .glamping-option:hover {
            border-color: var(--primary-color);
        }
        
        .glamping-option.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .glamping-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Checkbox Selection */
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .checkbox-container input {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }
        
        /* Payment Method Styles */
        .payment-option {
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-option:hover {
            border-color: var(--primary-color);
        }
        
        .payment-option.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .payment-icon {
            font-size: 1.1rem;
            margin-right: 6px;
            color: var(--primary-color);
        }
        
        /* User Role Badges */
        .badge-admin {
            background-color: #9c27b0;
            color: white;
        }
        
        .badge-manager {
            background-color: #2196f3;
            color: white;
        }
        
        .badge-staff {
            background-color: #ff9800;
            color: white;
        }
        
        /* Access Control */
        .access-control {
            margin-bottom: 12px;
            padding: 8px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        
        .access-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .access-item:last-child {
            border-bottom: none;
        }
        
        /* Bank Info Styles */
        .bank-info {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 12px;
            border-radius: 5px;
            margin: 12px 0;
        }
        
        .bank-info h5 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        /* Touch Friendly */
        button, 
        input[type="button"], 
        input[type="submit"], 
        .btn,
        .tab,
        .lapak-item {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Prevent text selection on interactive elements */
        .btn, .tab, .lapak-item {
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* Mobile optimization for forms */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Better touch feedback */
        .btn:active, .tab:active, .lapak-item:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        /* Akomodasi Lainnya Styles */
        .akomodasi-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .akomodasi-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            background-color: white;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .akomodasi-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .akomodasi-item.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .akomodasi-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .akomodasi-item h5 {
            margin-bottom: 6px;
            color: var(--dark-color);
            font-size: 0.9rem;
        }
        
        .akomodasi-price {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        /* Akomodasi Checkbox */
        .akomodasi-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .akomodasi-checkbox input {
            margin-right: 6px;
        }
        
        /* Style untuk form edit invoice */
        #invoice-edit-form {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
            margin-top: 15px;
        }

        /* Style untuk preview hapus */
        #preview-hapus-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 12px;
            background-color: #fff;
            margin-top: 15px;
        }

        #preview-hapus-container table {
            margin-bottom: 0;
        }

        #preview-hapus-container .table th {
            background-color: #f1f8e9;
        }
        
        /* Edit invoice form improvements */
        #edit-diskon-nilai:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        
        .diskon-info-box {
            padding: 8px;
            background-color: #e8f5e9;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 0.85rem;
        }
        
        /* Mobile optimizations for pengaturan tabs */
        .pengaturan-tab-content {
            padding: 10px 0;
        }
        
        /* Scroll to top button for mobile */
        .scroll-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 99;
            display: none;
        }
        
        .scroll-top:hover {
            background-color: var(--dark-color);
        }
        
        /* Input group for mobile */
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        
        /* Fix for select dropdown on iOS */
        select.form-control {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            padding-right: 35px;
        }
        
        /* Mobile menu animation */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        nav ul.active {
            animation: slideDown 0.3s ease forwards;
        }
        
        /* Firebase Connection Status */
        .firebase-status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .firebase-online {
            background-color: var(--success-color);
            color: white;
        }
        
        .firebase-offline {
            background-color: var(--danger-color);
            color: white;
        }
        
        .firebase-syncing {
            background-color: var(--warning-color);
            color: #333;
        }
    </style>
</head>
<body>
    <!-- Firebase Connection Status -->
    <div id="firebase-status" class="firebase-status firebase-online hidden">
        <i class="fas fa-wifi"></i>
        <span>Online</span>
    </div>
    
    <!-- Scroll to top button -->
    <div class="scroll-top" onclick="scrollToTop()">
        <i class="fas fa-chevron-up"></i>
    </div>
    
    <div id="login-screen" class="login-container" style="display: block;">
        <div class="login-logo">
            <i class="fas fa-campground"></i>
            <h2>Bukit Sampalan Asri</h2>
            <p>Sistem Reservasi Kemah Keluarga</p>
        </div>
        
        <form id="login-form">
            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> Username</label>
                <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
            </div>
            
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> Password</label>
                <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
            </div>
            
            <div class="alert alert-danger hidden" id="login-error">
                <i class="fas fa-exclamation-circle"></i> Username atau password salah!
            </div>
            
            <button type="button" class="btn btn-primary btn-block" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </form>
    </div>

    <div id="main-app" style="display: none;">
        <header>
            <div class="container">
                <div class="header-top">
                    <div class="logo-container">
                        <div class="logo">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="header-content">
                            <h1>Bukit Sampalan Asri</h1>
                            <p>Sistem Reservasi Kemah Keluarga</p>
                        </div>
                        <button class="menu-toggle" onclick="toggleMobileMenu()">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                    
                    <div class="auth-container">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar">
                                A
                            </div>
                            <div>
                                <span id="current-user"></span>
                                <div id="user-role" style="font-size: 0.75rem; opacity: 0.9;"></div>
                            </div>
                        </div>
                        <button class="logout-btn" onclick="logout()" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="logout-text">Keluar</span>
                        </button>
                    </div>
                </div>
                
                <nav>
                    <ul id="main-nav">
                        <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-home"></i> Dashboard</a></li>
                        <li><a href="#" onclick="showSection('reservasi')"><i class="fas fa-calendar-plus"></i> Reservasi</a></li>
                        <li><a href="#" onclick="showSection('lapak')"><i class="fas fa-map-marked-alt"></i> Status Lapak</a></li>
                        <li><a href="#" onclick="showSection('invoice')"><i class="fas fa-file-invoice-dollar"></i> Invoice</a></li>
                        <li><a href="#" onclick="showSection('laporan')"><i class="fas fa-chart-bar"></i> Laporan</a></li>
                        <li><a href="#" onclick="showSection('pengaturan')" class="admin-only"><i class="fas fa-cog"></i> Pengaturan</a></li>
                        <li><a href="#" onclick="showSection('users')" class="admin-only"><i class="fas fa-users"></i> Pengguna</a></li>
                        <li><a href="#" onclick="showSection('backup')" class="admin-only"><i class="fas fa-database"></i> Backup</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Monitoring</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="card-value" id="lapak-tersedia">0</div>
                        <div class="card-label">Lapak Tenda Tersedia</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="card-value" id="lapak-terpakai">0</div>
                        <div class="card-label">Lapak Tenda Terpakai</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="card-value" id="glamping-terpakai">0</div>
                        <div class="card-label">Glamping Terpakai</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-value" id="pengunjung-hari-ini">0</div>
                        <div class="card-label">Pengunjung Hari Ini</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="card-value" id="omzet-harian">Rp 0</div>
                        <div class="card-label">Omzet Harian (DP/Lunas)</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="card-value" id="reservasi-bulan-ini">0</div>
                        <div class="card-label">Reservasi Bulan Ini</div>
                    </div>
                </div>

                <div class="form-row mb-3">
                    <div class="form-group" style="flex: 1;">
                        <label for="filter-tanggal"><i class="fas fa-calendar-day"></i> Filter Status Tanggal</label>
                        <input type="date" id="filter-tanggal" class="form-control" onchange="updateDashboard()">
                    </div>
                </div>

                <div class="content-section">
                    <h3 class="section-title"><i class="fas fa-campground"></i> Status Lapak Tenda Hari Ini</h3>
                    <div class="lapak-container" id="lapak-status-container">
                        </div>
                    <div class="mt-3">
                        <span class="status-indicator status-tersedia"></span> Tersedia
                        <span class="status-indicator status-terpakai ml-3"></span> Terpakai
                        <span class="status-indicator status-dipilih ml-3"></span> Dipilih
                    </div>
                </div>

                <div class="content-section mt-3">
                    <h3 class="section-title"><i class="fas fa-home"></i> Status Glamping Hari Ini</h3>
                    <div class="lapak-container" id="glamping-status-container" style="grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));">
                        </div>
                </div>
            </section>

            <!-- Reservasi Section -->
            <section id="reservasi-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-calendar-plus"></i> Form Reservasi Baru</h2>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Maksimal <span id="max-lapak-info">30</span> lapak/glamping per reservasi.
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="tenda" onclick="changeReservasiTab(this, 'tenda')"><i class="fas fa-campground"></i> Lapak Tenda</div>
                        <div class="tab" data-tab="glamping" onclick="changeReservasiTab(this, 'glamping')"><i class="fas fa-home"></i> Glamping</div>
                    </div>
                </div>

                <div id="tab-tenda" class="tab-content active">
                    <form id="reservasi-tenda-form">
                        <h4 class="section-title"><i class="fas fa-user"></i> Data Pemesan</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama-tenda">Nama Pemesan</label>
                                <input type="text" id="nama-tenda" class="form-control" placeholder="Nama lengkap" required>
                            </div>
                            <div class="form-group">
                                <label for="telepon-tenda">Nomor Telepon/WA</label>
                                <input type="tel" id="telepon-tenda" class="form-control" placeholder="+62 8xx xxxx xxxx" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlah-orang-tenda">Jumlah Orang/Rombongan</label>
                                <input type="number" id="jumlah-orang-tenda" class="form-control" value="1" min="1" required onchange="hitungTotalBiayaTenda()" onkeyup="hitungTotalBiayaTenda()">
                            </div>
                            <div class="form-group">
                                <label for="email-tenda">Email (Opsional)</label>
                                <input type="email" id="email-tenda" class="form-control" placeholder="alamat@email.com">
                            </div>
                        </div>

                        <h4 class="section-title mt-3"><i class="fas fa-calendar-check"></i> Detail Reservasi</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tanggal-checkin-tenda">Tanggal Check-in</label>
                                <input type="date" id="tanggal-checkin-tenda" class="form-control" required onchange="updateLapakStatus()">
                            </div>
                            <div class="form-group">
                                <label for="tanggal-checkout-tenda">Tanggal Check-out</label>
                                <input type="date" id="tanggal-checkout-tenda" class="form-control" required onchange="hitungJumlahMalam('tenda')">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlah-malam-tenda">Jumlah Malam</label>
                                <input type="number" id="jumlah-malam-tenda" class="form-control" value="1" min="1" required onchange="hitungTotalBiayaTenda()" onkeyup="hitungTotalBiayaTenda()">
                            </div>
                            <div class="form-group">
                                <label for="jumlah-lapak-tenda">Lapak Dipilih</label>
                                <input type="text" id="jumlah-lapak-tenda" class="form-control" value="0 Lapak" disabled>
                            </div>
                        </div>
                        
                        <h4 class="section-title mt-3"><i class="fas fa-map-pin"></i> Pilih Lapak Tenda</h4>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> Pastikan tanggal check-in telah diisi untuk melihat status lapak yang akurat.
                        </div>
                        <div class="lapak-container" id="lapak-pilih-container">
                            </div>
                        <small class="text-muted mt-2 d-block">Lapak dipilih: <span id="lapak-dipilih-tenda-count">0</span></small>

                        <!-- TABEL AKOMODASI LAINNYA TAMBAHAN -->
                        <h4 class="section-title mt-3"><i class="fas fa-utensils"></i> Akomodasi Lainnya (Opsional)</h4>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Pilih akomodasi tambahan sesuai kebutuhan.
                        </div>
                        <div class="akomodasi-container" id="akomodasi-tenda-container">
                            <!-- Akomodasi akan di-generate oleh JavaScript -->
                        </div>
                        <small class="text-muted mt-2 d-block">Akomodasi dipilih: <span id="akomodasi-dipilih-tenda-count">0</span></small>

                        <h4 class="section-title mt-3"><i class="fas fa-money-check-alt"></i> Metode Pembayaran</h4>
                        <div class="form-group">
                            <label>Pilih Metode Pembayaran (DP <span id="dp-percentage-info-tenda">50</span>%)</label>
                            <div class="payment-option selected" id="payment-lokasi-tenda" onclick="selectPaymentMethod('lokasi', 'tenda')">
                                <i class="fas fa-money-bill-wave payment-icon"></i> Bayar di Lokasi (Lunas saat Check-in)
                            </div>
                            <div class="payment-option" id="payment-transfer-tenda" onclick="selectPaymentMethod('transfer', 'tenda')">
                                <i class="fas fa-credit-card payment-icon"></i> DP Transfer Bank
                            </div>
                            <div class="payment-option" id="payment-sekarang-tenda" onclick="selectPaymentMethod('sekarang', 'tenda')">
                                <i class="fas fa-wallet payment-icon"></i> Bayar Penuh Sekarang Transfer Bank (Total Biaya)
                            </div>
                        </div>

                        <h4 class="section-title mt-3"><i class="fas fa-calculator"></i> Rincian Biaya</h4>
                        <div class="table-responsive">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>Biaya Lapak (<span id="biaya-lapak-count">0</span> lapak x <span id="biaya-lapak-malam">0</span> malam)</td>
                                        <td class="text-right" id="biaya-lapak-tenda">Rp 0</td>
                                    </tr>
                                    <tr>
                                        <td>Tiket Masuk (<span id="biaya-tiket-orang">0</span> orang x <span id="biaya-tiket-malam">0</span> malam)</td>
                                        <td class="text-right" id="biaya-tiket-tenda">Rp 0</td>
                                    </tr>
                                    <tr id="akomodasi-row-tenda" style="display: none;">
                                        <td>Akomodasi Lainnya</td>
                                        <td class="text-right" id="biaya-akomodasi-tenda">Rp 0</td>
                                    </tr>
                                    <tr>
                                        <td>**TOTAL BIAYA**</td>
                                        <td class="text-right">**<span id="total-biaya-tenda">Rp 0</span>**</td>
                                    </tr>
                                    <tr id="dp-row-tenda">
                                        <td>**DP (<span id="dp-percentage-tenda">50</span>%)**</td>
                                        <td class="text-right">**<span id="dp-tenda">Rp 0</span>**</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-3">
                            <button type="button" class="btn btn-primary btn-block" onclick="submitReservasi('tenda')">
                                <i class="fas fa-save"></i> Proses Reservasi
                            </button>
                        </div>
                    </form>
                </div>

                <div id="tab-glamping" class="tab-content">
                    <form id="reservasi-glamping-form">
                        <h4 class="section-title"><i class="fas fa-user"></i> Data Pemesan</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama-glamping">Nama Pemesan</label>
                                <input type="text" id="nama-glamping" class="form-control" placeholder="Nama lengkap" required>
                            </div>
                            <div class="form-group">
                                <label for="telepon-glamping">Nomor Telepon/WA</label>
                                <input type="tel" id="telepon-glamping" class="form-control" placeholder="+62 8xx xxxx xxxx" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlah-orang-glamping">Jumlah Orang/Rombongan</label>
                                <input type="number" id="jumlah-orang-glamping" class="form-control" value="1" min="1" required onchange="hitungTotalBiayaGlamping()" onkeyup="hitungTotalBiayaGlamping()">
                            </div>
                            <div class="form-group">
                                <label for="email-glamping">Email (Opsional)</label>
                                <input type="email" id="email-glamping" class="form-control" placeholder="alamat@email.com">
                            </div>
                        </div>

                        <h4 class="section-title mt-3"><i class="fas fa-calendar-check"></i> Detail Reservasi</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tanggal-checkin-glamping">Tanggal Check-in</label>
                                <input type="date" id="tanggal-checkin-glamping" class="form-control" required onchange="updateGlampingStatus()">
                            </div>
                            <div class="form-group">
                                <label for="tanggal-checkout-glamping">Tanggal Check-out</label>
                                <input type="date" id="tanggal-checkout-glamping" class="form-control" required onchange="hitungJumlahMalam('glamping')">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jumlah-malam-glamping">Jumlah Malam</label>
                                <input type="number" id="jumlah-malam-glamping" class="form-control" value="1" min="1" required onchange="hitungTotalBiayaGlamping()" onkeyup="hitungTotalBiayaGlamping()">
                            </div>
                            <div class="form-group">
                                <label for="jumlah-glamping">Glamping Dipilih</label>
                                <input type="text" id="jumlah-glamping" class="form-control" value="0 Unit" disabled>
                            </div>
                        </div>

                        <h4 class="section-title mt-3"><i class="fas fa-map-pin"></i> Pilih Glamping</h4>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> Pastikan tanggal check-in telah diisi untuk melihat status glamping yang akurat.
                        </div>
                        <div class="lapak-container" id="glamping-pilih-container" style="grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));">
                            </div>
                        <small class="text-muted mt-2 d-block">Glamping dipilih: <span id="glamping-dipilih-count">0</span></small>

                        <!-- TABEL AKOMODASI LAINNYA TAMBAHAN UNTUK GLAMPING -->
                        <h4 class="section-title mt-3"><i class="fas fa-utensils"></i> Akomodasi Lainnya (Opsional)</h4>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Pilih akomodasi tambahan sesuai kebutuhan.
                        </div>
                        <div class="akomodasi-container" id="akomodasi-glamping-container">
                            <!-- Akomodasi akan di-generate oleh JavaScript -->
                        </div>
                        <small class="text-muted mt-2 d-block">Akomodasi dipilih: <span id="akomodasi-dipilih-glamping-count">0</span></small>

                        <h4 class="section-title mt-3"><i class="fas fa-money-check-alt"></i> Metode Pembayaran</h4>
                        <div class="form-group">
                            <label>Pilih Metode Pembayaran (DP <span id="dp-percentage-info-glamping">50</span>%)</label>
                            <div class="payment-option selected" id="payment-lokasi-glamping" onclick="selectPaymentMethod('lokasi', 'glamping')">
                                <i class="fas fa-money-bill-wave payment-icon"></i> Bayar di Lokasi (Lunas saat Check-in)
                            </div>
                            <div class="payment-option" id="payment-transfer-glamping" onclick="selectPaymentMethod('transfer', 'glamping')">
                                <i class="fas fa-credit-card payment-icon"></i> DP Transfer Bank
                            </div>
                            <div class="payment-option" id="payment-sekarang-glamping" onclick="selectPaymentMethod('sekarang', 'glamping')">
                                <i class="fas fa-wallet payment-icon"></i> Bayar Penuh Sekarang Transfer Bank (Total Biaya)
                            </div>
                        </div>
                        
                        <h4 class="section-title mt-3"><i class="fas fa-calculator"></i> Rincian Biaya</h4>
                        <div class="table-responsive">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>Biaya Glamping (<span id="glamping-dipilih-count-biaya">0</span> unit x <span id="biaya-glamping-malam">0</span> malam)</td>
                                        <td class="text-right" id="biaya-glamping">Rp 0</td>
                                    </tr>
                                    <tr>
                                        <td>Tiket Masuk (<span id="biaya-tiket-orang-glamping">0</span> orang x <span id="biaya-tiket-malam-glamping">0</span> malam)</td>
                                        <td class="text-right" id="biaya-tiket-glamping">Rp 0</td>
                                    </tr>
                                    <tr id="akomodasi-row-glamping" style="display: none;">
                                        <td>Akomodasi Lainnya</td>
                                        <td class="text-right" id="biaya-akomodasi-glamping">Rp 0</td>
                                    </tr>
                                    <tr>
                                        <td>**TOTAL BIAYA**</td>
                                        <td class="text-right">**<span id="total-biaya-glamping">Rp 0</span>**</td>
                                    </tr>
                                    <tr id="dp-row-glamping">
                                        <td>**DP (<span id="dp-percentage-glamping">50</span>%)**</td>
                                        <td class="text-right">**<span id="dp-glamping">Rp 0</span>**</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary btn-block" onclick="submitReservasi('glamping')">
                                <i class="fas fa-save"></i> Proses Reservasi
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Lapak Section -->
            <section id="lapak-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-map-marked-alt"></i> Visualisasi Status Lapak/Glamping</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tanggal-visualisasi"><i class="fas fa-calendar-day"></i> Filter Tanggal</label>
                        <input type="date" id="tanggal-visualisasi" class="form-control" onchange="updateLapakVisualization()">
                    </div>
                </div>

                <div class="tabs-container mt-3">
                    <div class="tabs">
                        <div class="tab active" data-tab="lapak-tenda-vis" onclick="changeVisualizationTab(this, 'lapak-tenda-vis')"><i class="fas fa-campground"></i> Lapak Tenda</div>
                        <div class="tab" data-tab="glamping-vis" onclick="changeVisualizationTab(this, 'glamping-vis')"><i class="fas fa-home"></i> Glamping</div>
                    </div>
                </div>

                <div id="lapak-tenda-vis" class="tab-content active">
                    <div class="visualization-grid" id="visualization-lapak">
                        </div>
                </div>

                <div id="glamping-vis" class="tab-content">
                    <div class="visualization-grid" id="visualization-glamping" style="grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));">
                        </div>
                </div>

                <div class="mt-3">
                    <span class="status-indicator status-tersedia"></span> Tersedia
                    <span class="status-indicator status-terpakai ml-3"></span> Terpakai
                    <span class="status-indicator status-dipilih ml-3"></span> Dipilih (untuk hari ini)
                </div>

                <h3 class="section-title mt-3"><i class="fas fa-list-alt"></i> Detail Reservasi Aktif</h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice</th>
                                <th>Jenis</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Nama Pemesan</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="lapak-reservasi-list">
                            </tbody>
                    </table>
                </div>
            </section>

            <!-- Invoice Section -->
            <section id="invoice-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Daftar Invoice Reservasi</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cari-invoice">Cari Invoice/Nama/Telepon</label>
                        <input type="text" id="cari-invoice" class="form-control" placeholder="Masukkan kata kunci..." onkeyup="cariInvoice()">
                    </div>
                    <div class="form-group">
                        <label for="filter-status">Filter Status</label>
                        <select id="filter-status" class="form-control" onchange="cariInvoice()">
                            <option value="">Semua Status</option>
                            <option value="pending">Pending</option>
                            <option value="dibayar">Dibayar (DP/Lunas)</option>
                            <option value="selesai">Selesai</option>
                            <option value="dibatalkan">Dibatalkan</option>
                            <option value="aktif">Aktif (Check-in)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filter-jenis">Filter Jenis</label>
                        <select id="filter-jenis" class="form-control" onchange="cariInvoice()">
                            <option value="">Semua Jenis</option>
                            <option value="tenda">Lapak Tenda</option>
                            <option value="glamping">Glamping</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-responsive mt-3">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice</th>
                                <th>Nama Pemesan</th>
                                <th>Jenis</th>
                                <th>Total Biaya</th>
                                <th>Status</th>
                                <th>Tgl Reservasi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-list">
                            </tbody>
                    </table>
                </div>
                
                <h3 class="section-title mt-3"><i class="fas fa-cart-plus"></i> Tambah Sewa Barang Manual</h3>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Tambah sewa barang untuk invoice yang aktif/dibayar.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="invoice-sewa-barang">Pilih Invoice (Aktif/Dibayar)</label>
                        <select id="invoice-sewa-barang" class="form-control" onchange="loadSewaBarangForm()">
                            <option value="">-- Pilih Invoice --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jumlah-hari-sewa">Jumlah Hari Sewa</label>
                        <input type="number" id="jumlah-hari-sewa" class="form-control" min="1" onchange="hitungTotalSewaBarang()" onkeyup="hitungTotalSewaBarang()">
                    </div>
                    <div class="form-group">
                        <label for="nama-pemandu-manual">Nama Pemandu/Petugas</label>
                        <input type="text" id="nama-pemandu-manual" class="form-control" placeholder="Nama pemandu">
                    </div>
                </div>
                
                <div id="sewa-barang-form-container" class="hidden">
                    <div class="table-responsive">
                        <table class="table mt-3">
                            <thead>
                                <tr>
                                    <th style="width: 30%">Nama Barang</th>
                                    <th style="width: 20%">Harga/Hari</th>
                                    <th style="width: 15%">Satuan</th>
                                    <th style="width: 15%">Jumlah</th>
                                    <th style="width: 20%" class="text-right">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody id="sewa-barang-list-manual">
                                </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="text-right">**TOTAL SEWA BARANG**</td>
                                    <td class="text-right">**<span id="total-sewa-barang">Rp 0</span>**</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <button class="btn btn-primary btn-block mt-3" onclick="simpanSewaBarang()">
                        <i class="fas fa-save"></i> Simpan Sewa Barang ke Invoice
                    </button>
                </div>
            </section>

            <!-- Laporan Section -->
            <section id="laporan-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> Laporan dan Statistik</h2>
                
                <div class="form-group">
                    <label for="periode-laporan">Periode Laporan</label>
                    <select id="periode-laporan" class="form-control" onchange="toggleTanggalKustom()">
                        <option value="hari_ini">Hari Ini</option>
                        <option value="bulan_ini" selected>Bulan Ini</option>
                        <option value="bulan_lalu">Bulan Lalu</option>
                        <option value="tahun_ini">Tahun Ini</option>
                        <option value="kustom">Kustom</option>
                    </select>
                </div>

                <div class="form-row hidden" id="periode-kustom-inputs">
                    <div class="form-group">
                        <label for="tanggal-mulai">Tanggal Mulai</label>
                        <input type="date" id="tanggal-mulai" class="form-control" onchange="filterLaporan()">
                    </div>
                    <div class="form-group">
                        <label for="tanggal-selesai">Tanggal Selesai</label>
                        <input type="date" id="tanggal-selesai" class="form-control" onchange="filterLaporan()">
                    </div>
                </div>

                <div class="dashboard-cards mt-3">
                    <div class="card" style="background-color: #e3f2fd;">
                        <div class="card-icon" style="color: #1e88e5;"><i class="fas fa-file-invoice"></i></div>
                        <div class="card-value" id="laporan-total-reservasi">0</div>
                        <div class="card-label">Total Reservasi</div>
                    </div>
                    <div class="card" style="background-color: #e8f5e9;">
                        <div class="card-icon" style="color: #43a047;"><i class="fas fa-campground"></i></div>
                        <div class="card-value" id="laporan-lapak-terjual">0</div>
                        <div class="card-label">Total Lapak Terjual</div>
                    </div>
                    <div class="card" style="background-color: #fff3e0;">
                        <div class="card-icon" style="color: #fb8c00;"><i class="fas fa-home"></i></div>
                        <div class="card-value" id="laporan-glamping-terjual">0</div>
                        <div class="card-label">Total Glamping Terjual</div>
                    </div>
                    <div class="card" style="background-color: #fce4ec;">
                        <div class="card-icon" style="color: #d81b60;"><i class="fas fa-users"></i></div>
                        <div class="card-value" id="laporan-total-pengunjung">0</div>
                        <div class="card-label">Total Pengunjung</div>
                    </div>
                    <div class="card" style="background-color: #e1f5fe;">
                        <div class="card-icon" style="color: #039be5;"><i class="fas fa-ticket-alt"></i></div>
                        <div class="card-value" id="laporan-total-tiket">Rp 0</div>
                        <div class="card-label">Total Biaya Tiket</div>
                    </div>
                    <div class="card" style="background-color: #e0f7fa;">
                        <div class="card-icon" style="color: #00bcd4;"><i class="fas fa-dollar-sign"></i></div>
                        <div class="card-value" id="laporan-total-omzet">Rp 0</div>
                        <div class="card-label">Total Omzet (DP/Lunas)</div>
                    </div>
                </div>

                <h3 class="section-title mt-3"><i class="fas fa-list-alt"></i> Detail Transaksi</h3>
                <div class="text-right mb-3">
                    <button class="btn btn-primary" onclick="generateLaporanPDF()">
                        <i class="fas fa-file-pdf"></i> Download Laporan PDF
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice</th>
                                <th>Tgl Reservasi</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Nama Pemesan</th>
                                <th>Jenis</th>
                                <th>Total Biaya</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="laporan-detail">
                            </tbody>
                    </table>
                </div>
            </section>

            <!-- Pengaturan Section - IMPROVED FOR MOBILE -->
            <section id="pengaturan-section" class="content-section hidden admin-only">
                <h2 class="section-title"><i class="fas fa-cog"></i> Pengaturan Sistem</h2>
                <div class="alert alert-warning admin-only">
                    <i class="fas fa-exclamation-triangle"></i> Halaman ini hanya dapat diakses oleh Admin.
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="tab-lapak-glamping" onclick="changePengaturanTab(this, 'lapak-glamping')"><i class="fas fa-campground"></i> Lapak & Glamping</div>
                        <div class="tab" data-tab="tab-biaya-umum" onclick="changePengaturanTab(this, 'biaya-umum')"><i class="fas fa-dollar-sign"></i> Biaya & Lainnya</div>
                        <div class="tab" data-tab="tab-barang-sewa" onclick="changePengaturanTab(this, 'barang-sewa')"><i class="fas fa-toolbox"></i> Barang Sewa</div>
                        <div class="tab" data-tab="tab-akomodasi" onclick="changePengaturanTab(this, 'akomodasi')"><i class="fas fa-utensils"></i> Akomodasi Lainnya</div>
                        <div class="tab" data-tab="tab-tools" onclick="changePengaturanTab(this, 'tools')"><i class="fas fa-screwdriver-wrench"></i> Tools Admin</div>
                    </div>
                </div>

                <div id="tab-lapak-glamping" class="tab-content active pengaturan-tab-content">
                    <h3 class="section-title"><i class="fas fa-campground"></i> Pengaturan Lapak Tenda</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 20%">Kode Lapak</th>
                                    <th style="width: 25%">Harga/Malam</th>
                                    <th style="width: 25%">Kapasitas (Orang)</th>
                                    <th style="width: 30%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-lapak">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary btn-sm mt-3" onclick="tambahLapak()">
                        <i class="fas fa-plus"></i> Tambah Lapak
                    </button>

                    <h3 class="section-title mt-3"><i class="fas fa-home"></i> Pengaturan Glamping</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 20%">Kode</th>
                                    <th style="width: 30%">Nama Glamping</th>
                                    <th style="width: 20%">Harga/Malam</th>
                                    <th style="width: 15%">Kapasitas (Orang)</th>
                                    <th style="width: 15%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-glamping">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary btn-sm mt-3" onclick="tambahGlamping()">
                        <i class="fas fa-plus"></i> Tambah Glamping
                    </button>
                </div>

                <div id="tab-biaya-umum" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-dollar-sign"></i> Biaya Umum</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="harga-tiket">Harga Tiket Masuk/Orang/Malam (Rp)</label>
                            <input type="number" id="harga-tiket" class="form-control" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="dp-percentage">Persentase DP (%)</label>
                            <input type="number" id="dp-percentage" class="form-control" min="0" max="100" required>
                        </div>
                    </div>

                    <h3 class="section-title mt-3"><i class="fas fa-clock"></i> Pengaturan Waktu</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jam-checkin">Jam Check-in (HH:MM)</label>
                            <input type="time" id="jam-checkin" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="jam-checkout">Jam Check-out (HH:MM)</label>
                            <input type="time" id="jam-checkout" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="min-reservasi-hari">Min. Hari Reservasi (Hari)</label>
                            <input type="number" id="min-reservasi-hari" class="form-control" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="max-reservasi-hari">Maks. Hari Reservasi (Hari)</label>
                            <input type="number" id="max-reservasi-hari" class="form-control" min="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="max-lapak-per-reservasi">Maks. Lapak/Glamping per Reservasi</label>
                            <input type="number" id="max-lapak-per-reservasi" class="form-control" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="denda-keterlambatan">Denda Keterlambatan Check-out/Jam (Rp)</label>
                            <input type="number" id="denda-keterlambatan" class="form-control" min="0" required>
                        </div>
                    </div>
                    
                    <h3 class="section-title mt-3"><i class="fas fa-university"></i> Informasi Bank Transfer</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nama-bank">Nama Bank</label>
                            <input type="text" id="nama-bank" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="nomor-rekening">Nomor Rekening</label>
                            <input type="text" id="nomor-rekening" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="an-rekening">Atas Nama Rekening</label>
                            <input type="text" id="an-rekening" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="no-layanan">Nomor Layanan (WA/Telepon)</label>
                            <input type="tel" id="no-layanan" class="form-control" placeholder="+62 8xx xxxx xxxx" required>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-block mt-3" onclick="simpanPengaturanUmum()">
                        <i class="fas fa-save"></i> Simpan Pengaturan Umum
                    </button>
                </div>

                <div id="tab-barang-sewa" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-toolbox"></i> Daftar Barang Sewa</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 35%">Nama Barang</th>
                                    <th style="width: 25%">Harga Sewa/Hari (Rp)</th>
                                    <th style="width: 15%">Satuan</th>
                                    <th style="width: 15%">Stok</th>
                                    <th style="width: 10%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-barang">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary btn-sm mt-3" onclick="tambahBarang()">
                        <i class="fas fa-plus"></i> Tambah Barang
                    </button>
                </div>

                <div id="tab-akomodasi" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-utensils"></i> Pengaturan Akomodasi Lainnya</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 35%">Nama Akomodasi</th>
                                    <th style="width: 25%">Harga (Rp)</th>
                                    <th style="width: 15%">Satuan</th>
                                    <th style="width: 15%">Stok</th>
                                    <th style="width: 10%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-akomodasi">
                                </tbody>
                        </table>
                    </div>
                    <button class="btn btn-secondary btn-sm mt-3" onclick="tambahAkomodasi()">
                        <i class="fas fa-plus"></i> Tambah Akomodasi
                    </button>
                </div>

                <div id="tab-tools" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-tools"></i> Tools Admin</h3>
                    <div class="alert alert-danger mb-3">
                        <i class="fas fa-exclamation-triangle"></i> **PERINGATAN!** Tindakan ini tidak dapat dibatalkan.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Hapus Invoice Bulan Lalu</label>
                            <p class="text-muted" style="font-size: 0.85rem;">Menghapus semua invoice dan data reservasi yang tanggal reservasi-nya jatuh pada bulan lalu.</p>
                        </div>
                        <div class="form-group" style="flex: 0 0 120px;">
                            <button class="btn btn-danger btn-block mt-2" onclick="hapusInvoiceBulanLalu()">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Reset Lapak/Glamping Checkout Hari Ini</label>
                            <p class="text-muted" style="font-size: 0.85rem;">Mengubah status lapak/glamping menjadi 'tersedia' untuk semua reservasi yang Check-out hari ini dan statusnya 'aktif' atau 'dibayar'.</p>
                        </div>
                        <div class="form-group" style="flex: 0 0 120px;">
                            <button class="btn btn-secondary btn-block mt-2" onclick="resetLapakHariIni()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </div>
                    
                    <!-- FITUR BARU: HAPUS INVOICE TERPILIH -->
                    <hr>
                    
                    <div class="form-row mt-3">
                        <div class="form-group" style="flex: 1;">
                            <label>Hapus Invoice Berdasarkan Filter</label>
                            <p class="text-muted" style="font-size: 0.85rem;">Hapus invoice berdasarkan filter tanggal, jenis, atau status. Kosongkan filter untuk semua data.</p>
                            
                            <div class="form-row mt-2">
                                <div class="form-group">
                                    <label for="hapus-filter-tanggal-mulai" style="font-size: 0.85rem;">Tanggal Mulai</label>
                                    <input type="date" id="hapus-filter-tanggal-mulai" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="hapus-filter-tanggal-selesai" style="font-size: 0.85rem;">Tanggal Selesai</label>
                                    <input type="date" id="hapus-filter-tanggal-selesai" class="form-control">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="hapus-filter-jenis" style="font-size: 0.85rem;">Jenis</label>
                                    <select id="hapus-filter-jenis" class="form-control">
                                        <option value="">Semua Jenis</option>
                                        <option value="tenda">Lapak Tenda</option>
                                        <option value="glamping">Glamping</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="hapus-filter-status" style="font-size: 0.85rem;">Status</label>
                                    <select id="hapus-filter-status" class="form-control">
                                        <option value="">Semua Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="dibayar">Dibayar</option>
                                        <option value="aktif">Aktif</option>
                                        <option value="selesai">Selesai</option>
                                        <option value="dibatalkan">Dibatalkan</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="hapus-konfirmasi" style="font-size: 0.85rem;">Ketik "HAPUS" untuk konfirmasi</label>
                                    <input type="text" id="hapus-konfirmasi" class="form-control" placeholder="Ketik HAPUS di sini">
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="flex: 0 0 120px; display: flex; flex-direction: column; gap: 5px;">
                            <button class="btn btn-danger btn-block" onclick="hapusInvoiceTerpilih()" id="btn-hapus-terpilih">
                                <i class="fas fa-trash"></i> Hapus Terpilih
                            </button>
                            <button class="btn btn-secondary btn-block" onclick="previewInvoiceTerpilih()">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                        </div>
                    </div>

                    <div id="preview-hapus-container" class="hidden mt-3">
                        <h5 class="section-title"><i class="fas fa-list"></i> Invoice yang akan dihapus</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice</th>
                                        <th>Nama Pemesan</th>
                                        <th>Jenis</th>
                                        <th>Total Biaya</th>
                                        <th>Status</th>
                                        <th>Tgl Reservasi</th>
                                    </tr>
                                </thead>
                                <tbody id="preview-hapus-list">
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-warning mt-2">
                            <i class="fas fa-exclamation-triangle"></i> Total invoice yang akan dihapus: <span id="preview-hapus-count">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="content-section hidden admin-only">
                <h2 class="section-title"><i class="fas fa-users"></i> Manajemen Pengguna</h2>
                <div class="alert alert-warning admin-only">
                    <i class="fas fa-exclamation-triangle"></i> Halaman ini hanya dapat diakses oleh Admin.
                </div>
                
                <h3 class="section-title"><i class="fas fa-user-plus"></i> Tambah Pengguna Baru</h3>
                <form id="tambah-user-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-nama">Nama Lengkap</label>
                            <input type="text" id="new-nama" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-username">Username</label>
                            <input type="text" id="new-username" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-password">Password</label>
                            <input type="password" id="new-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-role">Role</label>
                            <select id="new-role" class="form-control" required>
                                <option value="staff">Staff</option>
                                <option value="manager">Manager</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-secondary mt-2">
                        <i class="fas fa-user-plus"></i> Tambah Pengguna
                    </button>
                </form>

                <h3 class="section-title mt-3"><i class="fas fa-users-cog"></i> Daftar Pengguna</h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nama</th>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="users-list">
                            </tbody>
                    </table>
                </div>
            </section>

            <!-- Backup Section -->
            <section id="backup-section" class="content-section hidden admin-only">
                <h2 class="section-title"><i class="fas fa-database"></i> Backup & Restore Data</h2>
                <div class="alert alert-warning admin-only">
                    <i class="fas fa-exclamation-triangle"></i> Halaman ini hanya dapat diakses oleh Admin.
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Backup data secara berkala untuk mencegah kehilangan data.
                </div>

                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="backup-tab" onclick="changeBackupTab(this, 'backup')"><i class="fas fa-download"></i> Backup Data</div>
                        <div class="tab" data-tab="restore-tab" onclick="changeBackupTab(this, 'restore')"><i class="fas fa-upload"></i> Restore Data</div>
                        <div class="tab" data-tab="reset-tab" onclick="changeBackupTab(this, 'reset')"><i class="fas fa-redo"></i> Reset Data</div>
                    </div>
                </div>

                <div id="backup-tab" class="tab-content active pengaturan-tab-content">
                    <h3 class="section-title"><i class="fas fa-download"></i> Backup Data Sistem</h3>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>Data yang akan dibackup:</label>
                            <div class="access-control">
                                <div class="access-item">
                                    <span>Data Reservasi & Invoice</span>
                                    <span id="count-reservasi">0</span>
                                </div>
                                <div class="access-item">
                                    <span>Lapak Tenda</span>
                                    <span id="count-lapak">0</span>
                                </div>
                                <div class="access-item">
                                    <span>Glamping</span>
                                    <span id="count-glamping">0</span>
                                </div>
                                <div class="access-item">
                                    <span>Barang Sewa</span>
                                    <span id="count-barang">0</span>
                                </div>
                                <div class="access-item">
                                    <span>Akomodasi Lainnya</span>
                                    <span id="count-akomodasi">0</span>
                                </div>
                                <div class="access-item">
                                    <span>Pengaturan</span>
                                    <span>1</span>
                                </div>
                                <div class="access-item">
                                    <span>Pengguna</span>
                                    <span id="count-users">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row mt-3">
                        <div class="form-group" style="flex: 1;">
                            <label for="backup-password">Password Backup (Opsional)</label>
                            <input type="text" id="backup-password" class="form-control" placeholder="Kosongkan jika tidak ingin menggunakan password">
                            <small class="text-muted">Password akan digunakan untuk mengenkripsi data backup.</small>
                        </div>
                    </div>
                    
                    <div class="form-row mt-3">
                        <div class="form-group" style="flex: 1;">
                            <button class="btn btn-primary btn-block" onclick="backupData()">
                                <i class="fas fa-download"></i> Download Backup File
                            </button>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <button class="btn btn-secondary btn-block" onclick="copyBackupToClipboard()">
                                <i class="fas fa-copy"></i> Copy Backup ke Clipboard
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mt-3 hidden" id="backup-success">
                        <i class="fas fa-check-circle"></i> Backup berhasil dibuat!
                    </div>
                    
                    <div class="alert alert-danger mt-3 hidden" id="backup-error">
                        <i class="fas fa-exclamation-circle"></i> Terjadi kesalahan saat membuat backup!
                    </div>
                </div>

                <div id="restore-tab" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-upload"></i> Restore Data dari Backup</h3>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> <strong>PERINGATAN:</strong> Restore data akan menggantikan semua data yang ada. Pastikan Anda memiliki backup terbaru sebelum melakukan restore.
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="restore-method">Metode Restore</label>
                            <select id="restore-method" class="form-control" onchange="toggleRestoreMethod()">
                                <option value="file">Upload File Backup</option>
                                <option value="text">Paste Data Backup</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="restore-file-container">
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="backup-file">Pilih File Backup (.json atau .txt)</label>
                                <input type="file" id="backup-file" class="form-control" accept=".json,.txt">
                            </div>
                        </div>
                    </div>
                    
                    <div id="restore-text-container" class="hidden">
                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="backup-text">Paste Data Backup</label>
                                <textarea id="backup-text" class="form-control" rows="6" placeholder="Paste data backup di sini..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="restore-password">Password Backup (jika ada)</label>
                            <input type="text" id="restore-password" class="form-control" placeholder="Masukkan password jika backup dienkripsi">
                        </div>
                    </div>
                    
                    <div class="form-row mt-3">
                        <div class="form-group" style="flex: 1;">
                            <button class="btn btn-primary btn-block" onclick="restoreData()">
                                <i class="fas fa-upload"></i> Restore Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mt-3 hidden" id="restore-success">
                        <i class="fas fa-check-circle"></i> Data berhasil direstore!
                    </div>
                    
                    <div class="alert alert-danger mt-3 hidden" id="restore-error">
                        <i class="fas fa-exclamation-circle"></i> <span id="restore-error-message">Terjadi kesalahan saat restore data!</span>
                    </div>
                </div>

                <div id="reset-tab" class="tab-content pengaturan-tab-content" style="display: none;">
                    <h3 class="section-title"><i class="fas fa-redo"></i> Reset Data Sistem</h3>
                    
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> <strong>PERINGATAN KRITIS:</strong> Tindakan ini akan menghapus semua data dan mengembalikan sistem ke kondisi awal. Pastikan Anda telah membuat backup sebelum melakukan reset!
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="reset-type">Jenis Reset</label>
                            <select id="reset-type" class="form-control">
                                <option value="all">Reset Semua Data (Full Reset)</option>
                                <option value="transactions">Reset Hanya Transaksi (Reservasi & Invoice)</option>
                                <option value="products">Reset Hanya Produk (Lapak, Glamping, Barang)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="reset-confirm">Ketik "RESET" untuk konfirmasi</label>
                            <input type="text" id="reset-confirm" class="form-control" placeholder="Ketik RESET di sini">
                        </div>
                    </div>
                    
                    <div class="form-row mt-3">
                        <div class="form-group" style="flex: 1;">
                            <button class="btn btn-danger btn-block" onclick="resetSystemData()" id="btn-reset-system">
                                <i class="fas fa-bomb"></i> Reset Sistem
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i> <strong>Catatan:</strong> Reset akan menghapus data yang dipilih tetapi tetap menyimpan pengguna dan pengaturan dasar.
                    </div>
                </div>
            </section>
        </div>

        <!-- MODAL INVOICE DENGAN FITUR EDIT -->
        <div id="invoice-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-receipt"></i> Detail Invoice <span id="modal-invoice-number"></span></h5>
                    <button class="modal-close" onclick="closeInvoiceModal()">&times;</button>
                </div>
                <div id="invoice-detail-content">
                    <!-- Konten invoice akan diisi oleh JavaScript -->
                </div>
                
                <!-- FORM EDIT INVOICE DENGAN FITUR DISKON DAN PEMANDU -->
                <div id="invoice-edit-form" class="hidden mt-3">
                    <h4 class="section-title"><i class="fas fa-edit"></i> Edit Invoice</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-nama-pemandu">Nama Pemandu/Petugas</label>
                            <input type="text" id="edit-nama-pemandu" class="form-control" placeholder="Masukkan nama pemandu">
                        </div>
                        <div class="form-group">
                            <label for="edit-diskon-tipe">Tipe Diskon</label>
                            <select id="edit-diskon-tipe" class="form-control" onchange="toggleDiskonType()">
                                <option value="none">Tidak Ada Diskon</option>
                                <option value="percentage">Persentase (%)</option>
                                <option value="fixed">Nominal Tetap (Rp)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-diskon-nilai">Nilai Diskon</label>
                            <input type="number" id="edit-diskon-nilai" class="form-control" placeholder="0" min="0" onchange="hitungDiskon()" onkeyup="hitungDiskon()">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-catatan">Catatan Tambahan</label>
                            <textarea id="edit-catatan" class="form-control" rows="2" placeholder="Catatan tambahan untuk invoice..."></textarea>
                        </div>
                    </div>
                    <div id="diskon-info" class="alert alert-info mt-2 hidden">
                        Diskon akan diterapkan pada total biaya sebelum DP.
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-primary" onclick="simpanEditInvoice()">
                            <i class="fas fa-save"></i> Simpan Perubahan
                        </button>
                        <button class="btn btn-secondary ml-2" onclick="batalEditInvoice()">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
                
                <div class="modal-footer mt-3" style="display: flex; flex-wrap: wrap; gap: 5px;">
                    <button class="btn btn-secondary" onclick="printInvoiceToPDF()">
                        <i class="fas fa-print"></i> Cetak PDF
                    </button>
                    <button class="btn btn-danger" id="btn-batalkan-invoice" onclick="batalkanReservasi()">
                        <i class="fas fa-times-circle"></i> Batalkan
                    </button>
                    <button class="btn btn-success" id="btn-checkin-invoice" onclick="checkInReservasi()">
                        <i class="fas fa-sign-in-alt"></i> Check-in
                    </button>
                    <button class="btn btn-primary" id="btn-checkout-invoice" onclick="checkOutReservasi()">
                        <i class="fas fa-sign-out-alt"></i> Check-out
                    </button>
                    <button class="btn btn-warning" id="btn-update-pembayaran" onclick="updatePembayaran()">
                        <i class="fas fa-money-check-alt"></i> Update Pembayaran
                    </button>
                    <button class="btn btn-info" id="btn-edit-invoice" onclick="toggleEditInvoiceForm()">
                        <i class="fas fa-edit"></i> Edit Invoice
                    </button>
                </div>
            </div>
        </div>

        <div id="user-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-edit"></i> Edit Pengguna</h5>
                    <button class="modal-close" onclick="closeUserModal()">&times;</button>
                </div>
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label for="edit-nama">Nama Lengkap</label>
                        <input type="text" id="edit-nama" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-username">Username</label>
                        <input type="text" id="edit-username" class="form-control" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit-password">Password (Kosongkan jika tidak diubah)</label>
                        <input type="password" id="edit-password" class="form-control" placeholder="****">
                    </div>
                    <div class="form-group">
                        <label for="edit-role">Role</label>
                        <select id="edit-role" class="form-control" required>
                            <option value="staff">Staff</option>
                            <option value="manager">Manager</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block mt-3">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </form>
            </div>
        </div>

        <div id="loading-modal" class="modal">
            <div class="modal-content" style="max-width: 280px; text-align: center;">
                <div class="spinner"></div>
                <p id="loading-message">Memproses...</p>
            </div>
        </div>
        
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>Bukit Sampalan Asri</h3>
                        <p>Sistem Reservasi Kemah Keluarga</p>
                    </div>
                    <div class="footer-section">
                        <h3>Kontak</h3>
                        <p><i class="fas fa-phone"></i> Layanan: <span id="footer-no-layanan">+628xx xxxx xxxx</span></p>
                    </div>
                    <div class="footer-section">
                        <h3>Developer</h3>
                        <p>Powered by AI Assistant</p>
                        <p>Versi: 2025v12 (Firebase Realtime)</p>
                    </div>
                </div>
                <div class="copyright">
                    &copy; 2025 Bukit Sampalan Asri. All rights reserved.
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        // GANTI DENGAN KONFIGURASI FIREBASE ANDA SENDIRI
        const firebaseConfig = {
            apiKey: "AIzaSyDEXAMPLE1234567890abcdefghijklmnop",
            authDomain: "your-project-id.firebaseapp.com",
            databaseURL: "https://your-project-id-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdef1234567890"
        };

        // Initialize Firebase
        let firebaseApp;
        let database;
        let isFirebaseInitialized = false;
        let isOnline = false;
        let syncInProgress = false;
        let pendingChanges = [];

        // ==================== FIREBASE FUNCTIONS ====================
        function initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                isFirebaseInitialized = true;
                console.log("Firebase initialized successfully");
                
                // Setup connection monitoring
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", (snap) => {
                    isOnline = snap.val() === true;
                    updateFirebaseStatus();
                    
                    if (isOnline && pendingChanges.length > 0) {
                        syncPendingChanges();
                    }
                });
                
                // Load data from Firebase
                loadDataFromFirebase();
                
            } catch (error) {
                console.error("Firebase initialization error:", error);
                alert("Firebase gagal diinisialisasi. Sistem akan berjalan dalam mode offline.");
                loadFromLocalStorage();
            }
        }

        function updateFirebaseStatus() {
            const statusElement = document.getElementById('firebase-status');
            if (!statusElement) return;
            
            if (syncInProgress) {
                statusElement.className = 'firebase-status firebase-syncing';
                statusElement.innerHTML = '<i class="fas fa-sync fa-spin"></i> <span>Menyinkronkan...</span>';
                statusElement.classList.remove('hidden');
            } else if (isOnline) {
                statusElement.className = 'firebase-status firebase-online';
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> <span>Online</span>';
                statusElement.classList.remove('hidden');
            } else {
                statusElement.className = 'firebase-status firebase-offline';
                statusElement.innerHTML = '<i class="fas fa-wifi-slash"></i> <span>Offline</span>';
                statusElement.classList.remove('hidden');
            }
        }

        function syncPendingChanges() {
            if (pendingChanges.length === 0 || syncInProgress) return;
            
            syncInProgress = true;
            updateFirebaseStatus();
            
            const change = pendingChanges.shift();
            executeFirebaseOperation(change.operation, change.path, change.data)
                .then(() => {
                    syncInProgress = false;
                    updateFirebaseStatus();
                    
                    // Process next change if any
                    if (pendingChanges.length > 0) {
                        setTimeout(syncPendingChanges, 100);
                    }
                })
                .catch((error) => {
                    console.error("Sync error:", error);
                    syncInProgress = false;
                    updateFirebaseStatus();
                    // Keep the change in pendingChanges for retry
                    pendingChanges.unshift(change);
                });
        }

        function queueFirebaseOperation(operation, path, data) {
            pendingChanges.push({ operation, path, data, timestamp: Date.now() });
            
            // Keep only last 100 changes to prevent memory issues
            if (pendingChanges.length > 100) {
                pendingChanges = pendingChanges.slice(-50);
            }
            
            if (isOnline && !syncInProgress) {
                syncPendingChanges();
            }
        }

        async function executeFirebaseOperation(operation, path, data) {
            const ref = database.ref(path);
            
            switch (operation) {
                case 'set':
                    await ref.set(data);
                    break;
                case 'update':
                    await ref.update(data);
                    break;
                case 'push':
                    await ref.push(data);
                    break;
                case 'remove':
                    await ref.remove();
                    break;
            }
            
            return true;
        }

        async function loadDataFromFirebase() {
            if (!isFirebaseInitialized) {
                loadFromLocalStorage();
                return;
            }

            showLoadingModal('Memuat data dari Firebase...');
            
            try {
                // Load all data from Firebase
                const snapshot = await database.ref('/').once('value');
                
                if (snapshot.exists()) {
                    const firebaseData = snapshot.val();
                    
                    // Merge data from Firebase
                    if (firebaseData.reservasi) {
                        dataApp.reservasi = firebaseData.reservasi || [];
                    }
                    if (firebaseData.invoice) {
                        dataApp.invoice = firebaseData.invoice || [];
                    }
                    if (firebaseData.lapakTenda) {
                        dataApp.lapakTenda = firebaseData.lapakTenda || dataApp.lapakTenda;
                    }
                    if (firebaseData.glamping) {
                        dataApp.glamping = firebaseData.glamping || dataApp.glamping;
                    }
                    if (firebaseData.barangSewa) {
                        dataApp.barangSewa = firebaseData.barangSewa || dataApp.barangSewa;
                    }
                    if (firebaseData.akomodasiLainnya) {
                        dataApp.akomodasiLainnya = firebaseData.akomodasiLainnya || dataApp.akomodasiLainnya;
                    }
                    if (firebaseData.users) {
                        dataApp.users = firebaseData.users || dataApp.users;
                    }
                    if (firebaseData.pengaturan) {
                        dataApp.pengaturan = { ...dataApp.pengaturan, ...firebaseData.pengaturan };
                        if (firebaseData.pengaturan.perusahaan) {
                            dataApp.pengaturan.perusahaan = { 
                                ...dataApp.pengaturan.perusahaan, 
                                ...firebaseData.pengaturan.perusahaan 
                            };
                        }
                    }
                    
                    // Also save to localStorage as backup
                    saveToLocalStorage();
                    console.log("Data loaded from Firebase");
                } else {
                    // No data in Firebase, use localStorage
                    loadFromLocalStorage();
                    // Save local data to Firebase
                    saveAllDataToFirebase();
                }
                
                hideLoadingModal();
                
                // Setup realtime listeners
                setupRealtimeListeners();
                
            } catch (error) {
                console.error("Error loading from Firebase:", error);
                hideLoadingModal();
                loadFromLocalStorage();
                alert("Gagal memuat data dari Firebase. Sistem berjalan dengan data lokal.");
            }
        }

        function setupRealtimeListeners() {
            if (!isFirebaseInitialized) return;
            
            // Listen for changes in realtime
            const reservationsRef = database.ref('reservasi');
            reservationsRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    dataApp.reservasi = snapshot.val();
                    updateDashboard();
                    updateLapakVisualization();
                    generateInvoiceList();
                }
            });
            
            const invoicesRef = database.ref('invoice');
            invoicesRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    dataApp.invoice = snapshot.val();
                    generateInvoiceList();
                    filterLaporan();
                }
            });
            
            const lapakRef = database.ref('lapakTenda');
            lapakRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    dataApp.lapakTenda = snapshot.val();
                    updateDashboard();
                    updateLapakStatus();
                }
            });
        }

        function saveAllDataToFirebase() {
            if (!isFirebaseInitialized) return;
            
            const dataToSave = {
                reservasi: dataApp.reservasi,
                invoice: dataApp.invoice,
                lapakTenda: dataApp.lapakTenda,
                glamping: dataApp.glamping,
                barangSewa: dataApp.barangSewa,
                akomodasiLainnya: dataApp.akomodasiLainnya,
                pengaturan: dataApp.pengaturan,
                users: dataApp.users,
                lastSync: new Date().toISOString()
            };
            
            queueFirebaseOperation('set', '/', dataToSave);
        }

        // ==================== MODIFIED DATA HANDLING FUNCTIONS ====================
        
        // Save data to both localStorage and Firebase
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    reservasi: dataApp.reservasi,
                    invoice: dataApp.invoice,
                    lapakTenda: dataApp.lapakTenda,
                    glamping: dataApp.glamping,
                    barangSewa: dataApp.barangSewa,
                    akomodasiLainnya: dataApp.akomodasiLainnya,
                    pengaturan: dataApp.pengaturan,
                    users: dataApp.users,
                    lastBackup: new Date().toISOString()
                };
                localStorage.setItem('reservasiDataBSA', JSON.stringify(dataToSave));
                
                // Also save to Firebase if initialized
                if (isFirebaseInitialized) {
                    queueFirebaseOperation('set', '/', dataToSave);
                }
            } catch (e) {
                console.error('Error saving data:', e);
                alert('Gagal menyimpan data. Kemungkinan storage penuh.');
            }
        }

        // ==================== INITIALIZATION ====================
        
        // Utility Functions (keep all existing utility functions)
        function formatRupiah(number) {
            if (isNaN(number)) number = 0;
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            if (isNaN(d.getTime())) return '';
            
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('-');
        }
        
        function formatDateID(dateString) {
            if (!dateString) return '';
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const date = new Date(dateString + 'T00:00:00');
            if (isNaN(date.getTime())) return dateString;
            return date.toLocaleDateString('id-ID', options);
        }

        function generateInvoiceCode() {
            const now = new Date();
            const datePart = [
                now.getFullYear().toString().slice(-2),
                (now.getMonth() + 1).toString().padStart(2, '0'),
                now.getDate().toString().padStart(2, '0')
            ].join('');
            const randomPart = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `INV-${datePart}-${randomPart}`;
        }
        
        function showLoadingModal(message = 'Memproses...') {
            document.getElementById('loading-message').textContent = message;
            document.getElementById('loading-modal').style.display = 'flex';
        }

        function hideLoadingModal() {
            document.getElementById('loading-modal').style.display = 'none';
        }
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Initial Data
        let dataApp = {
            reservasi: [],
            invoice: [],
            lapakTenda: [
                { kode: 'D01', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D02', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D03', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D04', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D05', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D06', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D07', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D08', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D09', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D10', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D11', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D12', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D13', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D14', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D15', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D16', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D17', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D18', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D19', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D20', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D21', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D22', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D23', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D24', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D25', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D26', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D27', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D28', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'D29', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'D30', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'T01', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'T02', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'T03', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'T04', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'T05', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'T06', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'T07', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'T08', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'T09', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'T10', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B01', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B02', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B03', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B04', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B05', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B06', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B07', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B08', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B09', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B10', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B11', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B12', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B13', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B14', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B15', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B16', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B17', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B18', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B19', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B20', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B21', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B22', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B23', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B24', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B25', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B26', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B27', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B28', harga: 0, kapasitas: 4, status: 'tersedia' },
                { kode: 'B29', harga: 0, kapasitas: 4, status: 'tersedia' }, { kode: 'B30', harga: 0, kapasitas: 4, status: 'tersedia' }
            ],
            glamping: [
                { kode: 'G01', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G02', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G03', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G04', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G05', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G06', nama: 'Glamping Tipe A (4pax)', harga: 150000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G07', nama: 'Glamping Tipe A (4pax)', harga: 100000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G08', nama: 'Glamping Tipe A (4pax)', harga: 100000, kapasitas: 4, status: 'tersedia' },
                { kode: 'G09', nama: 'Glamping Tipe B (2pax)', harga: 120000, kapasitas: 2, status: 'tersedia' },
                { kode: 'G10', nama: 'Glamping Tipe B (2pax)', harga: 120000, kapasitas: 2, status: 'tersedia' }
            ],
            barangSewa: [
                { id: 1, nama: "Tenda Dome Kapasitas 4", harga: 70000, satuan: "hari", stok: 15 },
                { id: 2, nama: "Sleeping Bag", harga: 10000, satuan: "hari", stok: 30 },
                { id: 3, nama: "Matras", harga: 5000, satuan: "hari", stok: 30 },
                { id: 4, nama: "Kompor Portable", harga: 15000, satuan: "hari", stok: 10 },
            ],
            akomodasiLainnya: [
                { id: 1, nama: "Tenda Dome 3 Orang", harga: 60000, satuan: "unit", stok: 15, status: 'tersedia', jumlah: 0 },
                { id: 2, nama: "Kayu Bakar (1 pack)", harga: 10000, satuan: "pack", stok: 50, status: 'tersedia', jumlah: 0 },
                { id: 3, nama: "Kasur Lipat", harga: 15000, satuan: "unit", stok: 20, status: 'tersedia', jumlah: 0 },
                { id: 4, nama: "Nasi Liwet Porsi Keluarga", harga: 20000, satuan: "porsi", stok: 30, status: 'tersedia', jumlah: 0 },
                { id: 5, nama: "Gas Elpiji 3kg", harga: 25000, satuan: "tabung", stok: 10, status: 'tersedia', jumlah: 0 },
                { id: 6, nama: "Tikar", harga: 5000, satuan: "buah", stok: 40, status: 'tersedia', jumlah: 0 },
                { id: 7, nama: "Lampu Camping", harga: 10000, satuan: "unit", stok: 15, status: 'tersedia', jumlah: 0 },
                { id: 8, nama: "Kursi Lipat", harga: 8000, satuan: "buah", stok: 25, status: 'tersedia', jumlah: 0 },
            ],
            pengaturan: {
                perusahaan: {
                    nama: "Bukit Sampalan Asri",
                    alamat: "Sukamaju, Cihaurbeuti, Ciamis",
                    hargaTiket: 15000,
                    namaBank: "Bank BRI",
                    norek: "4045-0100-1680-532",
                    anRekening: "SUNARYA",
                    noLayanan: "+62812-9639-2270",
                },
                maxLapakPerReservasi: 30,
                minReservasiHari: 1,
                maxReservasiHari: 7,
                dpPercentage: 50,
                jamCheckin: "14:00",
                jamCheckout: "12:00",
                dendaKeterlambatan: 50000,
            },
            users: [
                { id: 1, nama: 'Admin Utama', username: 'admin', password: 'admin123', role: 'admin' },
                { id: 2, nama: 'Staff Reservasi', username: 'staff', password: 'staff123', role: 'staff' },
                { id: 3, nama: 'Manager Operasional', username: 'manager', password: 'manager123', role: 'manager' },
            ],
            user: null,
        };

        // Load data from localStorage (for offline use)
        function loadFromLocalStorage() {
            try {
                const storedData = localStorage.getItem('reservasiDataBSA');
                if (storedData) {
                    const loadedData = JSON.parse(storedData);
                    
                    dataApp.reservasi = loadedData.reservasi || [];
                    dataApp.invoice = loadedData.invoice || [];
                    dataApp.lapakTenda = loadedData.lapakTenda || dataApp.lapakTenda;
                    dataApp.glamping = loadedData.glamping || dataApp.glamping;
                    dataApp.barangSewa = loadedData.barangSewa || dataApp.barangSewa;
                    dataApp.akomodasiLainnya = loadedData.akomodasiLainnya || dataApp.akomodasiLainnya;
                    dataApp.users = loadedData.users || dataApp.users;
                    
                    if (loadedData.pengaturan) {
                        dataApp.pengaturan = { ...dataApp.pengaturan, ...loadedData.pengaturan };
                        if (loadedData.pengaturan.perusahaan) {
                            dataApp.pengaturan.perusahaan = { ...dataApp.pengaturan.perusahaan, ...loadedData.pengaturan.perusahaan };
                        }
                    }
                }
            } catch (e) {
                console.error('Error loading from localStorage:', e);
            }
        }

        // ==================== AUTHENTICATION ====================
        function login() {
            const usernameInput = document.getElementById('username').value.trim();
            const passwordInput = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');

            if (!usernameInput || !passwordInput) {
                errorElement.textContent = 'Harap isi username dan password!';
                errorElement.classList.remove('hidden');
                return;
            }

            const user = dataApp.users.find(u => u.username === usernameInput && u.password === passwordInput);

            if (user) {
                dataApp.user = user;
                errorElement.classList.add('hidden');
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                initializeApp();
            } else {
                errorElement.textContent = 'Username atau password salah!';
                errorElement.classList.remove('hidden');
            }
        }

        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                dataApp.user = null;
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('login-form').reset();
                document.getElementById('login-error').classList.add('hidden');
                
                document.getElementById('main-nav').classList.remove('active');
            }
        }

        // ==================== INITIALIZE APP ====================
        function initializeApp() {
            const user = dataApp.user;
            if (!user) return;

            document.getElementById('current-user').textContent = user.nama;
            let roleText = '';
            if (user.role === 'admin') roleText = 'Admin';
            else if (user.role === 'manager') roleText = 'Manager';
            else roleText = 'Staff';
            document.getElementById('user-role').textContent = roleText;
            document.getElementById('user-avatar').textContent = user.nama.charAt(0).toUpperCase();
            
            const avatar = document.getElementById('user-avatar');
            if (user.role === 'admin') {
                avatar.style.backgroundColor = '#9c27b0';
            } else if (user.role === 'manager') {
                avatar.style.backgroundColor = '#2196f3';
            } else {
                avatar.style.backgroundColor = '#ff9800';
            }

            document.querySelectorAll('.admin-only').forEach(el => {
                if (user.role !== 'admin') {
                    el.classList.add('hidden');
                } else {
                    el.classList.remove('hidden');
                }
            });

            // Set today's date for filters
            const today = formatDate(new Date());
            document.getElementById('filter-tanggal').value = today;
            document.getElementById('tanggal-visualisasi').value = today;

            showSection('dashboard');

            // Update all displays
            updateDashboard();
            updateLapakStatus();
            updateGlampingStatus();
            updateLapakVisualization();
            generateInvoiceList();
            filterLaporan();
            generatePengaturanLapak();
            generatePengaturanGlamping();
            generatePengaturanBarang();
            generatePengaturanAkomodasi();
            generateUsersList();
            loadInvoiceOptions();
            loadPengaturanData();
            
            generateAkomodasiOptions('tenda');
            generateAkomodasiOptions('glamping');
            
            document.getElementById('footer-no-layanan').textContent = dataApp.pengaturan.perusahaan.noLayanan;
            
            document.getElementById('main-nav').classList.remove('active');
            
            updateBackupCounts();
        }

        // ==================== ALL OTHER FUNCTIONS REMAIN THE SAME ====================
        // [Semua fungsi JavaScript yang ada tetap sama dari sini...]
        // Fungsi-fungsi seperti showSection, updateDashboard, submitReservasi, dll.
        // Tetap sama seperti dalam kode asli Anda

        // Untuk menjaga panjang kode, saya akan menunjukkan bahwa semua fungsi lainnya
        // tetap sama seperti yang sudah Anda miliki. Hanya fungsi saveToLocalStorage
        // yang sudah dimodifikasi untuk juga menyimpan ke Firebase.

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', (event) => {
            // Initialize Firebase
            initializeFirebase();
            
            // Load data from localStorage first (for faster loading)
            loadFromLocalStorage();
            
            // Set today's date for date inputs
            const today = formatDate(new Date());
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });

            // Check if user is logged in
            if (dataApp.user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                initializeApp();
            } else {
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('main-app').style.display = 'none';
            }
            
            // Close modals when clicking outside
            window.onclick = function(event) {
                const invoiceModal = document.getElementById('invoice-modal');
                if (event.target === invoiceModal) {
                    closeInvoiceModal();
                }
                
                const userModal = document.getElementById('user-modal');
                if (event.target === userModal) {
                    closeUserModal();
                }
                
                const loadingModal = document.getElementById('loading-modal');
                if (event.target === loadingModal) {
                    hideLoadingModal();
                }
            };
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.target.tagName === 'INPUT' && e.target.type !== 'button' && e.target.type !== 'submit') {
                    e.preventDefault();
                }
            });
            
            document.addEventListener('click', function(e) {
                const nav = document.getElementById('main-nav');
                const menuToggle = document.querySelector('.menu-toggle');
                
                if (nav.classList.contains('active') && 
                    !nav.contains(e.target) && 
                    !menuToggle.contains(e.target)) {
                    nav.classList.remove('active');
                    const menuIcon = document.querySelector('.menu-toggle i');
                    menuIcon.classList.remove('fa-times');
                    menuIcon.classList.add('fa-bars');
                }
            });
            
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.getElementById('main-nav').classList.remove('active');
                    const menuIcon = document.querySelector('.menu-toggle i');
                    if (menuIcon) {
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                    }
                }
            });
            
            document.getElementById('periode-laporan').addEventListener('change', toggleTanggalKustom);
            
            function setVH() {
                let vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            setVH();
            window.addEventListener('resize', setVH);
        });

        // ==================== TAMBAHKAN SEMUA FUNGSI LAINNYA DI SINI ====================
        // [Salin semua fungsi JavaScript yang ada dari kode asli Anda di sini]
        // Pastikan untuk tidak menduplikasi fungsi yang sudah didefinisikan di atas

        // Contoh: fungsi showSection
        function showSection(sectionId) {
            // ... implementasi fungsi showSection ...
        }

        function toggleMobileMenu() {
            // ... implementasi fungsi toggleMobileMenu ...
        }

        function updateDashboard() {
            // ... implementasi fungsi updateDashboard ...
        }

        // Dan seterusnya untuk semua fungsi lainnya...

        // CATATAN PENTING:
        // 1. Semua fungsi yang berkaitan dengan manipulasi data (seperti submitReservasi, 
        //    updatePembayaran, simpanPengaturanUmum, dll.) akan otomatis menyimpan ke Firebase
        //    melalui fungsi saveToLocalStorage yang sudah dimodifikasi.
        // 2. Sistem sekarang berjalan secara realtime - perubahan di satu browser akan
        //    terlihat di browser lain yang sedang online.
        // 3. Sistem tetap berfungsi offline dengan menggunakan localStorage sebagai fallback.

    </script>
    
    <!-- Note: Karena keterbatasan panjang, saya tidak bisa menampilkan semua fungsi JavaScript -->
    <!-- Anda perlu menyalin semua fungsi JavaScript dari kode asli Anda ke bagian ini -->
    <!-- Fungsi-fungsi yang perlu disalin termasuk:
         - showSection, toggleMobileMenu
         - updateDashboard, hitungJumlahMalam, updateLapakStatus, updateGlampingStatus
         - toggleLapakSelection, toggleGlampingSelection
         - generateAkomodasiOptions, toggleAkomodasiSelection, updateAkomodasiJumlah
         - changeReservasiTab, selectPaymentMethod, hitungTotalBiayaTenda, hitungTotalBiayaGlamping
         - submitReservasi, generateInvoiceList, cariInvoice, showInvoiceModal, closeInvoiceModal
         - toggleEditInvoiceForm, toggleDiskonType, hitungDiskon, simpanEditInvoice, batalEditInvoice
         - generateInvoiceHTML, updatePembayaran, batalkanReservasi, checkInReservasi, checkOutReservasi
         - printInvoiceToPDF, updateLapakVisualization, changeVisualizationTab
         - loadInvoiceOptions, loadSewaBarangForm, hitungTotalSewaBarang, simpanSewaBarang
         - toggleTanggalKustom, filterLaporan, generateLaporanPDF
         - loadPengaturanData, simpanPengaturanUmum, changePengaturanTab
         - generatePengaturanLapak, simpanLapak, hapusLapak, tambahLapak
         - generatePengaturanGlamping, simpanGlamping, hapusGlamping, tambahGlamping
         - generatePengaturanBarang, simpanBarang, hapusBarang, tambahBarang
         - generatePengaturanAkomodasi, simpanAkomodasi, hapusAkomodasi, tambahAkomodasi
         - hapusInvoiceBulanLalu, resetLapakHariIni, previewInvoiceTerpilih
         - filterInvoicesForDeletion, hapusInvoiceTerpilih
         - generateUsersList, showUserModal, closeUserModal, hapusUser
         - changeBackupTab, toggleRestoreMethod, backupData, copyBackupToClipboard
         - restoreData, processRestore, showRestoreError, resetSystemData
         - resetAllData, resetTransactionData, resetProductData
         - updateBackupCounts, getReservedCodes, formatRupiah, formatDate, formatDateID
         - generateInvoiceCode, showLoadingModal, hideLoadingModal, scrollToTop
    -->
    
    <!-- Karena panjang kode, saya sarankan untuk:
         1. Gunakan kode HTML/CSS/JS yang sudah Anda miliki
         2. Tambahkan konfigurasi Firebase di bagian atas script
         3. Modifikasi fungsi saveToLocalStorage seperti di atas
         4. Tambahkan fungsi initializeFirebase dan loadDataFromFirebase
         5. Panggil initializeFirebase() di DOMContentLoaded
    -->
</body>
</html>