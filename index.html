<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reservasi Kemah Keluarga - Bukit Sampalan Asri</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #4caf50;
            --accent-color: #ff9800;
            --light-color: #f1f8e9;
            --dark-color: #1b5e20;
            --danger-color: #f44336;
            --warning-color: #ffc107;
            --success-color: #4caf50;
            --gray-color: #757575;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles - Mobile Friendly */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .logo {
            font-size: 2rem;
            margin-right: 12px;
        }
        
        .header-content h1 {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }
        
        .header-content p {
            opacity: 0.9;
            font-size: 0.8rem;
            display: none;
        }
        
        .auth-container {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auth-container span {
            margin-right: 8px;
            font-size: 0.9rem;
        }
        
        .logout-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }
        
        nav {
            transition: all 0.3s ease;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            flex-wrap: wrap;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        nav a:hover, nav a.active {
            background-color: var(--dark-color);
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            margin: 20px 0;
            gap: 20px;
        }
        
        .content-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 1.2rem;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
        }
        
        .card-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .card-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .card-label {
            color: var(--gray-color);
            font-size: 0.85rem;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            outline: none;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 180px;
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-color);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            min-width: 600px;
        }
        
        .table th, .table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .table tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Lapak Visualization */
        .lapak-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }
        
        .lapak-item {
            height: 60px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-size: 0.9rem;
        }
        
        .lapak-item .lapak-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            display: none;
            z-index: 10;
        }
        
        .lapak-item:hover .lapak-tooltip {
            display: block;
        }
        
        .lapak-tersedia {
            background-color: var(--success-color);
        }
        
        .lapak-terpakai {
            background-color: var(--danger-color);
        }
        
        .lapak-dipilih {
            background-color: var(--warning-color);
            transform: scale(1.03);
            box-shadow: 0 0 8px rgba(0,0,0,0.2);
        }
        
        .lapak-item:hover {
            transform: scale(1.03);
        }
        
        /* Invoice Styles */
        .invoice {
            border: 2px solid var(--light-color);
            border-radius: 8px;
            padding: 20px;
            background-color: white;
        }
        
        .invoice-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
        }
        
        .invoice-details {
            margin-bottom: 20px;
        }
        
        .invoice-items {
            margin-bottom: 20px;
        }
        
        .invoice-total {
            text-align: right;
            font-size: 1.1rem;
            font-weight: bold;
            border-top: 2px solid var(--light-color);
            padding-top: 15px;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            margin-top: 30px;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .footer-section {
            flex: 1;
            min-width: 220px;
            margin-bottom: 15px;
        }
        
        .footer-section h3 {
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        /* Tabs Styles */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light-color);
            margin-bottom: 15px;
            flex-wrap: wrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        .tab:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Visualisasi Grid */
        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 6px;
            margin-top: 15px;
        }
        
        .grid-item {
            height: 45px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.75rem;
        }
        
        /* Responsive Styles */
        @media (max-width: 992px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .visualization-grid {
                grid-template-columns: repeat(8, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
                margin-left: auto;
            }
            
            .header-content p {
                display: block;
            }
            
            nav ul {
                flex-direction: column;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
                gap: 5px;
                margin-top: 10px;
            }
            
            nav ul.active {
                max-height: 400px;
            }
            
            nav a {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .main-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lapak-container {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
            
            .lapak-item {
                height: 50px;
                font-size: 0.8rem;
            }
            
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .visualization-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .grid-item {
                height: 40px;
                font-size: 0.7rem;
            }
            
            .footer-section {
                min-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .header-content h1 {
                font-size: 1.2rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .auth-container span {
                font-size: 0.8rem;
            }
            
            .logout-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 12px;
            }
            
            .card-value {
                font-size: 1.3rem;
            }
            
            .lapak-container {
                grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            }
            
            .lapak-item {
                height: 45px;
                font-size: 0.75rem;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .visualization-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .grid-item {
                height: 35px;
                font-size: 0.65rem;
            }
            
            .table th, .table td {
                padding: 8px 10px;
                font-size: 0.85rem;
            }
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mb-2 {
            margin-bottom: 10px;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        .mb-4 {
            margin-bottom: 20px;
        }
        
        .mt-2 {
            margin-top: 10px;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .mt-4 {
            margin-top: 20px;
        }
        
        .ml-2 {
            margin-left: 10px;
        }
        
        .ml-3 {
            margin-left: 15px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning-color);
            color: #333;
        }
        
        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .badge-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-tersedia {
            background-color: var(--success-color);
        }
        
        .status-terpakai {
            background-color: var(--danger-color);
        }
        
        .status-dipilih {
            background-color: var(--warning-color);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 12px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Login Styles */
        .login-container {
            max-width: 380px;
            margin: 80px auto;
            padding: 25px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .login-logo i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 12px;
        }
        
        .login-logo h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
        }
        
        /* Glamping Selection */
        .glamping-option {
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .glamping-option:hover {
            border-color: var(--primary-color);
        }
        
        .glamping-option.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .glamping-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Checkbox Selection */
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .checkbox-container input {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }
        
        /* Payment Method Styles */
        .payment-option {
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-option:hover {
            border-color: var(--primary-color);
        }
        
        .payment-option.selected {
            border-color: var(--primary-color);
            background-color: var(--light-color);
        }
        
        .payment-icon {
            font-size: 1.2rem;
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        /* User Role Badges */
        .badge-admin {
            background-color: #9c27b0;
            color: white;
        }
        
        .badge-manager {
            background-color: #2196f3;
            color: white;
        }
        
        .badge-staff {
            background-color: #ff9800;
            color: white;
        }
        
        /* Access Control */
        .access-control {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        
        .access-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .access-item:last-child {
            border-bottom: none;
        }
        
        /* Bank Info Styles */
        .bank-info {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .bank-info h5 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Touch Friendly */
        button, 
        input[type="button"], 
        input[type="submit"], 
        .btn,
        .tab,
        .lapak-item {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Better touch targets */
        .btn, .tab, .lapak-item {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Prevent text selection on interactive elements */
        .btn, .tab, .lapak-item {
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* Improved scrolling */
        .table-responsive,
        .modal-content {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Mobile optimization for forms */
        input, select, textarea {
            font-size: 16px !important; /* Prevents zoom on iOS */
        }
        
        /* Better touch feedback */
        .btn:active, .tab:active, .lapak-item:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <!-- Login Screen (Initially Hidden) -->
    <div id="login-screen" class="login-container" style="display: block;">
        <div class="login-logo">
            <i class="fas fa-campground"></i>
            <h2>Bukit Sampalan Asri</h2>
            <p>Sistem Reservasi Kemah Keluarga</p>
        </div>
        
        <form id="login-form">
            <div class="form-group">
                <label for="username"><i class="fas fa-user"></i> Username</label>
                <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
            </div>
            
            <div class="form-group">
                <label for="password"><i class="fas fa-lock"></i> Password</label>
                <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
            </div>
            
            <div class="alert alert-danger hidden" id="login-error">
                <i class="fas fa-exclamation-circle"></i> Username atau password salah!
            </div>
            
            <button type="button" class="btn btn-primary btn-block" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            
            <div class="text-center mt-3">
                <small>Default: admin / admin123 (Admin), staff / staff123 (Staff)</small>
            </div>
        </form>
    </div>

    <!-- Main Application (Initially Hidden) -->
    <div id="main-app" style="display: none;">
        <!-- Header -->
        <header>
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="logo-container">
                        <div class="logo">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="header-content">
                            <h1>Bukit Sampalan Asri</h1>
                            <p>Sistem Reservasi Kemah Keluarga</p>
                        </div>
                    </div>
                    
                    <div class="auth-container">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar">
                                A
                            </div>
                            <div>
                                <span id="current-user"></span>
                                <div id="user-role" style="font-size: 0.8rem; opacity: 0.9;"></div>
                            </div>
                        </div>
                        <button class="menu-toggle" onclick="toggleMobileMenu()">
                            <i class="fas fa-bars"></i>
                        </button>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
                
                <nav>
                    <ul id="main-nav">
                        <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-home"></i> Dashboard</a></li>
                        <li><a href="#" onclick="showSection('reservasi')"><i class="fas fa-calendar-plus"></i> Reservasi</a></li>
                        <li><a href="#" onclick="showSection('lapak')"><i class="fas fa-map-marked-alt"></i> Status Lapak</a></li>
                        <li><a href="#" onclick="showSection('invoice')"><i class="fas fa-file-invoice-dollar"></i> Invoice</a></li>
                        <li><a href="#" onclick="showSection('laporan')"><i class="fas fa-chart-bar"></i> Laporan</a></li>
                        <li><a href="#" onclick="showSection('pengaturan')" class="admin-only"><i class="fas fa-cog"></i> Pengaturan</a></li>
                        <li><a href="#" onclick="showSection('users')" class="admin-only"><i class="fas fa-users"></i> Pengguna</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Monitoring</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="card-value" id="lapak-tersedia">55</div>
                        <div class="card-label">Lapak Tersedia</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="card-value" id="lapak-terpakai">15</div>
                        <div class="card-label">Lapak Terpakai</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="card-value" id="glamping-terpakai">3</div>
                        <div class="card-label">Glamping Terpakai</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-value" id="pengunjung-hari-ini">68</div>
                        <div class="card-label">Pengunjung Hari Ini</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="card-value" id="omzet-harian">Rp 2.450.000</div>
                        <div class="card-label">Omzet Harian</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="card-value" id="reservasi-hari-ini-count">0</div>
                        <div class="card-label">Reservasi Hari Ini</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="content-section">
                        <h3 class="section-title"><i class="fas fa-calendar-day"></i> Reservasi Hari Ini</h3>
                        <div class="text-right mb-3">
                            <button class="btn btn-secondary btn-sm" onclick="resetLapakHariIni()">
                                <i class="fas fa-sync-alt"></i> Reset Lapak Check-out
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>No Invoice</th>
                                        <th>Nama Pemesan</th>
                                        <th>Lapak/Unit</th>
                                        <th>Check-in</th>
                                        <th>Check-out</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="reservasi-hari-ini">
                                    <!-- Data akan diisi oleh JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reservasi Section -->
            <section id="reservasi-section" class="content-section hidden">
                <div class="tabs" id="reservasi-tabs">
                    <div class="tab active" onclick="showReservasiTab('tenda')">
                        <i class="fas fa-campground"></i> Lapak Tenda
                    </div>
                    <div class="tab" onclick="showReservasiTab('glamping')">
                        <i class="fas fa-home"></i> Glamping
                    </div>
                    <div class="tab" onclick="showReservasiTab('sewa-barang')">
                        <i class="fas fa-tools"></i> Sewa Barang
                    </div>
                </div>
                
                <!-- Tab Content: Lapak Tenda -->
                <div id="tab-tenda" class="tab-content active">
                    <h2 class="section-title"><i class="fas fa-campground"></i> Reservasi Lapak Tenda</h2>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Maksimal pemilihan lapak: <span id="max-lapak-info">30</span> lapak per reservasi. Tiket masuk: Rp 15.000 per orang.
                    </div>
                    
                    <form id="form-reservasi-tenda">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tanggal-checkin-tenda"><i class="fas fa-calendar-alt"></i> Tanggal Check-in</label>
                                <input type="date" id="tanggal-checkin-tenda" class="form-control" required onchange="updateLapakByTanggal()">
                            </div>
                            
                            <div class="form-group">
                                <label for="jumlah-malam-tenda"><i class="fas fa-moon"></i> Jumlah Malam</label>
                                <select id="jumlah-malam-tenda" class="form-control" onchange="hitungTotalTenda()">
                                    <option value="1">1 Malam</option>
                                    <option value="2" selected>2 Malam</option>
                                    <option value="3">3 Malam</option>
                                    <option value="4">4 Malam</option>
                                    <option value="5">5 Malam</option>
                                    <option value="6">6 Malam</option>
                                    <option value="7">7 Malam</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Lapak Selection -->
                        <div class="form-group">
                            <label><i class="fas fa-map-marker-alt"></i> Pilih Lapak Tenda</label>
                            <div class="alert alert-warning" id="lapak-warning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Anda telah mencapai batas maksimal pemilihan lapak.
                            </div>
                            <div class="lapak-container" id="lapak-container-tenda">
                                <!-- Lapak akan di-generate oleh JavaScript -->
                            </div>
                            <div class="mt-3">
                                <span class="status-indicator status-tersedia"></span> Tersedia 
                                <span class="status-indicator status-terpakai ml-3"></span> Terpakai
                                <span class="status-indicator status-dipilih ml-3"></span> Dipilih (<span id="lapak-dipilih-count">0</span>)
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama-pemesan-tenda"><i class="fas fa-user"></i> Nama Pemesan</label>
                                <input type="text" id="nama-pemesan-tenda" class="form-control" placeholder="Nama lengkap pemesan" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="telepon-tenda"><i class="fas fa-phone"></i> No. Telepon</label>
                                <input type="tel" id="telepon-tenda" class="form-control" placeholder="Nomor telepon aktif" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="jumlah-orang-tenda"><i class="fas fa-users"></i> Jumlah Orang</label>
                            <input type="number" id="jumlah-orang-tenda" class="form-control" min="1" max="100" value="4" onchange="hitungTotalTenda()">
                        </div>
                        
                        <!-- Jenis Pembayaran -->
                        <div class="form-group">
                            <label><i class="fas fa-credit-card"></i> Jenis Pembayaran</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('transfer', 'tenda')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-transfer-tenda" name="payment-tenda" value="transfer">
                                            <label for="payment-transfer-tenda">
                                                <i class="fas fa-university payment-icon"></i> Transfer Bank
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('lokasi', 'tenda')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-lokasi-tenda" name="payment-tenda" value="lokasi" checked>
                                            <label for="payment-lokasi-tenda">
                                                <i class="fas fa-map-marker-alt payment-icon"></i> Bayar di Lokasi
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('sekarang', 'tenda')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-sekarang-tenda" name="payment-tenda" value="sekarang">
                                            <label for="payment-sekarang-tenda">
                                                <i class="fas fa-money-bill-wave payment-icon"></i> Bayar Sekarang
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ringkasan Biaya -->
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-calculator"></i> Ringkasan Biaya</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Biaya Lapak</label>
                                    <div class="form-control" id="biaya-akomodasi-tenda">Rp 0</div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Tiket Masuk (Rp 15.000/orang)</label>
                                    <div class="form-control" id="biaya-tiket-tenda">Rp 0</div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Total Biaya</label>
                                    <div class="form-control" style="font-weight: bold; font-size: 1.1rem;" id="total-biaya-tenda">Rp 0</div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary btn-block" onclick="buatReservasiTenda()">
                            <i class="fas fa-check-circle"></i> Buat Reservasi Lapak Tenda
                        </button>
                    </form>
                </div>
                
                <!-- Tab Content: Glamping -->
                <div id="tab-glamping" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-home"></i> Reservasi Glamping</h2>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Tiket masuk: Rp 15.000 per orang. Pilih semua glamping yang tersedia.
                    </div>
                    
                    <form id="form-reservasi-glamping">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tanggal-checkin-glamping"><i class="fas fa-calendar-alt"></i> Tanggal Check-in</label>
                                <input type="date" id="tanggal-checkin-glamping" class="form-control" required onchange="updateGlampingByTanggal()">
                            </div>
                            
                            <div class="form-group">
                                <label for="jumlah-malam-glamping"><i class="fas fa-moon"></i> Jumlah Malam</label>
                                <select id="jumlah-malam-glamping" class="form-control" onchange="hitungTotalGlamping()">
                                    <option value="1">1 Malam</option>
                                    <option value="2" selected>2 Malam</option>
                                    <option value="3">3 Malam</option>
                                    <option value="4">4 Malam</option>
                                    <option value="5">5 Malam</option>
                                    <option value="6">6 Malam</option>
                                    <option value="7">7 Malam</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Glamping Selection -->
                        <div class="form-group">
                            <label><i class="fas fa-home"></i> Pilih Unit Glamping (Bisa pilih semua)</label>
                            <div class="alert alert-warning" id="glamping-warning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Beberapa glamping sudah dipesan pada tanggal ini.
                            </div>
                            <div class="form-row" id="glamping-container-reservasi">
                                <!-- Glamping akan di-generate oleh JavaScript -->
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama-pemesan-glamping"><i class="fas fa-user"></i> Nama Pemesan</label>
                                <input type="text" id="nama-pemesan-glamping" class="form-control" placeholder="Nama lengkap pemesan" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="telepon-glamping"><i class="fas fa-phone"></i> No. Telepon</label>
                                <input type="tel" id="telepon-glamping" class="form-control" placeholder="Nomor telepon aktif" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="jumlah-orang-glamping"><i class="fas fa-users"></i> Jumlah Orang</label>
                            <input type="number" id="jumlah-orang-glamping" class="form-control" min="1" max="50" value="4" onchange="hitungTotalGlamping()">
                        </div>
                        
                        <!-- Jenis Pembayaran -->
                        <div class="form-group">
                            <label><i class="fas fa-credit-card"></i> Jenis Pembayaran</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('transfer', 'glamping')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-transfer-glamping" name="payment-glamping" value="transfer">
                                            <label for="payment-transfer-glamping">
                                                <i class="fas fa-university payment-icon"></i> Transfer Bank
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('lokasi', 'glamping')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-lokasi-glamping" name="payment-glamping" value="lokasi" checked>
                                            <label for="payment-lokasi-glamping">
                                                <i class="fas fa-map-marker-alt payment-icon"></i> Bayar di Lokasi
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="payment-option" onclick="selectPayment('sekarang', 'glamping')">
                                        <div class="checkbox-container">
                                            <input type="radio" id="payment-sekarang-glamping" name="payment-glamping" value="sekarang">
                                            <label for="payment-sekarang-glamping">
                                                <i class="fas fa-money-bill-wave payment-icon"></i> Bayar Sekarang
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ringkasan Biaya -->
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-calculator"></i> Ringkasan Biaya</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Biaya Glamping</label>
                                    <div class="form-control" id="biaya-akomodasi-glamping">Rp 0</div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Tiket Masuk (Rp 15.000/orang)</label>
                                    <div class="form-control" id="biaya-tiket-glamping">Rp 0</div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Total Biaya</label>
                                    <div class="form-control" style="font-weight: bold; font-size: 1.1rem;" id="total-biaya-glamping">Rp 0</div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary btn-block" onclick="buatReservasiGlamping()">
                            <i class="fas fa-check-circle"></i> Buat Reservasi Glamping
                        </button>
                    </form>
                </div>
                
                <!-- Tab Content: Sewa Barang -->
                <div id="tab-sewa-barang" class="tab-content">
                    <h2 class="section-title"><i class="fas fa-tools"></i> Sewa Barang Tambahan</h2>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Sewa barang tambahan hanya untuk pelanggan yang sudah melakukan reservasi lapak atau glamping.
                    </div>
                    
                    <form id="form-sewa-barang">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="invoice-sewa-barang"><i class="fas fa-file-invoice"></i> No Invoice Reservasi</label>
                                <select id="invoice-sewa-barang" class="form-control" onchange="loadDataSewaBarang()">
                                    <option value="">Pilih Invoice</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="jumlah-hari-sewa"><i class="fas fa-calendar"></i> Jumlah Hari Sewa</label>
                                <input type="number" id="jumlah-hari-sewa" class="form-control" min="1" max="30" value="1" onchange="hitungTotalSewaBarang()">
                            </div>
                        </div>
                        
                        <!-- Daftar Barang Sewa -->
                        <div class="form-group">
                            <label><i class="fas fa-list"></i> Daftar Barang Sewa</label>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Barang</th>
                                            <th>Harga/Hari</th>
                                            <th>Stok Tersedia</th>
                                            <th>Jumlah</th>
                                            <th>Subtotal</th>
                                        </tr>
                                    </thead>
                                    <tbody id="barang-sewa-list">
                                        <!-- Data barang sewa akan diisi oleh JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Ringkasan Biaya -->
                        <div class="content-section">
                            <h3 class="section-title"><i class="fas fa-calculator"></i> Ringkasan Biaya Sewa Barang</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Total Biaya Sewa Barang</label>
                                    <div class="form-control" style="font-weight: bold; font-size: 1.1rem;" id="total-biaya-sewa-barang">Rp 0</div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary btn-block" onclick="simpanSewaBarang()">
                            <i class="fas fa-check-circle"></i> Simpan Sewa Barang
                        </button>
                    </form>
                </div>
            </section>

            <!-- Status Lapak Section -->
            <section id="lapak-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-map-marked-alt"></i> Visualisasi Status Lapak</h2>
                
                <div class="form-row mb-4">
                    <div class="form-group">
                        <label for="filter-tanggal"><i class="fas fa-calendar-alt"></i> Filter Tanggal</label>
                        <input type="date" id="filter-tanggal" class="form-control" onchange="updateLapakVisualization()">
                    </div>
                    
                    <div class="form-group">
                        <label for="filter-tipe"><i class="fas fa-filter"></i> Filter Tipe</label>
                        <select id="filter-tipe" class="form-control" onchange="updateLapakVisualization()">
                            <option value="semua">Semua Tipe</option>
                            <option value="reguler">Reguler</option>
                            <option value="premium">Premium</option>
                            <option value="dekatView">Dekat View</option>
                            <option value="dekatFasilitas">Dekat Fasilitas</option>
                        </select>
                    </div>
                </div>
                
                <div class="content-section">
                    <h3 class="section-title"><i class="fas fa-campground"></i> Lapak Tenda (Total: 70)</h3>
                    <div class="visualization-grid" id="lapak-visualization">
                        <!-- Visualisasi lapak akan di-generate oleh JavaScript -->
                    </div>
                    <div class="mt-3 text-center">
                        <span class="status-indicator status-tersedia"></span> Tersedia (<span id="count-tersedia">55</span>) 
                        <span class="status-indicator status-terpakai ml-3"></span> Terpakai (<span id="count-terpakai">15</span>)
                        <span class="status-indicator status-dipilih ml-3"></span> Dipilih (<span id="count-dipilih">0</span>)
                    </div>
                </div>
                
                <div class="content-section mt-4">
                    <h3 class="section-title"><i class="fas fa-home"></i> Status Glamping (Total: 10)</h3>
                    <div class="visualization-grid" id="glamping-visualization">
                        <!-- Visualisasi glamping akan di-generate oleh JavaScript -->
                    </div>
                    <div class="mt-3 text-center">
                        <span class="status-indicator status-tersedia"></span> Tersedia 
                        <span class="status-indicator status-terpakai ml-3"></span> Terpakai
                        <span class="status-indicator status-dipilih ml-3"></span> Dipilih
                    </div>
                    
                    <div class="table-responsive mt-4">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Kode Unit</th>
                                    <th>Kapasitas</th>
                                    <th>Harga/Malam</th>
                                    <th>Status</th>
                                    <th>Pemesan</th>
                                    <th>Check-in</th>
                                    <th>Check-out</th>
                                </tr>
                            </thead>
                            <tbody id="glamping-status">
                                <!-- Data glamping akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Invoice Section -->
            <section id="invoice-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Manajemen Invoice</h2>
                
                <div class="text-right mb-3">
                    <button class="btn btn-danger" onclick="hapusInvoiceBulanLalu()">
                        <i class="fas fa-trash"></i> Hapus Invoice Bulan Lalu
                    </button>
                </div>
                
                <div class="form-row mb-4">
                    <div class="form-group">
                        <label for="cari-invoice"><i class="fas fa-search"></i> Cari Invoice</label>
                        <input type="text" id="cari-invoice" class="form-control" placeholder="Masukkan nomor invoice atau nama pemesan" onkeyup="cariInvoice()">
                    </div>
                    
                    <div class="form-group">
                        <label for="filter-status-invoice"><i class="fas fa-filter"></i> Filter Status</label>
                        <select id="filter-status-invoice" class="form-control" onchange="cariInvoice()">
                            <option value="semua">Semua Status</option>
                            <option value="pending">Pending</option>
                            <option value="dibayar">Dibayar</option>
                            <option value="aktif">Aktif</option>
                            <option value="selesai">Selesai</option>
                            <option value="dibatalkan">Dibatalkan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="filter-jenis-invoice"><i class="fas fa-filter"></i> Filter Jenis</label>
                        <select id="filter-jenis-invoice" class="form-control" onchange="cariInvoice()">
                            <option value="semua">Semua Jenis</option>
                            <option value="tenda">Lapak Tenda</option>
                            <option value="glamping">Glamping</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>No Invoice</th>
                                <th>Tanggal</th>
                                <th>Nama Pemesan</th>
                                <th>Telepon</th>
                                <th>Jenis</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-list">
                            <!-- Data invoice akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Laporan Section -->
            <section id="laporan-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> Laporan & Rekapitulasi</h2>
                
                <div class="form-row mb-4">
                    <div class="form-group">
                        <label for="periode-laporan"><i class="fas fa-calendar"></i> Periode Laporan</label>
                        <select id="periode-laporan" class="form-control" onchange="toggleTanggalKustom()">
                            <option value="hari-ini">Hari Ini</option>
                            <option value="minggu-ini">Minggu Ini</option>
                            <option value="bulan-ini" selected>Bulan Ini</option>
                            <option value="kustom">Kustom</option>
                        </select>
                    </div>
                    
                    <div id="tanggal-kustom" class="form-row hidden">
                        <div class="form-group">
                            <label for="tanggal-mulai"><i class="fas fa-calendar-alt"></i> Tanggal Mulai</label>
                            <input type="date" id="tanggal-mulai" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="tanggal-selesai"><i class="fas fa-calendar-alt"></i> Tanggal Selesai</label>
                            <input type="date" id="tanggal-selesai" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="generateLaporan()" style="margin-top: 24px;">
                            <i class="fas fa-sync"></i> Generate Laporan
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-cards mb-4">
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-campground"></i>
                        </div>
                        <div class="card-value" id="lapak-terjual">0</div>
                        <div class="card-label">Lapak Terjual</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="card-value" id="glamping-terjual">0</div>
                        <div class="card-label">Glamping Terjual</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-value" id="total-pengunjung">0</div>
                        <div class="card-label">Total Pengunjung</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="card-value" id="total-omzet">Rp 0</div>
                        <div class="card-label">Total Omzet</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="card-value" id="total-tiket">0</div>
                        <div class="card-label">Tiket Terjual</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="card-value" id="total-barang">0</div>
                        <div class="card-label">Barang Disewa</div>
                    </div>
                </div>
                
                <div class="content-section">
                    <h3 class="section-title"><i class="fas fa-table"></i> Detail Transaksi</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>No Invoice</th>
                                    <th>Nama Pemesan</th>
                                    <th>Jenis</th>
                                    <th>Lapak/Unit</th>
                                    <th>Tiket</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="laporan-detail">
                                <!-- Data laporan akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="text-right mt-3">
                        <button class="btn btn-primary" onclick="downloadPDF()">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                        <button class="btn btn-secondary" onclick="downloadExcel()">
                            <i class="fas fa-file-excel"></i> Download Excel
                        </button>
                    </div>
                </div>
            </section>

            <!-- Pengaturan Section -->
            <section id="pengaturan-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-cog"></i> Pengaturan Sistem</h2>
                
                <div class="alert alert-warning admin-only">
                    <i class="fas fa-exclamation-triangle"></i> Halaman ini hanya dapat diakses oleh Admin.
                </div>
                
                <div class="tabs" id="pengaturan-tabs">
                    <div class="tab active" onclick="showPengaturanTab('harga-lapak')">
                        <i class="fas fa-money-bill"></i> Harga Lapak
                    </div>
                    <div class="tab" onclick="showPengaturanTab('harga-glamping')">
                        <i class="fas fa-home"></i> Harga Glamping
                    </div>
                    <div class="tab" onclick="showPengaturanTab('barang-sewa')">
                        <i class="fas fa-tools"></i> Barang Sewa
                    </div>
                    <div class="tab" onclick="showPengaturanTab('perusahaan')">
                        <i class="fas fa-building"></i> Perusahaan
                    </div>
                    <div class="tab" onclick="showPengaturanTab('waktu')">
                        <i class="fas fa-clock"></i> Waktu
                    </div>
                    <div class="tab" onclick="showPengaturanTab('aturan')">
                        <i class="fas fa-rules"></i> Aturan
                    </div>
                </div>
                
                <!-- Tab Content: Harga Lapak -->
                <div id="tab-harga-lapak" class="tab-content active">
                    <h3 class="section-title"><i class="fas fa-campground"></i> Pengaturan Harga Lapak Tenda</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tipe Lapak</th>
                                    <th>Jumlah Lapak</th>
                                    <th>Harga / Malam</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-harga-lapak">
                                <!-- Data harga lapak akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="simpanPengaturanHarga()">
                            <i class="fas fa-save"></i> Simpan Semua Harga
                        </button>
                    </div>
                </div>
                
                <!-- Tab Content: Harga Glamping -->
                <div id="tab-harga-glamping" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-home"></i> Pengaturan Harga Glamping</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Kode Unit</th>
                                    <th>Kapasitas</th>
                                    <th>Harga/Malam</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-harga-glamping">
                                <!-- Data harga glamping akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="simpanPengaturanHargaGlamping()">
                            <i class="fas fa-save"></i> Simpan Semua Harga Glamping
                        </button>
                    </div>
                </div>
                
                <!-- Tab Content: Barang Sewa -->
                <div id="tab-barang-sewa" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-tools"></i> Pengaturan Barang Sewa & Produk</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Barang/Produk</th>
                                    <th>Harga/Hari</th>
                                    <th>Satuan</th>
                                    <th>Stok</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pengaturan-barang">
                                <!-- Data barang akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="tambahBarang()">
                            <i class="fas fa-plus"></i> Tambah Barang Baru
                        </button>
                    </div>
                </div>
                
                <!-- Tab Content: Perusahaan -->
                <div id="tab-perusahaan" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-building"></i> Pengaturan Detail Perusahaan</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nama-perusahaan">Nama Perusahaan</label>
                            <input type="text" id="nama-perusahaan" class="form-control" value="Bukit Sampalan Asri">
                        </div>
                        
                        <div class="form-group">
                            <label for="alamat-perusahaan">Alamat</label>
                            <textarea id="alamat-perusahaan" class="form-control" rows="3">Desa Sampalan, Kecamatan ...</textarea>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="telepon-perusahaan">Telepon</label>
                            <input type="text" id="telepon-perusahaan" class="form-control" value="(0361) 123456">
                        </div>
                        
                        <div class="form-group">
                            <label for="email-perusahaan">Email</label>
                            <input type="email" id="email-perusahaan" class="form-control" value="info@bukitsampalanasri.com">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="website-perusahaan">Website</label>
                            <input type="text" id="website-perusahaan" class="form-control" value="www.bukitsampalanasri.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="harga-tiket">Harga Tiket Masuk per Orang</label>
                            <input type="number" id="harga-tiket" class="form-control" value="15000" min="0">
                        </div>
                    </div>
                    
                    <!-- Informasi Bank -->
                    <div class="content-section mt-3">
                        <h4 class="section-title"><i class="fas fa-university"></i> Informasi Bank (Untuk Transfer)</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="bank-perusahaan">Nama Bank</label>
                                <input type="text" id="bank-perusahaan" class="form-control" value="Bank BRI">
                            </div>
                            
                            <div class="form-group">
                                <label for="norek-perusahaan">Nomor Rekening</label>
                                <input type="text" id="norek-perusahaan" class="form-control" value="4045 0100 1680 532">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="an-rekening">Atas Nama Rekening</label>
                                <input type="text" id="an-rekening" class="form-control" value="Sunarya">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informasi Pemandu dan Layanan -->
                    <div class="content-section mt-3">
                        <h4 class="section-title"><i class="fas fa-headset"></i> Informasi Pemandu & Layanan</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama-pemandu">Nama Pemandu</label>
                                <input type="text" id="nama-pemandu" class="form-control" value="Ikhsan & Ade Kurnia">
                            </div>
                            
                            <div class="form-group">
                                <label for="no-layanan">Nomor Layanan</label>
                                <input type="text" id="no-layanan" class="form-control" value="0812-3456-7890">
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary mt-3" onclick="simpanPengaturanPerusahaan()">
                        <i class="fas fa-save"></i> Simpan Pengaturan Perusahaan
                    </button>
                </div>
                
                <!-- Tab Content: Waktu -->
                <div id="tab-waktu" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-clock"></i> Pengaturan Waktu Operasional</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="checkin-time">Jam Check-in</label>
                            <input type="time" id="checkin-time" class="form-control" value="14:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="checkout-time">Jam Check-out</label>
                            <input type="time" id="checkout-time" class="form-control" value="12:00">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="operational-start">Jam Buka Operasional</label>
                            <input type="time" id="operational-start" class="form-control" value="08:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="operational-end">Jam Tutup Operasional</label>
                            <input type="time" id="operational-end" class="form-control" value="22:00">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary mt-3" onclick="simpanPengaturanWaktu()">
                        <i class="fas fa-save"></i> Simpan Pengaturan Waktu
                    </button>
                </div>
                
                <!-- Tab Content: Aturan -->
                <div id="tab-aturan" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-rules"></i> Aturan Reservasi</h3>
                    
                    <div class="form-group">
                        <label for="max-lapak-reservasi">Maksimal Lapak per Reservasi</label>
                        <input type="number" id="max-lapak-reservasi" class="form-control" min="1" max="70" value="30">
                        <small class="text-muted">Jumlah maksimal lapak yang dapat dipilih dalam satu reservasi</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="min-reservasi-hari">Minimal Hari Reservasi</label>
                        <input type="number" id="min-reservasi-hari" class="form-control" min="1" max="30" value="1">
                        <small class="text-muted">Jumlah minimal malam untuk reservasi</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="max-reservasi-hari">Maksimal Hari Reservasi</label>
                        <input type="number" id="max-reservasi-hari" class="form-control" min="1" max="30" value="7">
                        <small class="text-muted">Jumlah maksimal malam untuk reservasi</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="denda-keterlambatan">Denda Keterlambatan Check-out (per jam)</label>
                        <input type="number" id="denda-keterlambatan" class="form-control" min="0" value="50000">
                        <small class="text-muted">Denda yang dikenakan jika check-out melebihi waktu yang ditentukan</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="dp-percentage">Persentase DP (Down Payment)</label>
                        <input type="number" id="dp-percentage" class="form-control" min="0" max="100" value="50">
                        <small class="text-muted">Persentase pembayaran awal yang harus dibayarkan untuk konfirmasi reservasi</small>
                    </div>
                    
                    <button class="btn btn-primary mt-3" onclick="simpanPengaturanAturan()">
                        <i class="fas fa-save"></i> Simpan Pengaturan Aturan
                    </button>
                </div>
            </section>

            <!-- Users Management Section -->
            <section id="users-section" class="content-section hidden">
                <h2 class="section-title"><i class="fas fa-users"></i> Manajemen Pengguna</h2>
                
                <div class="alert alert-warning admin-only">
                    <i class="fas fa-exclamation-triangle"></i> Halaman ini hanya dapat diakses oleh Admin.
                </div>
                
                <div class="text-right mb-3">
                    <button class="btn btn-primary" onclick="tambahUserModal()">
                        <i class="fas fa-user-plus"></i> Tambah Pengguna Baru
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Nama Lengkap</th>
                                <th>Role</th>
                                <th>Tanggal Dibuat</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="users-list">
                            <!-- Data pengguna akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Hak Akses -->
                <div class="content-section mt-4">
                    <h3 class="section-title"><i class="fas fa-user-shield"></i> Hak Akses per Role</h3>
                    
                    <div class="access-control">
                        <div class="access-item">
                            <span><strong>Admin</strong></span>
                            <span>Akses penuh ke semua fitur</span>
                        </div>
                        <div class="access-item">
                            <span><strong>Manager</strong></span>
                            <span>Bisa buat reservasi, lihat laporan, kelola invoice</span>
                        </div>
                        <div class="access-item">
                            <span><strong>Staff</strong></span>
                            <span>Hanya bisa buat reservasi dan lihat dashboard</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3 id="footer-nama-perusahaan">Bukit Sampalan Asri</h3>
                        <p id="footer-deskripsi-perusahaan">Sistem Reservasi Kemah Keluarga yang tertib, transparan, dan ramah keluarga.</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Kontak & Layanan</h3>
                        <p><i class="fas fa-map-marker-alt"></i> <span id="footer-alamat">Desa Sampalan, Kecamatan ...</span></p>
                        <p><i class="fas fa-phone"></i> <span id="footer-telepon">(0361) 123456</span></p>
                        <p><i class="fas fa-headset"></i> Layanan: <span id="footer-layanan">0812-9639-2270</span></p>
                        <p><i class="fas fa-user"></i> Pemandu: <span id="footer-pemandu">Ikhsan & Ade Kurnia</span></p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Jam Operasional</h3>
                        <p>Setiap Hari: <span id="footer-jam-buka">08:00</span> - <span id="footer-jam-tutup">22:00</span> WIB</p>
                        <p>Check-in: <span id="footer-checkin">14:00</span> WIB</p>
                        <p>Check-out: <span id="footer-checkout">12:00</span> WIB</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Pembayaran</h3>
                        <p><i class="fas fa-university"></i> <span id="footer-bank">Bank BRI</span></p>
                        <p>No. Rek: <span id="footer-norek">4045 0100 1680-532</span></p>
                        <p>a.n. <span id="footer-an-rekening">Sunarya</span></p>
                    </div>
                </div>
                
                <div class="copyright">
                    &copy; <span id="current-year">2023</span> <span id="copyright-nama">Pokdarwis Bukit Sampalan Asri</span>. Hak Cipta Dilindungi.
                </div>
            </div>
        </footer>

        <!-- Invoice Modal -->
        <div id="invoice-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-file-invoice-dollar"></i> Detail Invoice</h2>
                    <button class="modal-close" onclick="closeInvoiceModal()">&times;</button>
                </div>
                <div id="invoice-modal-body">
                    <!-- Invoice content will be loaded here -->
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-primary" onclick="cetakInvoicePDF()">
                        <i class="fas fa-print"></i> Cetak / Download PDF
                    </button>
                    <button class="btn btn-secondary" onclick="closeInvoiceModal()">
                        <i class="fas fa-times"></i> Tutup
                    </button>
                </div>
            </div>
        </div>

        <!-- User Management Modal -->
        <div id="user-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-user-edit"></i> <span id="user-modal-title">Tambah Pengguna Baru</span></h2>
                    <button class="modal-close" onclick="closeUserModal()">&times;</button>
                </div>
                <div id="user-modal-body">
                    <!-- User form will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div id="loading-modal" class="modal">
            <div class="modal-content" style="text-align: center;">
                <div class="spinner"></div>
                <p>Memproses...</p>
            </div>
        </div>
    </div>

    <script>
        // Data aplikasi - Disimpan di localStorage
        let dataApp = {
            lapakTenda: [],
            glamping: [],
            barangSewa: [],
            reservasi: [],
            invoice: [],
            pengaturan: {
                perusahaan: {
                    nama: "Bukit Sampalan Asri",
                    alamat: "Desa Sukamaju Cihaurbeuti Ciamis Jawa Barat",
                    telepon: "+62 895-2601-3545",
                    email: "bukitsampalanasri.com",
                    website: "www.bukitsampalanasri.com",
                    hargaTiket: 15000,
                    bank: "Bank BRI",
                    norek: "4045 0100 1680 532",
                    anRekening: "Sunarya",
                    namaPemandu: "Ikhsan & Ade Kurnia",
                    noLayanan: "+62 812-9639-2270"
                },
                hargaLapak: {
                    reguler: { harga: 50000, jumlah: 30 },
                    premium: { harga: 75000, jumlah: 10 },
                    dekatView: { harga: 100000, jumlah: 15 },
                    dekatFasilitas: { harga: 80000, jumlah: 15 }
                },
                maxLapakPerReservasi: 30,
                minReservasiHari: 1,
                maxReservasiHari: 7,
                jamCheckin: "14:00",
                jamCheckout: "12:00",
                jamOperasionalStart: "08:00",
                jamOperasionalEnd: "22:00",
                dendaKeterlambatan: 50000,
                dpPercentage: 30
            },
            laporan: [],
            user: null,
            users: [
                { 
                    id: 1, 
                    username: "admin", 
                    password: "admin123", 
                    nama: "Administrator", 
                    role: "admin",
                    createdAt: "2024-01-01",
                    active: true
                },
                { 
                    id: 2, 
                    username: "manager", 
                    password: "manager123", 
                    nama: "Manager Operasional", 
                    role: "manager",
                    createdAt: "2024-01-01",
                    active: true
                },
                { 
                    id: 3, 
                    username: "staff", 
                    password: "staff123", 
                    nama: "Staff Front Office", 
                    role: "staff",
                    createdAt: "2024-01-01",
                    active: true
                }
            ]
        };

        // Current selected payment method
        let selectedPayment = {
            tenda: 'lokasi',
            glamping: 'lokasi'
        };

        // Inisialisasi data
        function initData() {
            // Load data dari localStorage jika ada
            loadFromLocalStorage();
            
            // Jika data kosong, inisialisasi dengan data default
            if (dataApp.lapakTenda.length === 0) {
                initDefaultData();
            }
            
            // Update tampilan berdasarkan role user
            updateUIByRole();
            
            // Update tampilan
            updateDashboard();
            generateLapakSelection();
            generateGlampingSelection();
            generateLapakVisualization();
            generateGlampingVisualization();
            generateInvoiceList();
            generatePengaturanHargaLapak();
            generatePengaturanHargaGlamping();
            generatePengaturanBarang();
            loadInvoiceOptions();
            updateFooterInfo();
            generateUsersList();
            
            // Set tanggal default
            const today = new Date();
            const todayFormatted = formatDate(today);
            document.getElementById('tanggal-checkin-tenda').value = todayFormatted;
            document.getElementById('tanggal-checkin-tenda').min = todayFormatted;
            document.getElementById('tanggal-checkin-glamping').value = todayFormatted;
            document.getElementById('tanggal-checkin-glamping').min = todayFormatted;
            document.getElementById('filter-tanggal').value = todayFormatted;
            document.getElementById('current-year').textContent = today.getFullYear();
            
            // Update info max lapak
            document.getElementById('max-lapak-info').textContent = dataApp.pengaturan.maxLapakPerReservasi;
            document.getElementById('max-lapak-reservasi').value = dataApp.pengaturan.maxLapakPerReservasi;
            
            // Update pengaturan perusahaan
            document.getElementById('nama-perusahaan').value = dataApp.pengaturan.perusahaan.nama;
            document.getElementById('alamat-perusahaan').value = dataApp.pengaturan.perusahaan.alamat;
            document.getElementById('telepon-perusahaan').value = dataApp.pengaturan.perusahaan.telepon;
            document.getElementById('email-perusahaan').value = dataApp.pengaturan.perusahaan.email;
            document.getElementById('website-perusahaan').value = dataApp.pengaturan.perusahaan.website;
            document.getElementById('harga-tiket').value = dataApp.pengaturan.perusahaan.hargaTiket;
            document.getElementById('bank-perusahaan').value = dataApp.pengaturan.perusahaan.bank;
            document.getElementById('norek-perusahaan').value = dataApp.pengaturan.perusahaan.norek;
            document.getElementById('an-rekening').value = dataApp.pengaturan.perusahaan.anRekening;
            document.getElementById('nama-pemandu').value = dataApp.pengaturan.perusahaan.namaPemandu;
            document.getElementById('no-layanan').value = dataApp.pengaturan.perusahaan.noLayanan;
            
            // Set default payment method
            document.getElementById('payment-lokasi-tenda').checked = true;
            document.getElementById('payment-lokasi-glamping').checked = true;
            
            // Set user avatar
            updateUserAvatar();
        }
        
        // Inisialisasi data default
        function initDefaultData() {
            let idCounter = 1;
            
            // Lapak reguler (30 lapak) - nomor 1-70
            for (let i = 1; i <= dataApp.pengaturan.hargaLapak.reguler.jumlah; i++) {
                dataApp.lapakTenda.push({
                    id: idCounter++,
                    kode: "L" + i.toString().padStart(2, '0'),
                    tipe: "reguler",
                    status: "tersedia",
                    harga: dataApp.pengaturan.hargaLapak.reguler.harga
                });
            }
            
            // Lapak premium (10 lapak) - nomor 31-40
            for (let i = 1; i <= dataApp.pengaturan.hargaLapak.premium.jumlah; i++) {
                dataApp.lapakTenda.push({
                    id: idCounter++,
                    kode: "L" + (30 + i).toString().padStart(2, '0'),
                    tipe: "premium",
                    status: "tersedia",
                    harga: dataApp.pengaturan.hargaLapak.premium.harga
                });
            }
            
            // Lapak dekat view (15 lapak) - nomor 41-55
            for (let i = 1; i <= dataApp.pengaturan.hargaLapak.dekatView.jumlah; i++) {
                dataApp.lapakTenda.push({
                    id: idCounter++,
                    kode: "L" + (40 + i).toString().padStart(2, '0'),
                    tipe: "dekatView",
                    status: "tersedia",
                    harga: dataApp.pengaturan.hargaLapak.dekatView.harga
                });
            }
            
            // Lapak dekat fasilitas (15 lapak) - nomor 56-70
            for (let i = 1; i <= dataApp.pengaturan.hargaLapak.dekatFasilitas.jumlah; i++) {
                dataApp.lapakTenda.push({
                    id: idCounter++,
                    kode: "L" + (55 + i).toString().padStart(2, '0'),
                    tipe: "dekatFasilitas",
                    status: "tersedia",
                    harga: dataApp.pengaturan.hargaLapak.dekatFasilitas.harga
                });
            }
            
            // Inisialisasi glamping (10 unit) - Glamping bambu harga 150000
            dataApp.glamping = [
                { id: 1, kode: "G01", kapasitas: 4, harga: 150000, status: "tersedia" },
                { id: 2, kode: "G02", kapasitas: 4, harga: 150000, status: "tersedia" },
                { id: 3, kode: "G03", kapasitas: 6, harga: 150000, status: "tersedia" },
                { id: 4, kode: "G04", kapasitas: 6, harga: 150000, status: "tersedia" },
                { id: 5, kode: "G05", kapasitas: 2, harga: 150000, status: "tersedia" },
                { id: 6, kode: "G06", kapasitas: 4, harga: 150000, status: "tersedia" },
                { id: 7, kode: "G07", kapasitas: 4, harga: 150000, status: "tersedia" },
                { id: 8, kode: "G08", kapasitas: 6, harga: 150000, status: "tersedia" },
                { id: 9, kode: "G09", kapasitas: 6, harga: 150000, status: "tersedia" },
                { id: 10, kode: "G10", kapasitas: 2, harga: 150000, status: "tersedia" }
            ];
            
            // Inisialisasi barang sewa
            dataApp.barangSewa = [
                { id: 1, nama: "Tenda Besar (4 orang)", harga: 50000, satuan: "hari", stok: 20 },
                { id: 2, nama: "Matras", harga: 15000, satuan: "hari", stok: 50 },
                { id: 3, nama: "Sleeping Bag", harga: 10000, satuan: "hari", stok: 40 },
                { id: 4, nama: "Kompor Portable", harga: 25000, satuan: "hari", stok: 15 },
                { id: 5, nama: "Kayu Bakar (1 pack)", harga: 30000, satuan: "pack", stok: 100 },
                { id: 6, nama: "Kopi Sampalan (200gr)", harga: 35000, satuan: "pcs", stok: 50 },
                { id: 7, nama: "Snack Paket Keluarga", harga: 45000, satuan: "paket", stok: 30 }
            ];
            
            // Simpan data default ke localStorage
            saveToLocalStorage();
        }
        
        // Format tanggal ke YYYY-MM-DD
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();
            
            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;
            
            return [year, month, day].join('-');
        }
        
        // Format angka ke Rupiah
        function formatRupiah(angka) {
            return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        // Parse Rupiah ke angka
        function parseRupiah(rupiah) {
            return parseInt(rupiah.replace(/[^0-9]/g, ''));
        }
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            const nav = document.getElementById('main-nav');
            nav.classList.toggle('active');
        }
        
        // Update UI berdasarkan role user
        function updateUIByRole() {
            const user = dataApp.user;
            if (!user) return;
            
            const adminOnlyElements = document.querySelectorAll('.admin-only');
            const managerOnlyElements = document.querySelectorAll('.manager-only');
            
            // Sembunyikan semua elemen khusus role dulu
            adminOnlyElements.forEach(el => {
                el.style.display = 'none';
            });
            
            managerOnlyElements.forEach(el => {
                el.style.display = 'none';
            });
            
            // Tampilkan berdasarkan role
            if (user.role === 'admin') {
                adminOnlyElements.forEach(el => {
                    el.style.display = '';
                });
                managerOnlyElements.forEach(el => {
                    el.style.display = '';
                });
            } else if (user.role === 'manager') {
                managerOnlyElements.forEach(el => {
                    el.style.display = '';
                });
            }
            
            // Update user info
            document.getElementById('current-user').textContent = user.nama;
            document.getElementById('user-role').textContent = user.role.toUpperCase();
            
            // Set avatar
            updateUserAvatar();
        }
        
        // Update user avatar
        function updateUserAvatar() {
            const user = dataApp.user;
            if (!user) return;
            
            const avatar = document.getElementById('user-avatar');
            if (avatar) {
                const initials = user.nama.split(' ').map(n => n[0]).join('').toUpperCase();
                avatar.textContent = initials.substring(0, 2);
                
                // Set warna berdasarkan role
                if (user.role === 'admin') {
                    avatar.style.backgroundColor = '#9c27b0';
                } else if (user.role === 'manager') {
                    avatar.style.backgroundColor = '#2196f3';
                } else {
                    avatar.style.backgroundColor = '#ff9800';
                }
            }
        }
        
        // Tampilkan section berdasarkan pilihan menu
        function showSection(sectionId) {
            // Tutup mobile menu jika terbuka
            const nav = document.getElementById('main-nav');
            nav.classList.remove('active');
            
            // Cek hak akses
            const user = dataApp.user;
            if (!user) return;
            
            // Cek akses untuk pengaturan dan users
            if ((sectionId === 'pengaturan' || sectionId === 'users') && user.role !== 'admin') {
                alert('Hanya Admin yang dapat mengakses halaman ini!');
                return;
            }
            
            // Sembunyikan semua section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Tampilkan section yang dipilih
            document.getElementById(sectionId + '-section').classList.remove('hidden');
            
            // Update menu aktif
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Aktifkan menu yang sesuai
            const activeLink = document.querySelector(`nav a[onclick*="${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // Jika section lapak, update visualisasi
            if (sectionId === 'lapak') {
                updateLapakVisualization();
            }
            
            // Jika section reservasi, set tab default
            if (sectionId === 'reservasi') {
                showReservasiTab('tenda');
            }
            
            // Jika section laporan, set tanggal default
            if (sectionId === 'laporan') {
                const today = new Date();
                document.getElementById('tanggal-mulai').value = formatDate(new Date(today.getFullYear(), today.getMonth(), 1));
                document.getElementById('tanggal-selesai').value = formatDate(today);
                generateLaporan(); // Auto generate laporan bulan ini
            }
            
            // Jika section dashboard, update data
            if (sectionId === 'dashboard') {
                updateDashboard();
            }
            
            // Jika section pengaturan, set tab default
            if (sectionId === 'pengaturan') {
                showPengaturanTab('harga-lapak');
            }
            
            // Jika section users, update list
            if (sectionId === 'users') {
                generateUsersList();
            }
        }
        
        // Tampilkan tab reservasi
        function showReservasiTab(tabId) {
            // Update tabs
            document.querySelectorAll('#reservasi-tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const tabElement = document.querySelector(`#reservasi-tabs .tab[onclick*="${tabId}"]`);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // Update tab content
            document.querySelectorAll('#reservasi-section .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            // Jika tab tenda, update lapak berdasarkan tanggal
            if (tabId === 'tenda') {
                updateLapakByTanggal();
            }
            
            // Jika tab glamping, update glamping berdasarkan tanggal
            if (tabId === 'glamping') {
                updateGlampingByTanggal();
            }
            
            // Jika tab sewa barang, load data
            if (tabId === 'sewa-barang') {
                loadInvoiceOptions();
            }
        }
        
        // Tampilkan tab pengaturan
        function showPengaturanTab(tabId) {
            // Update tabs
            document.querySelectorAll('#pengaturan-tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const tabElement = document.querySelector(`#pengaturan-tabs .tab[onclick*="${tabId}"]`);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            
            // Update tab content
            document.querySelectorAll('#pengaturan-section .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }
        
        // Select payment method
        function selectPayment(method, type) {
            selectedPayment[type] = method;
            
            // Update radio button
            document.getElementById(`payment-${method}-${type}`).checked = true;
            
            // Update visual selection
            document.querySelectorAll(`#tab-${type} .payment-option`).forEach(option => {
                option.classList.remove('selected');
            });
            
            const selectedOption = document.querySelector(`#payment-${method}-${type}`).closest('.payment-option');
            if (selectedOption) {
                selectedOption.classList.add('selected');
            }
        }
        
        // Update dashboard
        function updateDashboard() {
            // Hitung statistik
            const lapakTersedia = dataApp.lapakTenda.filter(l => l.status === "tersedia").length;
            const lapakTerpakai = dataApp.lapakTenda.filter(l => l.status === "terpakai").length;
            const glampingTerpakai = dataApp.glamping.filter(g => g.status === "terpakai").length;
            
            // Update card values
            document.getElementById('lapak-tersedia').textContent = lapakTersedia;
            document.getElementById('lapak-terpakai').textContent = lapakTerpakai;
            document.getElementById('glamping-terpakai').textContent = glampingTerpakai;
            
            // Hitung pengunjung hari ini dan omzet
            const today = formatDate(new Date());
            const reservasiHariIni = dataApp.reservasi.filter(r => r.tanggalCheckin === today);
            let pengunjungHariIni = 0;
            let omzetHarian = 0;
            
            reservasiHariIni.forEach(r => {
                pengunjungHariIni += r.jumlahOrang;
                omzetHarian += r.totalBiaya;
            });
            
            document.getElementById('pengunjung-hari-ini').textContent = pengunjungHariIni;
            document.getElementById('omzet-harian').textContent = formatRupiah(omzetHarian);
            document.getElementById('reservasi-hari-ini-count').textContent = reservasiHariIni.length;
            
            // Update tabel reservasi hari ini
            const tbody = document.getElementById('reservasi-hari-ini');
            tbody.innerHTML = '';
            
            reservasiHariIni.forEach(reservasi => {
                const row = document.createElement('tr');
                
                // Status badge
                let statusBadge = '';
                if (reservasi.status === 'aktif') {
                    statusBadge = '<span class="badge badge-success">Aktif</span>';
                } else if (reservasi.status === 'dibayar') {
                    statusBadge = '<span class="badge badge-warning">Dibayar</span>';
                } else if (reservasi.status === 'pending') {
                    statusBadge = '<span class="badge badge-warning">Pending</span>';
                } else if (reservasi.status === 'selesai') {
                    statusBadge = '<span class="badge badge-success">Selesai</span>';
                } else {
                    statusBadge = '<span class="badge badge-danger">Dibatalkan</span>';
                }
                
                // Tampilkan lapak atau glamping
                let lapakUnit = '';
                if (reservasi.jenis === 'tenda') {
                    lapakUnit = reservasi.lapak.join(', ');
                } else {
                    // Jika glamping adalah array, gabungkan
                    if (Array.isArray(reservasi.glamping)) {
                        lapakUnit = reservasi.glamping.join(', ');
                    } else {
                        lapakUnit = reservasi.glamping || '-';
                    }
                }
                
                row.innerHTML = `
                    <td>${reservasi.invoice}</td>
                    <td>${reservasi.nama}</td>
                    <td>${lapakUnit}</td>
                    <td>${reservasi.tanggalCheckin}</td>
                    <td>${reservasi.tanggalCheckout}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="tampilkanInvoiceModal('${reservasi.invoice}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Generate pilihan lapak untuk reservasi
        function generateLapakSelection() {
            const container = document.getElementById('lapak-container-tenda');
            container.innerHTML = '';
            
            let lapakDipilihCount = 0;
            
            dataApp.lapakTenda.forEach(lapak => {
                const lapakEl = document.createElement('div');
                lapakEl.className = `lapak-item ${lapak.status === 'tersedia' ? 'lapak-tersedia' : lapak.status === 'terpakai' ? 'lapak-terpakai' : 'lapak-dipilih'}`;
                lapakEl.textContent = lapak.kode;
                
                // Tambahkan tooltip
                const tooltip = document.createElement('div');
                tooltip.className = 'lapak-tooltip';
                tooltip.textContent = `Lapak ${lapak.kode} - Tipe: ${lapak.tipe}`;
                lapakEl.appendChild(tooltip);
                
                // Hitung lapak yang sudah dipilih
                if (lapak.status === 'dipilih') {
                    lapakDipilihCount++;
                }
                
                // Hanya lapak tersedia yang bisa dipilih
                if (lapak.status === 'tersedia' || lapak.status === 'dipilih') {
                    lapakEl.addEventListener('click', () => {
                        // Toggle pilihan lapak
                        if (lapakEl.classList.contains('lapak-dipilih')) {
                            lapakEl.classList.remove('lapak-dipilih');
                            lapakEl.classList.add('lapak-tersedia');
                            lapak.status = 'tersedia';
                            lapakDipilihCount--;
                        } else {
                            // Cek batas maksimal lapak
                            if (lapakDipilihCount < dataApp.pengaturan.maxLapakPerReservasi) {
                                lapakEl.classList.remove('lapak-tersedia');
                                lapakEl.classList.add('lapak-dipilih');
                                lapak.status = 'dipilih';
                                lapakDipilihCount++;
                            } else {
                                // Tampilkan peringatan
                                document.getElementById('lapak-warning').style.display = 'block';
                                setTimeout(() => {
                                    document.getElementById('lapak-warning').style.display = 'none';
                                }, 3000);
                                return;
                            }
                        }
                        
                        // Update count
                        document.getElementById('lapak-dipilih-count').textContent = lapakDipilihCount;
                        hitungTotalTenda();
                    });
                }
                
                container.appendChild(lapakEl);
            });
            
            // Update count
            document.getElementById('lapak-dipilih-count').textContent = lapakDipilihCount;
        }
        
        // Generate pilihan glamping untuk reservasi (multi-select)
        function generateGlampingSelection() {
            const container = document.getElementById('glamping-container-reservasi');
            container.innerHTML = '';
            
            dataApp.glamping.forEach(glamping => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.flex = '1';
                div.style.minWidth = '150px';
                
                // Tentukan status untuk tampilan
                let statusClass = '';
                let statusText = '';
                let isDisabled = false;
                
                if (glamping.status === 'tersedia' || glamping.status === 'dipilih') {
                    if (glamping.status === 'dipilih') {
                        statusClass = 'selected';
                        statusText = 'Dipilih';
                    } else {
                        statusText = 'Tersedia';
                    }
                } else if (glamping.status === 'terpakai') {
                    statusClass = 'disabled';
                    statusText = 'Terpakai';
                    isDisabled = true;
                }
                
                div.innerHTML = `
                    <div class="glamping-option ${statusClass} ${isDisabled ? 'disabled' : ''}" 
                         onclick="${!isDisabled ? `pilihGlamping(${glamping.id})` : ''}">
                        <div class="checkbox-container">
                            <input type="checkbox" id="glamping-${glamping.id}" 
                                   ${glamping.status === 'dipilih' ? 'checked' : ''} 
                                   ${isDisabled ? 'disabled' : ''}
                                   onchange="${!isDisabled ? `toggleGlampingSelection(${glamping.id})` : ''}">
                            <label for="glamping-${glamping.id}">${glamping.kode}</label>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <div style="font-size: 1.5rem; margin-bottom: 5px;">
                                <i class="fas fa-home"></i>
                            </div>
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">Kapasitas: ${glamping.kapasitas} orang</div>
                            <div style="font-size: 0.9rem; margin-bottom: 10px;">${formatRupiah(glamping.harga)}/malam</div>
                            <div style="font-size: 0.8rem; padding: 5px; border-radius: 4px; 
                                 background-color: ${glamping.status === 'tersedia' ? '#4caf50' : 
                                                   glamping.status === 'dipilih' ? '#ffc107' : '#f44336'}; 
                                 color: ${glamping.status === 'dipilih' ? '#333' : 'white'}">
                                ${statusText}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }
        
        // Toggle pilihan glamping
        function toggleGlampingSelection(id) {
            const glamping = dataApp.glamping.find(g => g.id === id);
            const checkbox = document.getElementById(`glamping-${id}`);
            
            if (glamping && checkbox) {
                if (checkbox.checked && glamping.status === 'tersedia') {
                    glamping.status = 'dipilih';
                } else if (!checkbox.checked && glamping.status === 'dipilih') {
                    glamping.status = 'tersedia';
                }
                
                // Update tampilan
                generateGlampingSelection();
                hitungTotalGlamping();
            }
        }
        
        // Pilih glamping untuk reservasi (untuk klik pada card)
        function pilihGlamping(id) {
            const glamping = dataApp.glamping.find(g => g.id === id);
            const checkbox = document.getElementById(`glamping-${id}`);
            
            if (glamping && checkbox) {
                // Toggle checkbox
                checkbox.checked = !checkbox.checked;
                
                // Update status glamping
                if (checkbox.checked && glamping.status === 'tersedia') {
                    glamping.status = 'dipilih';
                } else if (!checkbox.checked && glamping.status === 'dipilih') {
                    glamping.status = 'tersedia';
                }
                
                // Update tampilan
                generateGlampingSelection();
                hitungTotalGlamping();
            }
        }
        
        // Update status lapak berdasarkan tanggal yang dipilih
        function updateLapakByTanggal() {
            const tanggal = document.getElementById('tanggal-checkin-tenda').value;
            
            if (!tanggal) return;
            
            // Reset semua lapak menjadi tersedia (kecuali yang benar-benar terpakai permanen)
            dataApp.lapakTenda.forEach(lapak => {
                if (lapak.status === 'dipilih') {
                    lapak.status = "tersedia";
                }
            });
            
            // Tandai lapak yang sudah dipesan pada tanggal tersebut
            dataApp.reservasi.forEach(reservasi => {
                if (reservasi.tanggalCheckin === tanggal && reservasi.jenis === 'tenda' && 
                    (reservasi.status === 'aktif' || reservasi.status === 'dibayar' || reservasi.status === 'pending')) {
                    reservasi.lapak.forEach(kodeLapak => {
                        const lapak = dataApp.lapakTenda.find(l => l.kode === kodeLapak);
                        if (lapak) {
                            lapak.status = "terpakai";
                        }
                    });
                }
            });
            
            // Update tampilan lapak
            generateLapakSelection();
            hitungTotalTenda();
        }
        
        // Update status glamping berdasarkan tanggal yang dipilih
        function updateGlampingByTanggal() {
            const tanggal = document.getElementById('tanggal-checkin-glamping').value;
            
            if (!tanggal) return;
            
            // Reset semua glamping yang dipilih menjadi tersedia
            dataApp.glamping.forEach(glamping => {
                if (glamping.status === 'dipilih') {
                    glamping.status = "tersedia";
                }
            });
            
            // Tandai glamping yang sudah dipesan pada tanggal tersebut
            dataApp.reservasi.forEach(reservasi => {
                if (reservasi.tanggalCheckin === tanggal && reservasi.jenis === 'glamping' && 
                    (reservasi.status === 'aktif' || reservasi.status === 'dibayar' || reservasi.status === 'pending')) {
                    
                    // Handle both array and single glamping (for backward compatibility)
                    const glampingCodes = Array.isArray(reservasi.glamping) ? 
                        reservasi.glamping : [reservasi.glamping];
                    
                    glampingCodes.forEach(kodeGlamping => {
                        const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                        if (glamping) {
                            glamping.status = "terpakai";
                        }
                    });
                }
            });
            
            // Update tampilan glamping
            generateGlampingSelection();
            hitungTotalGlamping();
            
            // Tampilkan peringatan jika ada glamping yang sudah terpakai
            const glampingTerpakai = dataApp.glamping.filter(g => g.status === 'terpakai').length;
            if (glampingTerpakai > 0) {
                document.getElementById('glamping-warning').style.display = 'block';
                document.getElementById('glamping-warning').innerHTML = 
                    `<i class="fas fa-exclamation-triangle"></i> ${glampingTerpakai} glamping sudah dipesan pada tanggal ini.`;
            } else {
                document.getElementById('glamping-warning').style.display = 'none';
            }
        }
        
        // Hitung total biaya untuk tenda
        function hitungTotalTenda() {
            const jumlahMalam = parseInt(document.getElementById('jumlah-malam-tenda').value);
            const jumlahOrang = parseInt(document.getElementById('jumlah-orang-tenda').value);
            
            let biayaAkomodasi = 0;
            
            // Hitung biaya akomodasi dari lapak yang dipilih
            const lapakDipilih = dataApp.lapakTenda.filter(l => l.status === 'dipilih');
            
            // Hitung harga per malam
            lapakDipilih.forEach(lapak => {
                biayaAkomodasi += lapak.harga * jumlahMalam;
            });
            
            // Hitung biaya tiket masuk
            const biayaTiket = jumlahOrang * jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            const total = biayaAkomodasi + biayaTiket;
            
            // Update tampilan
            document.getElementById('biaya-akomodasi-tenda').textContent = formatRupiah(biayaAkomodasi);
            document.getElementById('biaya-tiket-tenda').textContent = formatRupiah(biayaTiket);
            document.getElementById('total-biaya-tenda').textContent = formatRupiah(total);
        }
        
        // Hitung total biaya untuk glamping
        function hitungTotalGlamping() {
            const jumlahMalam = parseInt(document.getElementById('jumlah-malam-glamping').value);
            const jumlahOrang = parseInt(document.getElementById('jumlah-orang-glamping').value);
            
            let biayaAkomodasi = 0;
            
            // Hitung biaya akomodasi dari semua glamping yang dipilih
            const glampingDipilih = dataApp.glamping.filter(g => g.status === 'dipilih');
            glampingDipilih.forEach(glamping => {
                biayaAkomodasi += glamping.harga * jumlahMalam;
            });
            
            // Hitung biaya tiket masuk
            const biayaTiket = jumlahOrang * jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            const total = biayaAkomodasi + biayaTiket;
            
            // Update tampilan
            document.getElementById('biaya-akomodasi-glamping').textContent = formatRupiah(biayaAkomodasi);
            document.getElementById('biaya-tiket-glamping').textContent = formatRupiah(biayaTiket);
            document.getElementById('total-biaya-glamping').textContent = formatRupiah(total);
        }
        
        // Buat reservasi tenda baru
        function buatReservasiTenda() {
            // Validasi form
            const nama = document.getElementById('nama-pemesan-tenda').value;
            const telepon = document.getElementById('telepon-tenda').value;
            const tanggalCheckin = document.getElementById('tanggal-checkin-tenda').value;
            const jumlahOrang = parseInt(document.getElementById('jumlah-orang-tenda').value);
            const jumlahMalam = parseInt(document.getElementById('jumlah-malam-tenda').value);
            const paymentMethod = selectedPayment.tenda;
            
            if (!nama || !telepon || !tanggalCheckin) {
                alert('Harap lengkapi semua data pemesan!');
                return;
            }
            
            // Validasi jumlah malam
            if (jumlahMalam < dataApp.pengaturan.minReservasiHari || jumlahMalam > dataApp.pengaturan.maxReservasiHari) {
                alert(`Jumlah malam harus antara ${dataApp.pengaturan.minReservasiHari} hingga ${dataApp.pengaturan.maxReservasiHari} hari!`);
                return;
            }
            
            // Validasi pilihan lapak
            const lapakDipilih = dataApp.lapakTenda.filter(l => l.status === 'dipilih');
            if (lapakDipilih.length === 0) {
                alert('Harap pilih minimal 1 lapak tenda!');
                return;
            }
            
            if (lapakDipilih.length > dataApp.pengaturan.maxLapakPerReservasi) {
                alert(`Maksimal ${dataApp.pengaturan.maxLapakPerReservasi} lapak yang dapat dipilih untuk satu reservasi!`);
                return;
            }
            
            // Hitung tanggal checkout
            const checkinDate = new Date(tanggalCheckin);
            const checkoutDate = new Date(checkinDate);
            checkoutDate.setDate(checkoutDate.getDate() + jumlahMalam);
            
            // Generate invoice number
            const today = new Date();
            const invoiceNumber = `INV/${today.getFullYear()}/${(today.getMonth()+1).toString().padStart(2, '0')}/${(dataApp.invoice.length + 1).toString().padStart(3, '0')}`;
            
            // Hitung total biaya
            let biayaAkomodasi = 0;
            const lapakDipilihKode = [];
            
            // Hitung harga
            lapakDipilih.forEach(lapak => {
                biayaAkomodasi += lapak.harga * jumlahMalam;
                lapakDipilihKode.push(lapak.kode);
            });
            
            // Hitung biaya tiket
            const biayaTiket = jumlahOrang * jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            const totalBiaya = biayaAkomodasi + biayaTiket;
            
            // Hitung DP
            const dp = totalBiaya * (dataApp.pengaturan.dpPercentage / 100);
            
            // Buat reservasi baru
            const reservasiBaru = {
                id: dataApp.reservasi.length + 1,
                invoice: invoiceNumber,
                nama: nama,
                telepon: telepon,
                jenis: 'tenda',
                lapak: lapakDipilihKode,
                glamping: null,
                tanggalCheckin: tanggalCheckin,
                tanggalCheckout: formatDate(checkoutDate),
                jumlahOrang: jumlahOrang,
                jumlahMalam: jumlahMalam,
                paymentMethod: paymentMethod,
                paymentStatus: paymentMethod === 'sekarang' ? 'dibayar' : 'pending',
                barangSewa: [],
                totalBiaya: totalBiaya,
                dp: dp,
                dpLunas: paymentMethod === 'sekarang',
                status: paymentMethod === 'sekarang' ? 'dibayar' : 'pending',
                tanggalReservasi: formatDate(today),
                createdBy: dataApp.user.username
            };
            
            // Tambahkan ke data
            dataApp.reservasi.push(reservasiBaru);
            dataApp.invoice.push(reservasiBaru);
            
            // Update status lapak menjadi terpakai
            lapakDipilih.forEach(lapak => {
                lapak.status = 'terpakai';
            });
            
            // Reset form
            document.getElementById('form-reservasi-tenda').reset();
            document.getElementById('jumlah-orang-tenda').value = 4;
            document.getElementById('jumlah-malam-tenda').value = 2;
            document.getElementById('payment-lokasi-tenda').checked = true;
            selectedPayment.tenda = 'lokasi';
            
            // Reset payment option visual
            document.querySelectorAll('#tab-tenda .payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('#payment-lokasi-tenda').closest('.payment-option').classList.add('selected');
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateDashboard();
            generateLapakVisualization();
            generateLapakSelection();
            generateInvoiceList();
            loadInvoiceOptions();
            
            // Tampilkan modal invoice
            tampilkanInvoiceModal(invoiceNumber);
            
            // Tampilkan pesan sukses
            showLoadingModal();
            setTimeout(() => {
                hideLoadingModal();
                let message = `Reservasi berhasil dibuat!\nNomor Invoice: ${invoiceNumber}`;
                
                if (paymentMethod === 'transfer') {
                    message += `\n\nSilakan transfer DP sebesar ${formatRupiah(dp)} ke:\n` +
                              `Bank: ${dataApp.pengaturan.perusahaan.bank}\n` +
                              `No. Rek: ${dataApp.pengaturan.perusahaan.norek}\n` +
                              `a.n. ${dataApp.pengaturan.perusahaan.anRekening}`;
                } else if (paymentMethod === 'lokasi') {
                    message += `\n\nDP sebesar ${formatRupiah(dp)} dapat dibayar saat check-in di lokasi.`;
                }
                
                alert(message);
            }, 1000);
        }
        
        // Buat reservasi glamping baru (multi-select)
        function buatReservasiGlamping() {
            // Validasi form
            const nama = document.getElementById('nama-pemesan-glamping').value;
            const telepon = document.getElementById('telepon-glamping').value;
            const tanggalCheckin = document.getElementById('tanggal-checkin-glamping').value;
            const jumlahOrang = parseInt(document.getElementById('jumlah-orang-glamping').value);
            const jumlahMalam = parseInt(document.getElementById('jumlah-malam-glamping').value);
            const paymentMethod = selectedPayment.glamping;
            
            if (!nama || !telepon || !tanggalCheckin) {
                alert('Harap lengkapi semua data pemesan!');
                return;
            }
            
            // Validasi jumlah malam
            if (jumlahMalam < dataApp.pengaturan.minReservasiHari || jumlahMalam > dataApp.pengaturan.maxReservasiHari) {
                alert(`Jumlah malam harus antara ${dataApp.pengaturan.minReservasiHari} hingga ${dataApp.pengaturan.maxReservasiHari} hari!`);
                return;
            }
            
            // Validasi pilihan glamping
            const glampingDipilih = dataApp.glamping.filter(g => g.status === 'dipilih');
            if (glampingDipilih.length === 0) {
                alert('Harap pilih minimal 1 unit glamping!');
                return;
            }
            
            // Hitung tanggal checkout
            const checkinDate = new Date(tanggalCheckin);
            const checkoutDate = new Date(checkinDate);
            checkoutDate.setDate(checkoutDate.getDate() + jumlahMalam);
            
            // Generate invoice number
            const today = new Date();
            const invoiceNumber = `INV/${today.getFullYear()}/${(today.getMonth()+1).toString().padStart(2, '0')}/${(dataApp.invoice.length + 1).toString().padStart(3, '0')}`;
            
            // Hitung total biaya
            let biayaAkomodasi = 0;
            glampingDipilih.forEach(glamping => {
                biayaAkomodasi += glamping.harga * jumlahMalam;
            });
            
            const biayaTiket = jumlahOrang * jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            const totalBiaya = biayaAkomodasi + biayaTiket;
            
            // Hitung DP
            const dp = totalBiaya * (dataApp.pengaturan.dpPercentage / 100);
            
            // Buat reservasi baru
            const reservasiBaru = {
                id: dataApp.reservasi.length + 1,
                invoice: invoiceNumber,
                nama: nama,
                telepon: telepon,
                jenis: 'glamping',
                lapak: [],
                glamping: glampingDipilih.map(g => g.kode), // Array of glamping codes
                tanggalCheckin: tanggalCheckin,
                tanggalCheckout: formatDate(checkoutDate),
                jumlahOrang: jumlahOrang,
                jumlahMalam: jumlahMalam,
                paymentMethod: paymentMethod,
                paymentStatus: paymentMethod === 'sekarang' ? 'dibayar' : 'pending',
                barangSewa: [],
                totalBiaya: totalBiaya,
                dp: dp,
                dpLunas: paymentMethod === 'sekarang',
                status: paymentMethod === 'sekarang' ? 'dibayar' : 'pending',
                tanggalReservasi: formatDate(today),
                createdBy: dataApp.user.username
            };
            
            // Tambahkan ke data
            dataApp.reservasi.push(reservasiBaru);
            dataApp.invoice.push(reservasiBaru);
            
            // Update status glamping menjadi terpakai
            glampingDipilih.forEach(glamping => {
                glamping.status = 'terpakai';
            });
            
            // Reset form
            document.getElementById('form-reservasi-glamping').reset();
            document.getElementById('jumlah-orang-glamping').value = 4;
            document.getElementById('jumlah-malam-glamping').value = 2;
            document.getElementById('payment-lokasi-glamping').checked = true;
            selectedPayment.glamping = 'lokasi';
            
            // Reset payment option visual
            document.querySelectorAll('#tab-glamping .payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('#payment-lokasi-glamping').closest('.payment-option').classList.add('selected');
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateDashboard();
            generateGlampingVisualization();
            generateGlampingSelection();
            generateInvoiceList();
            loadInvoiceOptions();
            
            // Tampilkan modal invoice
            tampilkanInvoiceModal(invoiceNumber);
            
            // Tampilkan pesan sukses
            showLoadingModal();
            setTimeout(() => {
                hideLoadingModal();
                let message = `Reservasi berhasil dibuat!\nNomor Invoice: ${invoiceNumber}`;
                
                if (paymentMethod === 'transfer') {
                    message += `\n\nSilakan transfer DP sebesar ${formatRupiah(dp)} ke:\n` +
                              `Bank: ${dataApp.pengaturan.perusahaan.bank}\n` +
                              `No. Rek: ${dataApp.pengaturan.perusahaan.norek}\n` +
                              `a.n. ${dataApp.pengaturan.perusahaan.anRekening}`;
                } else if (paymentMethod === 'lokasi') {
                    message += `\n\nDP sebesar ${formatRupiah(dp)} dapat dibayar saat check-in di lokasi.`;
                }
                
                alert(message);
            }, 1000);
        }
        
        // Generate visualisasi lapak
        function generateLapakVisualization() {
            const container = document.getElementById('lapak-visualization');
            container.innerHTML = '';
            
            const filterTipe = document.getElementById('filter-tipe').value;
            const filterTanggal = document.getElementById('filter-tanggal').value;
            
            let lapakTersediaCount = 0;
            let lapakTerpakaiCount = 0;
            let lapakDipilihCount = 0;
            
            // Filter lapak berdasarkan tanggal
            const lapakPadaTanggal = [...dataApp.lapakTenda];
            
            // Reset status lapak untuk visualisasi (hanya untuk yang tidak terpakai permanen)
            lapakPadaTanggal.forEach(lapak => {
                if (lapak.status !== 'terpakai') {
                    lapak.status = 'tersedia';
                }
            });
            
            // Tandai lapak yang terpakai pada tanggal filter
            if (filterTanggal) {
                dataApp.reservasi.forEach(reservasi => {
                    if (reservasi.tanggalCheckin === filterTanggal && reservasi.jenis === 'tenda' && 
                        (reservasi.status === 'aktif' || reservasi.status === 'dibayar' || reservasi.status === 'pending')) {
                        reservasi.lapak.forEach(kodeLapak => {
                            const lapak = lapakPadaTanggal.find(l => l.kode === kodeLapak);
                            if (lapak) {
                                lapak.status = 'terpakai';
                            }
                        });
                    }
                });
            }
            
            // Tampilkan lapak
            lapakPadaTanggal.forEach(lapak => {
                // Filter berdasarkan tipe
                if (filterTipe !== 'semua' && lapak.tipe !== filterTipe) {
                    return;
                }
                
                // Hitung statistik
                if (lapak.status === 'tersedia') lapakTersediaCount++;
                else if (lapak.status === 'terpakai') lapakTerpakaiCount++;
                else if (lapak.status === 'dipilih') lapakDipilihCount++;
                
                const lapakEl = document.createElement('div');
                lapakEl.className = `grid-item ${lapak.status === 'tersedia' ? 'lapak-tersedia' : lapak.status === 'terpakai' ? 'lapak-terpakai' : 'lapak-dipilih'}`;
                lapakEl.textContent = lapak.kode;
                lapakEl.title = `Lapak ${lapak.kode} - Tipe: ${lapak.tipe} - Status: ${lapak.status}`;
                container.appendChild(lapakEl);
            });
            
            // Update statistik
            document.getElementById('count-tersedia').textContent = lapakTersediaCount;
            document.getElementById('count-terpakai').textContent = lapakTerpakaiCount;
            document.getElementById('count-dipilih').textContent = lapakDipilihCount;
        }
        
        // Generate visualisasi glamping
        function generateGlampingVisualization() {
            const container = document.getElementById('glamping-visualization');
            container.innerHTML = '';
            
            const filterTanggal = document.getElementById('filter-tanggal').value;
            
            // Buat salinan data glamping untuk visualisasi
            const glampingVisual = [...dataApp.glamping];
            
            // Reset status untuk visualisasi (hanya yang tidak terpakai permanen)
            glampingVisual.forEach(glamping => {
                if (glamping.status !== 'terpakai') {
                    glamping.status = 'tersedia';
                }
            });
            
            // Tandai glamping yang terpakai pada tanggal filter
            if (filterTanggal) {
                dataApp.reservasi.forEach(reservasi => {
                    if (reservasi.tanggalCheckin === filterTanggal && reservasi.jenis === 'glamping' && 
                        (reservasi.status === 'aktif' || reservasi.status === 'dibayar' || reservasi.status === 'pending')) {
                        
                        // Handle both array and single glamping
                        const glampingCodes = Array.isArray(reservasi.glamping) ? 
                            reservasi.glamping : [reservasi.glamping];
                        
                        glampingCodes.forEach(kodeGlamping => {
                            const glamping = glampingVisual.find(g => g.kode === kodeGlamping);
                            if (glamping) {
                                glamping.status = 'terpakai';
                            }
                        });
                    }
                });
            }
            
            // Tampilkan glamping
            glampingVisual.forEach(glamping => {
                const glampingEl = document.createElement('div');
                glampingEl.className = `grid-item ${glamping.status === 'tersedia' ? 'lapak-tersedia' : glamping.status === 'terpakai' ? 'lapak-terpakai' : 'lapak-dipilih'}`;
                glampingEl.textContent = glamping.kode;
                glampingEl.title = `Glamping ${glamping.kode} - Kapasitas: ${glamping.kapasitas} - Status: ${glamping.status}`;
                container.appendChild(glampingEl);
            });
            
            // Update tabel status glamping
            const tbody = document.getElementById('glamping-status');
            tbody.innerHTML = '';
            
            dataApp.glamping.forEach(glamping => {
                const row = document.createElement('tr');
                
                // Cari reservasi untuk glamping ini
                const reservasi = dataApp.reservasi.find(r => {
                    if (r.jenis === 'glamping' && (r.status === 'aktif' || r.status === 'dibayar' || r.status === 'pending')) {
                        // Check if glamping is in the array
                        if (Array.isArray(r.glamping)) {
                            return r.glamping.includes(glamping.kode);
                        } else {
                            return r.glamping === glamping.kode;
                        }
                    }
                    return false;
                });
                
                row.innerHTML = `
                    <td>${glamping.kode}</td>
                    <td>${glamping.kapasitas} orang</td>
                    <td>${formatRupiah(glamping.harga)}</td>
                    <td>
                        <span class="badge ${glamping.status === 'tersedia' ? 'badge-success' : glamping.status === 'terpakai' ? 'badge-danger' : 'badge-warning'}">
                            ${glamping.status === 'tersedia' ? 'Tersedia' : glamping.status === 'terpakai' ? 'Terpakai' : 'Dipilih'}
                        </span>
                    </td>
                    <td>${reservasi ? reservasi.nama : '-'}</td>
                    <td>${reservasi ? reservasi.tanggalCheckin : '-'}</td>
                    <td>${reservasi ? reservasi.tanggalCheckout : '-'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Update visualisasi lapak berdasarkan filter
        function updateLapakVisualization() {
            generateLapakVisualization();
            generateGlampingVisualization();
        }
        
        // Generate daftar invoice
        function generateInvoiceList() {
            const tbody = document.getElementById('invoice-list');
            tbody.innerHTML = '';
            
            dataApp.invoice.forEach(inv => {
                const row = document.createElement('tr');
                
                // Status badge
                let statusBadge = '';
                if (inv.status === 'aktif') {
                    statusBadge = '<span class="badge badge-success">Aktif</span>';
                } else if (inv.status === 'dibayar') {
                    statusBadge = '<span class="badge badge-warning">Dibayar</span>';
                } else if (inv.status === 'pending') {
                    statusBadge = '<span class="badge badge-warning">Pending</span>';
                } else if (inv.status === 'selesai') {
                    statusBadge = '<span class="badge badge-success">Selesai</span>';
                } else {
                    statusBadge = '<span class="badge badge-danger">Dibatalkan</span>';
                }
                
                // Jenis badge
                const jenisBadge = inv.jenis === 'tenda' ? 
                    '<span class="badge badge-primary">Lapak Tenda</span>' : 
                    '<span class="badge badge-secondary">Glamping</span>';
                
                row.innerHTML = `
                    <td>${inv.invoice}</td>
                    <td>${inv.tanggalCheckin}</td>
                    <td>${inv.nama}</td>
                    <td>${inv.telepon}</td>
                    <td>${jenisBadge}</td>
                    <td>${formatRupiah(inv.totalBiaya)}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="tampilkanInvoiceModal('${inv.invoice}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="ubahStatusInvoice('${inv.invoice}', 'dibayar')">
                            <i class="fas fa-check"></i>
                        </button>
                        ${dataApp.user.role === 'admin' ? `
                        <button class="btn btn-danger btn-sm" onclick="hapusInvoice('${inv.invoice}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Cari invoice berdasarkan filter
        function cariInvoice() {
            const keyword = document.getElementById('cari-invoice').value.toLowerCase();
            const filterStatus = document.getElementById('filter-status-invoice').value;
            const filterJenis = document.getElementById('filter-jenis-invoice').value;
            
            const tbody = document.getElementById('invoice-list');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                const invoiceNo = cells[0].textContent.toLowerCase();
                const nama = cells[2].textContent.toLowerCase();
                const telepon = cells[3].textContent.toLowerCase();
                const jenis = cells[4].textContent;
                const status = cells[6].textContent;
                
                let statusMatch = true;
                if (filterStatus !== 'semua') {
                    const statusText = filterStatus === 'aktif' ? 'Aktif' : 
                                     filterStatus === 'dibayar' ? 'Dibayar' : 
                                     filterStatus === 'pending' ? 'Pending' : 
                                     filterStatus === 'selesai' ? 'Selesai' : 'Dibatalkan';
                    statusMatch = status.includes(statusText);
                }
                
                let jenisMatch = true;
                if (filterJenis !== 'semua') {
                    const jenisText = filterJenis === 'tenda' ? 'Lapak Tenda' : 'Glamping';
                    jenisMatch = jenis.includes(jenisText);
                }
                
                const keywordMatch = invoiceNo.includes(keyword) || nama.includes(keyword) || telepon.includes(keyword);
                
                if (keywordMatch && statusMatch && jenisMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }
        
        // Tampilkan modal invoice
        function tampilkanInvoiceModal(invoiceNumber) {
            const invoice = dataApp.invoice.find(inv => inv.invoice === invoiceNumber);
            if (!invoice) return;
            
            const modalBody = document.getElementById('invoice-modal-body');
            
            // Format tanggal
            const tanggalReservasi = new Date(invoice.tanggalReservasi).toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Buat konten invoice
            let itemsHTML = '';
            let totalItems = 0;
            
            // Item akomodasi
            if (invoice.jenis === 'tenda') {
                // Hitung total biaya lapak dari data master
                let totalBiayaLapak = 0;
                invoice.lapak.forEach(kodeLapak => {
                    const lapak = dataApp.lapakTenda.find(l => l.kode === kodeLapak);
                    if (lapak) {
                        totalBiayaLapak += lapak.harga * invoice.jumlahMalam;
                    }
                });
                
                itemsHTML += `
                    <tr>
                        <td>Lapak Tenda (${invoice.lapak.join(', ')})</td>
                        <td>${invoice.jumlahMalam} malam</td>
                        <td>${formatRupiah(totalBiayaLapak / invoice.jumlahMalam / invoice.lapak.length)}/lapak/malam</td>
                        <td>${formatRupiah(totalBiayaLapak)}</td>
                    </tr>
                    <tr>
                        <td>Tiket Masuk (${invoice.jumlahOrang} orang x ${invoice.jumlahMalam} malam)</td>
                        <td>${invoice.jumlahMalam} malam</td>
                        <td>${formatRupiah(dataApp.pengaturan.perusahaan.hargaTiket)}/orang</td>
                        <td>${formatRupiah(invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket)}</td>
                    </tr>
                `;
                totalItems += totalBiayaLapak;
                totalItems += invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            } else {
                // Untuk glamping yang bisa multiple
                let totalBiayaGlamping = 0;
                
                // Handle both array and single glamping
                const glampingCodes = Array.isArray(invoice.glamping) ? 
                    invoice.glamping : [invoice.glamping];
                
                glampingCodes.forEach(kodeGlamping => {
                    const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                    if (glamping) {
                        totalBiayaGlamping += glamping.harga * invoice.jumlahMalam;
                    }
                });
                
                glampingCodes.forEach(kodeGlamping => {
                    const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                    if (glamping) {
                        const hargaGlamping = glamping.harga * invoice.jumlahMalam;
                        itemsHTML += `
                            <tr>
                                <td>Glamping ${glamping.kode}</td>
                                <td>${invoice.jumlahMalam} malam</td>
                                <td>${formatRupiah(glamping.harga)}/malam</td>
                                <td>${formatRupiah(hargaGlamping)}</td>
                            </tr>
                        `;
                    }
                });
                
                itemsHTML += `
                    <tr>
                        <td>Tiket Masuk (${invoice.jumlahOrang} orang x ${invoice.jumlahMalam} malam)</td>
                        <td>${invoice.jumlahMalam} malam</td>
                        <td>${formatRupiah(dataApp.pengaturan.perusahaan.hargaTiket)}/orang</td>
                        <td>${formatRupiah(invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket)}</td>
                    </tr>
                `;
                totalItems += totalBiayaGlamping;
                totalItems += invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket;
            }
            
            // Item barang sewa
            invoice.barangSewa.forEach(barang => {
                // PERBAIKAN: Hitung subtotal dengan jumlah hari yang benar
                const subtotal = barang.jumlah * barang.harga * invoice.jumlahMalam;
                itemsHTML += `
                    <tr>
                        <td>${barang.nama}</td>
                        <td>${barang.jumlah} x ${invoice.jumlahMalam} hari</td>
                        <td>${formatRupiah(barang.harga)}/hari</td>
                        <td>${formatRupiah(subtotal)}</td>
                    </tr>
                `;
                totalItems += subtotal;
            });
            
            // Status badge
            let statusBadge = '';
            if (invoice.status === 'aktif') {
                statusBadge = '<span class="badge badge-success">Aktif</span>';
            } else if (invoice.status === 'dibayar') {
                statusBadge = '<span class="badge badge-warning">Dibayar</span>';
            } else if (invoice.status === 'pending') {
                statusBadge = '<span class="badge badge-warning">Pending</span>';
            } else if (invoice.status === 'selesai') {
                statusBadge = '<span class="badge badge-success">Selesai</span>';
            } else {
                statusBadge = '<span class="badge badge-danger">Dibatalkan</span>';
            }
            
            // Payment method
            let paymentMethodText = '';
            if (invoice.paymentMethod === 'transfer') {
                paymentMethodText = 'Transfer Bank';
            } else if (invoice.paymentMethod === 'lokasi') {
                paymentMethodText = 'Bayar di Lokasi';
            } else {
                paymentMethodText = 'Bayar Sekarang';
            }
            
            modalBody.innerHTML = `
                <div class="invoice">
                    <div class="company-logo">
                        <i class="fas fa-campground" style="font-size: 2.5rem; color: var(--primary-color);"></i>
                        <h2>${dataApp.pengaturan.perusahaan.nama}</h2>
                        <p>${dataApp.pengaturan.perusahaan.alamat}</p>
                        <p>Telp: ${dataApp.pengaturan.perusahaan.telepon} | Email: ${dataApp.pengaturan.perusahaan.email}</p>
                    </div>
                    
                    <div class="invoice-header">
                        <h3>INVOICE</h3>
                        <h4>${invoice.invoice}</h4>
                        <p>Tanggal Reservasi: ${tanggalReservasi}</p>
                        <p>Status: ${statusBadge} | Metode Bayar: ${paymentMethodText}</p>
                    </div>
                    
                    <div class="invoice-details form-row">
                        <div class="form-group">
                            <label>Nama Pemesan</label>
                            <div class="form-control">${invoice.nama}</div>
                        </div>
                        
                        <div class="form-group">
                            <label>No. Telepon</label>
                            <div class="form-control">${invoice.telepon}</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tanggal Check-in</label>
                            <div class="form-control">${invoice.tanggalCheckin}</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Tanggal Check-out</label>
                            <div class="form-control">${invoice.tanggalCheckout}</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Jumlah Malam</label>
                            <div class="form-control">${invoice.jumlahMalam} malam</div>
                        </div>
                        
                        <div class="form-group">
                            <label>Jumlah Orang</label>
                            <div class="form-control">${invoice.jumlahOrang} orang</div>
                        </div>
                    </div>
                    
                    <div class="invoice-items">
                        <h4>Rincian Biaya</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Jumlah</th>
                                    <th>Harga Satuan</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHTML}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="invoice-total">
                        <div>Total Biaya: <strong>${formatRupiah(totalItems)}</strong></div>
                        <div>DP (${dataApp.pengaturan.dpPercentage}%): <strong>${formatRupiah(invoice.dp)}</strong></div>
                        <div>Sisa Pembayaran: <strong>${formatRupiah(totalItems - invoice.dp)}</strong></div>
                    </div>
                    
                    ${invoice.paymentMethod === 'transfer' ? `
                    <div class="bank-info">
                        <h5>Informasi Transfer</h5>
                        <p><strong>Bank:</strong> ${dataApp.pengaturan.perusahaan.bank}</p>
                        <p><strong>No. Rekening:</strong> ${dataApp.pengaturan.perusahaan.norek}</p>
                        <p><strong>Atas Nama:</strong> ${dataApp.pengaturan.perusahaan.anRekening}</p>
                        <p><small>Silakan transfer DP sebesar ${formatRupiah(invoice.dp)} untuk konfirmasi reservasi</small></p>
                    </div>
                    ` : ''}
                    
                    <div class="mt-4" style="border-top: 1px solid #eee; padding-top: 15px;">
                        <p><strong>Catatan:</strong></p>
                        <p>1. Check-in: ${dataApp.pengaturan.jamCheckin} | Check-out: ${dataApp.pengaturan.jamCheckout}</p>
                        <p>2. Denda keterlambatan check-out: ${formatRupiah(dataApp.pengaturan.dendaKeterlambatan)} per jam</p>
                        <p>3. Reservasi dianggap batal jika DP tidak dibayar dalam 24 jam</p>
                        <p>4. Untuk bantuan hubungi: ${dataApp.pengaturan.perusahaan.namaPemandu} - ${dataApp.pengaturan.perusahaan.noLayanan}</p>
                    </div>
                </div>
            `;
            
            // Tampilkan modal
            document.getElementById('invoice-modal').style.display = 'flex';
        }
        
        // Tutup modal invoice
        function closeInvoiceModal() {
            document.getElementById('invoice-modal').style.display = 'none';
        }
        
        // Ubah status invoice
        function ubahStatusInvoice(invoiceNumber, status) {
            const invoice = dataApp.invoice.find(inv => inv.invoice === invoiceNumber);
            if (invoice) {
                invoice.status = status;
                if (status === 'dibayar') {
                    invoice.dpLunas = true;
                    invoice.paymentStatus = 'dibayar';
                }
                
                // Simpan ke localStorage
                saveToLocalStorage();
                
                // Update tampilan
                generateInvoiceList();
                updateDashboard();
                
                alert(`Status invoice ${invoiceNumber} berhasil diubah menjadi ${status}`);
            }
        }
        
        // Hapus invoice
        function hapusInvoice(invoiceNumber) {
            if (!confirm(`Apakah Anda yakin ingin menghapus invoice ${invoiceNumber}?`)) {
                return;
            }
            
            const invoiceIndex = dataApp.invoice.findIndex(inv => inv.invoice === invoiceNumber);
            if (invoiceIndex !== -1) {
                const invoice = dataApp.invoice[invoiceIndex];
                
                // Kembalikan status lapak/glamping menjadi tersedia
                if (invoice.jenis === 'tenda') {
                    invoice.lapak.forEach(kodeLapak => {
                        const lapak = dataApp.lapakTenda.find(l => l.kode === kodeLapak);
                        if (lapak) {
                            lapak.status = 'tersedia';
                        }
                    });
                } else if (invoice.jenis === 'glamping') {
                    // Handle both array and single glamping
                    const glampingCodes = Array.isArray(invoice.glamping) ? 
                        invoice.glamping : [invoice.glamping];
                    
                    glampingCodes.forEach(kodeGlamping => {
                        const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                        if (glamping) {
                            glamping.status = 'tersedia';
                        }
                    });
                }
                
                // Hapus dari data
                dataApp.invoice.splice(invoiceIndex, 1);
                dataApp.reservasi.splice(invoiceIndex, 1);
                
                // Simpan ke localStorage
                saveToLocalStorage();
                
                // Update tampilan
                generateInvoiceList();
                updateDashboard();
                generateLapakVisualization();
                generateGlampingVisualization();
                
                alert(`Invoice ${invoiceNumber} berhasil dihapus!`);
            }
        }
        
        // Hapus invoice bulan lalu
        function hapusInvoiceBulanLalu() {
            if (!confirm('Apakah Anda yakin ingin menghapus semua invoice bulan lalu? Tindakan ini tidak dapat dibatalkan!')) {
                return;
            }
            
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const firstDayLastMonth = formatDate(new Date(lastMonth.getFullYear(), lastMonth.getMonth(), 1));
            const lastDayLastMonth = formatDate(new Date(lastMonth.getFullYear(), lastMonth.getMonth() + 1, 0));
            
            // Filter invoice bulan lalu
            const invoicesToDelete = dataApp.invoice.filter(inv => {
                const invDate = new Date(inv.tanggalReservasi);
                return invDate >= new Date(firstDayLastMonth) && invDate <= new Date(lastDayLastMonth);
            });
            
            if (invoicesToDelete.length === 0) {
                alert('Tidak ada invoice bulan lalu yang dapat dihapus.');
                return;
            }
            
            // Hapus invoice
            invoicesToDelete.forEach(inv => {
                const invoiceIndex = dataApp.invoice.findIndex(i => i.invoice === inv.invoice);
                if (invoiceIndex !== -1) {
                    dataApp.invoice.splice(invoiceIndex, 1);
                    dataApp.reservasi.splice(invoiceIndex, 1);
                }
            });
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            generateInvoiceList();
            updateDashboard();
            
            alert(`${invoicesToDelete.length} invoice bulan lalu berhasil dihapus!`);
        }
        
        // Reset lapak check-out hari ini
        function resetLapakHariIni() {
            const today = formatDate(new Date());
            
            // Cari reservasi yang check-out hari ini
            const reservasiCheckoutHariIni = dataApp.reservasi.filter(r => r.tanggalCheckout === today && (r.status === 'aktif' || r.status === 'dibayar'));
            
            if (reservasiCheckoutHariIni.length === 0) {
                alert('Tidak ada reservasi yang check-out hari ini.');
                return;
            }
            
            if (!confirm(`Apakah Anda yakin ingin mereset ${reservasiCheckoutHariIni.length} reservasi yang check-out hari ini?`)) {
                return;
            }
            
            // Reset status lapak/glamping
            reservasiCheckoutHariIni.forEach(reservasi => {
                if (reservasi.jenis === 'tenda') {
                    reservasi.lapak.forEach(kodeLapak => {
                        const lapak = dataApp.lapakTenda.find(l => l.kode === kodeLapak);
                        if (lapak) {
                            lapak.status = 'tersedia';
                        }
                    });
                } else if (reservasi.jenis === 'glamping') {
                    // Handle both array and single glamping
                    const glampingCodes = Array.isArray(reservasi.glamping) ? 
                        reservasi.glamping : [reservasi.glamping];
                    
                    glampingCodes.forEach(kodeGlamping => {
                        const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                        if (glamping) {
                            glamping.status = 'tersedia';
                        }
                    });
                }
                
                // Update status reservasi
                reservasi.status = 'selesai';
            });
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            // Update tampilan
            updateDashboard();
            generateLapakVisualization();
            generateGlampingVisualization();
            generateInvoiceList();
            
            alert(`${reservasiCheckoutHariIni.length} reservasi berhasil direset!`);
        }
        
        // Cetak invoice ke PDF
        function cetakInvoicePDF() {
            showLoadingModal();
            
            setTimeout(() => {
                // Menggunakan jsPDF untuk membuat PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
            // Ambil data dari modal
            const invoice = dataApp.invoice.find(inv => inv.invoice === document.querySelector('#invoice-modal-body .invoice-header h4').textContent.trim());
            
            if (!invoice) {
                hideLoadingModal();
                alert('Data invoice tidak ditemukan!');
                return;
            }
            
            // Ambil data perusahaan dari pengaturan terbaru
            const perusahaan = dataApp.pengaturan.perusahaan;
            
            // Header dengan logo perusahaan
            doc.setFontSize(18);
            doc.text(perusahaan.nama, 105, 15, { align: 'center' });
            doc.setFontSize(11);
            doc.text(perusahaan.alamat, 105, 22, { align: 'center' });
            doc.text(`Telp: ${perusahaan.telepon} | Email: ${perusahaan.email}`, 105, 28, { align: 'center' });
            
            // Garis pemisah
            doc.setLineWidth(0.5);
            doc.line(10, 32, 200, 32);
            
            // Judul Invoice
            doc.setFontSize(16);
            doc.text("INVOICE", 105, 40, { align: 'center' });
            doc.setFontSize(13);
            doc.text(invoice.invoice, 105, 47, { align: 'center' });
            
            // Format tanggal
            const tanggalReservasi = new Date(invoice.tanggalReservasi);
            const tanggalFormatted = tanggalReservasi.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            doc.setFontSize(9);
            doc.text(`Tanggal Reservasi: ${tanggalFormatted}`, 105, 54, { align: 'center' });
            
            // Status dan metode pembayaran
            let statusText = '';
            if (invoice.status === 'aktif') statusText = 'Aktif';
            else if (invoice.status === 'dibayar') statusText = 'Dibayar';
            else if (invoice.status === 'pending') statusText = 'Pending';
            else if (invoice.status === 'selesai') statusText = 'Selesai';
            else statusText = 'Dibatalkan';
            
            let paymentMethodText = '';
            if (invoice.paymentMethod === 'transfer') paymentMethodText = 'Transfer Bank';
            else if (invoice.paymentMethod === 'lokasi') paymentMethodText = 'Bayar di Lokasi';
            else paymentMethodText = 'Bayar Sekarang';
            
            doc.text(`Status: ${statusText} | Metode Bayar: ${paymentMethodText}`, 105, 60, { align: 'center' });
            
            // Data pemesan
            doc.setFontSize(11);
            doc.text("Data Pemesan", 10, 70);
            doc.setFontSize(9);
            doc.text(`Nama: ${invoice.nama}`, 10, 78);
            doc.text(`Telepon: ${invoice.telepon}`, 10, 84);
            doc.text(`Check-in: ${invoice.tanggalCheckin}`, 10, 90);
            doc.text(`Check-out: ${invoice.tanggalCheckout}`, 10, 96);
            doc.text(`Jumlah Malam: ${invoice.jumlahMalam} malam`, 10, 102);
            doc.text(`Jumlah Orang: ${invoice.jumlahOrang} orang`, 10, 108);
            
            // Garis pemisah
            doc.line(10, 112, 200, 112);
            
            // Rincian biaya
            doc.setFontSize(11);
            doc.text("Rincian Biaya", 10, 120);
            
            // Buat data tabel
            const tableData = [];
            
            // Item akomodasi
            if (invoice.jenis === 'tenda') {
                // Hitung total biaya lapak dari data master
                let totalBiayaLapak = 0;
                invoice.lapak.forEach(kodeLapak => {
                    const lapak = dataApp.lapakTenda.find(l => l.kode === kodeLapak);
                    if (lapak) {
                        totalBiayaLapak += lapak.harga * invoice.jumlahMalam;
                    }
                });
                
                tableData.push([
                    `Lapak Tenda (${invoice.lapak.join(', ')})`,
                    `${invoice.jumlahMalam} malam`,
                    formatRupiah(totalBiayaLapak / invoice.jumlahMalam / invoice.lapak.length),
                    formatRupiah(totalBiayaLapak)
                ]);
                
                tableData.push([
                    `Tiket Masuk (${invoice.jumlahOrang} orang x ${invoice.jumlahMalam} malam)`,
                    `${invoice.jumlahMalam} malam`,
                    `${formatRupiah(dataApp.pengaturan.perusahaan.hargaTiket)}/orang`,
                    formatRupiah(invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket)
                ]);
            } else {
                // Untuk glamping
                const glampingCodes = Array.isArray(invoice.glamping) ? 
                    invoice.glamping : [invoice.glamping];
                
                glampingCodes.forEach(kodeGlamping => {
                    const glamping = dataApp.glamping.find(g => g.kode === kodeGlamping);
                    if (glamping) {
                        const hargaGlamping = glamping.harga * invoice.jumlahMalam;
                        tableData.push([
                            `Glamping ${glamping.kode}`,
                            `${invoice.jumlahMalam} malam`,
                            formatRupiah(glamping.harga),
                            formatRupiah(hargaGlamping)
                        ]);
                    }
                });
                
                tableData.push([
                    `Tiket Masuk (${invoice.jumlahOrang} orang x ${invoice.jumlahMalam} malam)`,
                    `${invoice.jumlahMalam} malam`,
                    `${formatRupiah(dataApp.pengaturan.perusahaan.hargaTiket)}/orang`,
                    formatRupiah(invoice.jumlahOrang * invoice.jumlahMalam * dataApp.pengaturan.perusahaan.hargaTiket)
                ]);
            }
            
            // Item barang sewa
            invoice.barangSewa.forEach(barang => {
                // PERBAIKAN: Hitung subtotal dengan jumlah hari yang benar
                const subtotal = barang.jumlah * barang.harga * invoice.jumlahMalam;
                tableData.push([
                    barang.nama,
                    `${barang.jumlah} x ${invoice.jumlahMalam} hari`,
                    formatRupiah(barang.harga),
                    formatRupiah(subtotal)
                ]);
            });
            
            // Tambahkan tabel
            doc.autoTable({
                startY: 125,
                head: [['Item', 'Jumlah', 'Harga Satuan', 'Subtotal']],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [46, 125, 50] },
                margin: { top: 125 }
            });
            
            // Total
            const finalY = doc.lastAutoTable.finalY + 10;
            const totalBiaya = invoice.totalBiaya;
            const dp = invoice.dp;
            const sisa = totalBiaya - dp;
            
            doc.setFontSize(11);
            doc.text(`Total Biaya: ${formatRupiah(totalBiaya)}`, 140, finalY);
            doc.text(`DP (${dataApp.pengaturan.dpPercentage}%): ${formatRupiah(dp)}`, 140, finalY + 7);
            doc.text(`Sisa Pembayaran: ${formatRupiah(sisa)}`, 140, finalY + 14);
            
            // Informasi bank jika metode transfer
            if (invoice.paymentMethod === 'transfer') {
                doc.setFontSize(10);
                doc.text("Informasi Transfer:", 10, finalY + 30);
                doc.text(`Bank: ${perusahaan.bank}`, 10, finalY + 37);
                doc.text(`No. Rekening: ${perusahaan.norek}`, 10, finalY + 44);
                doc.text(`Atas Nama: ${perusahaan.anRekening}`, 10, finalY + 51);
                doc.text(`Silakan transfer DP sebesar ${formatRupiah(dp)} untuk konfirmasi reservasi`, 10, finalY + 58);
            }
            
            // Catatan
            doc.setFontSize(9);
            doc.text("Catatan:", 10, finalY + 70);
            doc.text(`1. Check-in: ${dataApp.pengaturan.jamCheckin} | Check-out: ${dataApp.pengaturan.jamCheckout}`, 10, finalY + 77);
            doc.text(`2. Denda keterlambatan check-out: ${formatRupiah(dataApp.pengaturan.dendaKeterlambatan)} per jam`, 10, finalY + 84);
            doc.text("3. Reservasi dianggap batal jika DP tidak dibayar dalam 24 jam", 10, finalY + 91);
            doc.text(`4. Untuk bantuan hubungi: ${perusahaan.namaPemandu} - ${perusahaan.noLayanan}`, 10, finalY + 98);
            
            // Footer
            doc.setFontSize(9);
            doc.text("Terima kasih atas reservasi Anda", 105, 280, { align: 'center' });
            
            // Simpan PDF
            doc.save(`${invoice.invoice}.pdf`);
            
            hideLoadingModal();
        }, 1000);
    }
    
    // Toggle tanggal kustom di laporan
    function toggleTanggalKustom() {
        const periode = document.getElementById('periode-laporan').value;
        const tanggalKustom = document.getElementById('tanggal-kustom');
        
        if (periode === 'kustom') {
            tanggalKustom.classList.remove('hidden');
        } else {
            tanggalKustom.classList.add('hidden');
        }
    }
    
    // Generate laporan
    function generateLaporan() {
        showLoadingModal();
        
        setTimeout(() => {
            const periode = document.getElementById('periode-laporan').value;
            let tanggalMulai, tanggalSelesai;
            const today = new Date();
            
            // Tentukan rentang tanggal berdasarkan periode
            if (periode === 'hari-ini') {
                tanggalMulai = formatDate(today);
                tanggalSelesai = formatDate(today);
            } else if (periode === 'minggu-ini') {
                const firstDay = new Date(today.setDate(today.getDate() - today.getDay()));
                const lastDay = new Date(today.setDate(today.getDate() - today.getDay() + 6));
                tanggalMulai = formatDate(firstDay);
                tanggalSelesai = formatDate(lastDay);
            } else if (periode === 'bulan-ini') {
                tanggalMulai = formatDate(new Date(today.getFullYear(), today.getMonth(), 1));
                tanggalSelesai = formatDate(new Date(today.getFullYear(), today.getMonth() + 1, 0));
            } else if (periode === 'kustom') {
                tanggalMulai = document.getElementById('tanggal-mulai').value;
                tanggalSelesai = document.getElementById('tanggal-selesai').value;
            }
            
            // Filter reservasi berdasarkan periode
            const laporanData = dataApp.reservasi.filter(reservasi => {
                const reservasiDate = new Date(reservasi.tanggalReservasi);
                const startDate = new Date(tanggalMulai);
                const endDate = new Date(tanggalSelesai);
                
                return reservasiDate >= startDate && reservasiDate <= endDate;
            });
            
            // Hitung statistik
            let lapakTerjual = 0;
            let glampingTerjual = 0;
            let totalPengunjung = 0;
            let totalOmzet = 0;
            let totalTiket = 0;
            let totalBarang = 0;
            
            laporanData.forEach(reservasi => {
                if (reservasi.jenis === 'tenda') {
                    lapakTerjual += reservasi.lapak.length;
                } else {
                    // Untuk glamping yang bisa multiple
                    if (Array.isArray(reservasi.glamping)) {
                        glampingTerjual += reservasi.glamping.length;
                    } else {
                        glampingTerjual += 1;
                    }
                }
                
                totalPengunjung += reservasi.jumlahOrang;
                totalOmzet += reservasi.totalBiaya;
                totalTiket += reservasi.jumlahOrang * reservasi.jumlahMalam;
                
                // Hitung barang yang disewa
                reservasi.barangSewa.forEach(barang => {
                    totalBarang += barang.jumlah;
                });
            });
            
            // Update statistik
            document.getElementById('lapak-terjual').textContent = lapakTerjual;
            document.getElementById('glamping-terjual').textContent = glampingTerjual;
            document.getElementById('total-pengunjung').textContent = totalPengunjung;
            document.getElementById('total-omzet').textContent = formatRupiah(totalOmzet);
            document.getElementById('total-tiket').textContent = totalTiket;
            document.getElementById('total-barang').textContent = totalBarang;
            
            // Update tabel detail
            const tbody = document.getElementById('laporan-detail');
            tbody.innerHTML = '';
            
            laporanData.forEach(reservasi => {
                const row = document.createElement('tr');
                
                // Status badge
                let statusBadge = '';
                if (reservasi.status === 'aktif') {
                    statusBadge = '<span class="badge badge-success">Aktif</span>';
                } else if (reservasi.status === 'dibayar') {
                    statusBadge = '<span class="badge badge-warning">Dibayar</span>';
                } else if (reservasi.status === 'pending') {
                    statusBadge = '<span class="badge badge-warning">Pending</span>';
                } else if (reservasi.status === 'selesai') {
                    statusBadge = '<span class="badge badge-success">Selesai</span>';
                } else {
                    statusBadge = '<span class="badge badge-danger">Dibatalkan</span>';
                }
                
                // Hitung tiket
                const jumlahTiket = reservasi.jumlahOrang * reservasi.jumlahMalam;
                
                // Tampilkan lapak/glamping
                let lapakUnit = '';
                if (reservasi.jenis === 'tenda') {
                    lapakUnit = reservasi.lapak.join(', ');
                } else {
                    // Jika glamping adalah array, gabungkan
                    if (Array.isArray(reservasi.glamping)) {
                        lapakUnit = reservasi.glamping.join(', ');
                    } else {
                        lapakUnit = reservasi.glamping || '-';
                    }
                }
                
                row.innerHTML = `
                    <td>${reservasi.tanggalReservasi}</td>
                    <td>${reservasi.invoice}</td>
                    <td>${reservasi.nama}</td>
                    <td>${reservasi.jenis === 'tenda' ? 'Lapak Tenda' : 'Glamping'}</td>
                    <td>${lapakUnit}</td>
                    <td>${jumlahTiket} tiket</td>
                    <td>${formatRupiah(reservasi.totalBiaya)}</td>
                    <td>${statusBadge}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Simpan data laporan untuk ekspor
            dataApp.laporan = laporanData;
            
            hideLoadingModal();
        }, 1000);
    }
    
    // Download PDF laporan
    function downloadPDF() {
        if (dataApp.laporan.length === 0) {
            alert('Tidak ada data laporan untuk diekspor. Silakan generate laporan terlebih dahulu.');
            return;
        }
        
        showLoadingModal();
        
        setTimeout(() => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(18);
            doc.text("Laporan Reservasi", 105, 15, { align: 'center' });
            doc.setFontSize(13);
            doc.text(dataApp.pengaturan.perusahaan.nama, 105, 22, { align: 'center' });
            
            // Periode
            const periode = document.getElementById('periode-laporan').value;
            const periodeText = periode === 'hari-ini' ? 'Hari Ini' : 
                               periode === 'minggu-ini' ? 'Minggu Ini' : 
                               periode === 'bulan-ini' ? 'Bulan Ini' : 'Periode Kustom';
            
            const tanggalMulai = document.getElementById('tanggal-mulai').value;
            const tanggalSelesai = document.getElementById('tanggal-selesai').value;
            
            doc.setFontSize(11);
            doc.text(`Periode: ${periodeText}`, 10, 35);
            doc.text(`Tanggal: ${tanggalMulai} s/d ${tanggalSelesai}`, 10, 42);
            doc.text(`Tanggal Generate: ${new Date().toLocaleDateString('id-ID')}`, 10, 49);
            
            // Statistik
            doc.setFontSize(13);
            doc.text("Statistik", 10, 60);
            doc.setFontSize(9);
            doc.text(`Lapak Terjual: ${document.getElementById('lapak-terjual').textContent}`, 10, 70);
            doc.text(`Glamping Terjual: ${document.getElementById('glamping-terjual').textContent}`, 10, 77);
            doc.text(`Total Pengunjung: ${document.getElementById('total-pengunjung').textContent}`, 10, 84);
            doc.text(`Tiket Terjual: ${document.getElementById('total-tiket').textContent}`, 10, 91);
            doc.text(`Barang Disewa: ${document.getElementById('total-barang').textContent}`, 10, 98);
            doc.text(`Total Omzet: ${document.getElementById('total-omzet').textContent}`, 10, 105);
            
            // Detail Transaksi
            doc.setFontSize(13);
            doc.text("Detail Transaksi", 10, 120);
            
            // Buat data tabel
            const tableData = dataApp.laporan.map(reservasi => {
                const jumlahTiket = reservasi.jumlahOrang * reservasi.jumlahMalam;
                
                // Tampilkan lapak/glamping
                let lapakUnit = '';
                if (reservasi.jenis === 'tenda') {
                    lapakUnit = reservasi.lapak.join(', ');
                } else {
                    // Jika glamping adalah array, gabungkan
                    if (Array.isArray(reservasi.glamping)) {
                        lapakUnit = reservasi.glamping.join(', ');
                    } else {
                        lapakUnit = reservasi.glamping || '-';
                    }
                }
                
                return [
                    reservasi.tanggalReservasi,
                    reservasi.invoice,
                    reservasi.nama,
                    reservasi.jenis === 'tenda' ? 'Lapak Tenda' : 'Glamping',
                    lapakUnit,
                    jumlahTiket + ' tiket',
                    formatRupiah(reservasi.totalBiaya),
                    reservasi.status
                ];
            });
            
            // Tambahkan tabel
            doc.autoTable({
                startY: 125,
                head: [['Tanggal', 'No Invoice', 'Nama', 'Jenis', 'Lapak/Unit', 'Tiket', 'Total', 'Status']],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [46, 125, 50] }
            });
            
            // Simpan PDF
            doc.save(`Laporan_Reservasi_${new Date().getTime()}.pdf`);
            
            hideLoadingModal();
        }, 1000);
    }
    
    // Download Excel laporan (simulasi)
    function downloadExcel() {
        if (dataApp.laporan.length === 0) {
            alert('Tidak ada data laporan untuk diekspor. Silakan generate laporan terlebih dahulu.');
            return;
        }
        
        // Buat data CSV
        let csvContent = "data:text/csv;charset=utf-8,";
        
        // Header
        csvContent += "Tanggal,No Invoice,Nama Pemesan,Jenis,Lapak/Unit,Jumlah Malam,Jumlah Orang,Tiket,Total Biaya,Status\n";
        
        // Data
        dataApp.laporan.forEach(reservasi => {
            const jumlahTiket = reservasi.jumlahOrang * reservasi.jumlahMalam;
            
            // Tampilkan lapak/glamping
            let lapakUnit = '';
            if (reservasi.jenis === 'tenda') {
                lapakUnit = reservasi.lapak.join(', ');
            } else {
                // Jika glamping adalah array, gabungkan
                if (Array.isArray(reservasi.glamping)) {
                    lapakUnit = reservasi.glamping.join(', ');
                } else {
                    lapakUnit = reservasi.glamping || '-';
                }
            }
            
            const row = [
                reservasi.tanggalReservasi,
                reservasi.invoice,
                reservasi.nama,
                reservasi.jenis === 'tenda' ? 'Lapak Tenda' : 'Glamping',
                lapakUnit,
                reservasi.jumlahMalam,
                reservasi.jumlahOrang,
                jumlahTiket,
                reservasi.totalBiaya,
                reservasi.status
            ].join(',');
            
            csvContent += row + "\n";
        });
        
        // Buat link download
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `Laporan_Reservasi_${new Date().getTime()}.csv`);
        document.body.appendChild(link);
        
        // Download file
        link.click();
        document.body.removeChild(link);
    }
    
    // Generate pengaturan harga lapak
    function generatePengaturanHargaLapak() {
        const tbody = document.getElementById('pengaturan-harga-lapak');
        tbody.innerHTML = '';
        
        const tipeLapak = [
            { kode: 'reguler', nama: 'Reguler', data: dataApp.pengaturan.hargaLapak.reguler },
            { kode: 'premium', nama: 'Premium', data: dataApp.pengaturan.hargaLapak.premium },
            { kode: 'dekatView', nama: 'Dekat View', data: dataApp.pengaturan.hargaLapak.dekatView },
            { kode: 'dekatFasilitas', nama: 'Dekat Fasilitas', data: dataApp.pengaturan.hargaLapak.dekatFasilitas }
        ];
        
        tipeLapak.forEach(tipe => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${tipe.nama}</td>
                <td><input type="number" class="form-control" id="jumlah-lapak-${tipe.kode}" value="${tipe.data.jumlah}" min="1" max="70"></td>
                <td><input type="number" class="form-control" id="harga-lapak-${tipe.kode}" value="${tipe.data.harga}" min="0"></td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="simpanHargaLapak('${tipe.kode}')">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // Generate pengaturan harga glamping
    function generatePengaturanHargaGlamping() {
        const tbody = document.getElementById('pengaturan-harga-glamping');
        tbody.innerHTML = '';
        
        dataApp.glamping.forEach((glamping, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${glamping.kode}</td>
                <td><input type="number" class="form-control" id="kapasitas-glamping-${index}" value="${glamping.kapasitas}" min="1" max="20"></td>
                <td><input type="number" class="form-control" id="harga-glamping-${index}" value="${glamping.harga}" min="0"></td>
                <td>
                    <span class="badge ${glamping.status === 'tersedia' ? 'badge-success' : glamping.status === 'terpakai' ? 'badge-danger' : 'badge-warning'}">
                        ${glamping.status === 'tersedia' ? 'Tersedia' : glamping.status === 'terpakai' ? 'Terpakai' : 'Dipilih'}
                    </span>
                </td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="simpanHargaGlamping(${index})">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // Simpan pengaturan harga lapak
    function simpanHargaLapak(tipe) {
        const harga = parseInt(document.getElementById(`harga-lapak-${tipe}`).value);
        const jumlahLapak = parseInt(document.getElementById(`jumlah-lapak-${tipe}`).value);
        
        // Update data
        dataApp.pengaturan.hargaLapak[tipe].harga = harga;
        dataApp.pengaturan.hargaLapak[tipe].jumlah = jumlahLapak;
        
        // Update harga di lapak yang ada
        dataApp.lapakTenda.forEach(lapak => {
            if (lapak.tipe === tipe) {
                lapak.harga = harga;
            }
        });
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        alert(`Harga lapak ${tipe} berhasil disimpan!`);
    }
    
    // Simpan semua pengaturan harga
    function simpanPengaturanHarga() {
        const tipeLapak = ['reguler', 'premium', 'dekatView', 'dekatFasilitas'];
        
        tipeLapak.forEach(tipe => {
            simpanHargaLapak(tipe);
        });
        
        alert('Semua harga lapak berhasil disimpan!');
    }
    
    // Simpan harga glamping
    function simpanHargaGlamping(index) {
        const kapasitas = parseInt(document.getElementById(`kapasitas-glamping-${index}`).value);
        const harga = parseInt(document.getElementById(`harga-glamping-${index}`).value);
        
        // Update data
        dataApp.glamping[index].kapasitas = kapasitas;
        dataApp.glamping[index].harga = harga;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        alert(`Harga glamping ${dataApp.glamping[index].kode} berhasil disimpan!`);
    }
    
    // Simpan semua pengaturan harga glamping
    function simpanPengaturanHargaGlamping() {
        dataApp.glamping.forEach((glamping, index) => {
            simpanHargaGlamping(index);
        });
        
        alert('Semua harga glamping berhasil disimpan!');
    }
    
    // Generate pengaturan barang
    function generatePengaturanBarang() {
        const tbody = document.getElementById('pengaturan-barang');
        tbody.innerHTML = '';
        
        dataApp.barangSewa.forEach((barang, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="form-control" id="nama-barang-${index}" value="${barang.nama}"></td>
                <td><input type="number" class="form-control" id="harga-barang-${index}" value="${barang.harga}" min="0"></td>
                <td><input type="text" class="form-control" id="satuan-barang-${index}" value="${barang.satuan}"></td>
                <td><input type="number" class="form-control" id="stok-barang-${index}" value="${barang.stok}" min="0"></td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="simpanBarang(${index})">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="hapusBarang(${index})">
                        <i class="fas fa-trash"></i> Hapus
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // Simpan barang
    function simpanBarang(index) {
        const nama = document.getElementById(`nama-barang-${index}`).value;
        const harga = parseInt(document.getElementById(`harga-barang-${index}`).value);
        const satuan = document.getElementById(`satuan-barang-${index}`).value;
        const stok = parseInt(document.getElementById(`stok-barang-${index}`).value);
        
        // Update data
        dataApp.barangSewa[index].nama = nama;
        dataApp.barangSewa[index].harga = harga;
        dataApp.barangSewa[index].satuan = satuan;
        dataApp.barangSewa[index].stok = stok;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        alert(`Barang ${nama} berhasil disimpan!`);
    }
    
    // Hapus barang
    function hapusBarang(index) {
        if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
            dataApp.barangSewa.splice(index, 1);
            generatePengaturanBarang();
            
            // Simpan ke localStorage
            saveToLocalStorage();
            
            alert('Barang berhasil dihapus!');
        }
    }
    
    // Tambah barang baru
    function tambahBarang() {
        dataApp.barangSewa.push({
            id: dataApp.barangSewa.length + 1,
            nama: "Barang Baru",
            harga: 0,
            satuan: "pcs",
            stok: 0
        });
        
        generatePengaturanBarang();
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        alert('Barang baru telah ditambahkan!');
    }
    
    // Simpan pengaturan perusahaan
    function simpanPengaturanPerusahaan() {
        dataApp.pengaturan.perusahaan.nama = document.getElementById('nama-perusahaan').value;
        dataApp.pengaturan.perusahaan.alamat = document.getElementById('alamat-perusahaan').value;
        dataApp.pengaturan.perusahaan.telepon = document.getElementById('telepon-perusahaan').value;
        dataApp.pengaturan.perusahaan.email = document.getElementById('email-perusahaan').value;
        dataApp.pengaturan.perusahaan.website = document.getElementById('website-perusahaan').value;
        dataApp.pengaturan.perusahaan.hargaTiket = parseInt(document.getElementById('harga-tiket').value);
        dataApp.pengaturan.perusahaan.bank = document.getElementById('bank-perusahaan').value;
        dataApp.pengaturan.perusahaan.norek = document.getElementById('norek-perusahaan').value;
        dataApp.pengaturan.perusahaan.anRekening = document.getElementById('an-rekening').value;
        dataApp.pengaturan.perusahaan.namaPemandu = document.getElementById('nama-pemandu').value;
        dataApp.pengaturan.perusahaan.noLayanan = document.getElementById('no-layanan').value;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        // Update footer
        updateFooterInfo();
        
        alert('Pengaturan perusahaan berhasil disimpan!');
    }
    
    // Simpan pengaturan waktu
    function simpanPengaturanWaktu() {
        dataApp.pengaturan.jamCheckin = document.getElementById('checkin-time').value;
        dataApp.pengaturan.jamCheckout = document.getElementById('checkout-time').value;
        dataApp.pengaturan.jamOperasionalStart = document.getElementById('operational-start').value;
        dataApp.pengaturan.jamOperasionalEnd = document.getElementById('operational-end').value;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        // Update footer
        updateFooterInfo();
        
        alert('Pengaturan waktu berhasil disimpan!');
    }
    
    // Simpan pengaturan aturan
    function simpanPengaturanAturan() {
        dataApp.pengaturan.maxLapakPerReservasi = parseInt(document.getElementById('max-lapak-reservasi').value);
        dataApp.pengaturan.minReservasiHari = parseInt(document.getElementById('min-reservasi-hari').value);
        dataApp.pengaturan.maxReservasiHari = parseInt(document.getElementById('max-reservasi-hari').value);
        dataApp.pengaturan.dendaKeterlambatan = parseInt(document.getElementById('denda-keterlambatan').value);
        dataApp.pengaturan.dpPercentage = parseInt(document.getElementById('dp-percentage').value);
        
        // Update info max lapak
        document.getElementById('max-lapak-info').textContent = dataApp.pengaturan.maxLapakPerReservasi;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        alert('Pengaturan aturan berhasil disimpan!');
    }
    
    // Update footer info
    function updateFooterInfo() {
        document.getElementById('footer-nama-perusahaan').textContent = dataApp.pengaturan.perusahaan.nama;
        document.getElementById('footer-deskripsi-perusahaan').textContent = "Sistem Reservasi Kemah Keluarga yang tertib, transparan, dan ramah keluarga.";
        document.getElementById('footer-alamat').textContent = dataApp.pengaturan.perusahaan.alamat;
        document.getElementById('footer-telepon').textContent = dataApp.pengaturan.perusahaan.telepon;
        document.getElementById('footer-jam-buka').textContent = dataApp.pengaturan.jamOperasionalStart;
        document.getElementById('footer-jam-tutup').textContent = dataApp.pengaturan.jamOperasionalEnd;
        document.getElementById('footer-checkin').textContent = dataApp.pengaturan.jamCheckin;
        document.getElementById('footer-checkout').textContent = dataApp.pengaturan.jamCheckout;
        document.getElementById('copyright-nama').textContent = dataApp.pengaturan.perusahaan.nama;
        document.getElementById('footer-bank').textContent = dataApp.pengaturan.perusahaan.bank;
        document.getElementById('footer-norek').textContent = dataApp.pengaturan.perusahaan.norek;
        document.getElementById('footer-an-rekening').textContent = dataApp.pengaturan.perusahaan.anRekening;
        document.getElementById('footer-layanan').textContent = dataApp.pengaturan.perusahaan.noLayanan;
        document.getElementById('footer-pemandu').textContent = dataApp.pengaturan.perusahaan.namaPemandu;
    }
    
    // Load invoice options untuk sewa barang
    function loadInvoiceOptions() {
        const select = document.getElementById('invoice-sewa-barang');
        select.innerHTML = '<option value="">Pilih Invoice</option>';
        
        dataApp.invoice.forEach(inv => {
            const option = document.createElement('option');
            option.value = inv.invoice;
            option.textContent = `${inv.invoice} - ${inv.nama} (${inv.jenis === 'tenda' ? 'Lapak Tenda' : 'Glamping'})`;
            select.appendChild(option);
        });
    }
    
    // Load data sewa barang berdasarkan invoice
    function loadDataSewaBarang() {
        const invoiceNumber = document.getElementById('invoice-sewa-barang').value;
        if (!invoiceNumber) return;
        
        const invoice = dataApp.invoice.find(inv => inv.invoice === invoiceNumber);
        if (!invoice) return;
        
        // Set jumlah hari sewa default ke jumlah malam reservasi
        document.getElementById('jumlah-hari-sewa').value = invoice.jumlahMalam;
        
        // Generate tabel barang sewa
        const tbody = document.getElementById('barang-sewa-list');
        tbody.innerHTML = '';
        
        dataApp.barangSewa.forEach((barang, index) => {
            // Cek jumlah barang yang sudah disewa di invoice ini
            let jumlahDisewa = 0;
            const barangInvoice = invoice.barangSewa.find(b => b.id === barang.id);
            if (barangInvoice) {
                jumlahDisewa = barangInvoice.jumlah;
            }
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${barang.nama}</td>
                <td>${formatRupiah(barang.harga)}</td>
                <td>${barang.stok}</td>
                <td>
                    <input type="number" class="form-control" id="jumlah-barang-invoice-${index}" 
                           value="${jumlahDisewa}" min="0" max="${barang.stok}" 
                           style="width: 80px;" onchange="hitungTotalSewaBarang()">
                </td>
                <td id="subtotal-barang-invoice-${index}">${formatRupiah(jumlahDisewa * barang.harga * invoice.jumlahMalam)}</td>
            `;
            tbody.appendChild(row);
        });
        
        hitungTotalSewaBarang();
    }
    
    // PERBAIKAN: Hitung total sewa barang dengan menggunakan jumlah hari yang dipilih
    function hitungTotalSewaBarang() {
        const invoiceNumber = document.getElementById('invoice-sewa-barang').value;
        if (!invoiceNumber) return;
        
        const invoice = dataApp.invoice.find(inv => inv.invoice === invoiceNumber);
        if (!invoice) return;
        
        const jumlahHari = parseInt(document.getElementById('jumlah-hari-sewa').value) || invoice.jumlahMalam;
        let total = 0;
        
        dataApp.barangSewa.forEach((barang, index) => {
            const jumlah = parseInt(document.getElementById(`jumlah-barang-invoice-${index}`).value) || 0;
            const subtotal = jumlah * barang.harga * jumlahHari; // PERBAIKAN: menggunakan jumlahHari, bukan invoice.jumlahMalam
            total += subtotal;
            
            // Update subtotal
            document.getElementById(`subtotal-barang-invoice-${index}`).textContent = formatRupiah(subtotal);
        });
        
        document.getElementById('total-biaya-sewa-barang').textContent = formatRupiah(total);
    }
    
    // PERBAIKAN: Simpan sewa barang dengan perhitungan yang benar
    function simpanSewaBarang() {
        const invoiceNumber = document.getElementById('invoice-sewa-barang').value;
        if (!invoiceNumber) {
            alert('Pilih invoice terlebih dahulu!');
            return;
        }
        
        const invoice = dataApp.invoice.find(inv => inv.invoice === invoiceNumber);
        if (!invoice) return;
        
        const jumlahHari = parseInt(document.getElementById('jumlah-hari-sewa').value) || invoice.jumlahMalam;
        
        // Kumpulkan barang yang disewa
        const barangSewaDipilih = [];
        let totalBiayaSewaBarang = 0;
        
        dataApp.barangSewa.forEach((barang, index) => {
            const jumlah = parseInt(document.getElementById(`jumlah-barang-invoice-${index}`).value) || 0;
            if (jumlah > 0) {
                const subtotal = jumlah * barang.harga * jumlahHari;
                totalBiayaSewaBarang += subtotal;
                
                barangSewaDipilih.push({
                    id: barang.id,
                    nama: barang.nama,
                    harga: barang.harga,
                    jumlah: jumlah,
                    subtotal: subtotal
                });
                
                // Kurangi stok
                barang.stok -= jumlah;
            }
        });
        
        // PERBAIKAN: Update invoice dengan benar
        // Hapus barang sewa lama jika ada
        invoice.barangSewa = barangSewaDipilih;
        
        // Hitung total biaya baru (akomodasi + tiket + barang sewa baru)
        const totalAkomodasiTiket = invoice.totalBiaya - invoice.barangSewa.reduce((sum, barang) => sum + (barang.subtotal || 0), 0);
        invoice.totalBiaya = totalAkomodasiTiket + totalBiayaSewaBarang;
        
        // Update DP berdasarkan total baru
        invoice.dp = invoice.totalBiaya * (dataApp.pengaturan.dpPercentage / 100);
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        // Update tampilan
        generatePengaturanBarang();
        generateInvoiceList();
        loadInvoiceOptions();
        
        alert(`Sewa barang berhasil disimpan untuk invoice ${invoiceNumber}!`);
    }
    
    // Generate users list
    function generateUsersList() {
        const tbody = document.getElementById('users-list');
        tbody.innerHTML = '';
        
        dataApp.users.forEach(user => {
            const row = document.createElement('tr');
            
            // Role badge
            let roleBadge = '';
            if (user.role === 'admin') {
                roleBadge = '<span class="badge badge-admin">Admin</span>';
            } else if (user.role === 'manager') {
                roleBadge = '<span class="badge badge-manager">Manager</span>';
            } else {
                roleBadge = '<span class="badge badge-staff">Staff</span>';
            }
            
            // Status badge
            const statusBadge = user.active ? 
                '<span class="badge badge-success">Aktif</span>' : 
                '<span class="badge badge-danger">Nonaktif</span>';
            
            row.innerHTML = `
                <td>${user.username}</td>
                <td>${user.nama}</td>
                <td>${roleBadge}</td>
                <td>${user.createdAt}</td>
                <td>${statusBadge}</td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="editUserModal(${user.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    ${user.username !== 'admin' ? `
                    <button class="btn btn-danger btn-sm" onclick="hapusUser(${user.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                    ` : ''}
                </td>
            `;
            
            tbody.appendChild(row);
        });
    }
    
    // Tambah user modal
    function tambahUserModal() {
        document.getElementById('user-modal-title').textContent = 'Tambah Pengguna Baru';
        
        document.getElementById('user-modal-body').innerHTML = `
            <form id="form-user">
                <div class="form-group">
                    <label for="new-username">Username</label>
                    <input type="text" id="new-username" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="new-password">Password</label>
                    <input type="password" id="new-password" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="new-nama">Nama Lengkap</label>
                    <input type="text" id="new-nama" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="new-role">Role</label>
                    <select id="new-role" class="form-control">
                        <option value="staff">Staff</option>
                        <option value="manager">Manager</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="new-status">Status</label>
                    <select id="new-status" class="form-control">
                        <option value="true">Aktif</option>
                        <option value="false">Nonaktif</option>
                    </select>
                </div>
                
                <div class="text-right mt-3">
                    <button type="button" class="btn btn-primary" onclick="simpanUser()">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        `;
        
        document.getElementById('user-modal').style.display = 'flex';
    }
    
    // Edit user modal
    function editUserModal(userId) {
        const user = dataApp.users.find(u => u.id === userId);
        if (!user) return;
        
        document.getElementById('user-modal-title').textContent = 'Edit Pengguna';
        
        document.getElementById('user-modal-body').innerHTML = `
            <form id="form-user">
                <div class="form-group">
                    <label for="edit-username">Username</label>
                    <input type="text" id="edit-username" class="form-control" value="${user.username}" required ${user.username === 'admin' ? 'readonly' : ''}>
                </div>
                
                <div class="form-group">
                    <label for="edit-password">Password (Kosongkan jika tidak ingin mengubah)</label>
                    <input type="password" id="edit-password" class="form-control" placeholder="Masukkan password baru">
                </div>
                
                <div class="form-group">
                    <label for="edit-nama">Nama Lengkap</label>
                    <input type="text" id="edit-nama" class="form-control" value="${user.nama}" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-role">Role</label>
                    <select id="edit-role" class="form-control" ${user.username === 'admin' ? 'disabled' : ''}>
                        <option value="staff" ${user.role === 'staff' ? 'selected' : ''}>Staff</option>
                        <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>Manager</option>
                        <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-status">Status</label>
                    <select id="edit-status" class="form-control" ${user.username === 'admin' ? 'disabled' : ''}>
                        <option value="true" ${user.active ? 'selected' : ''}>Aktif</option>
                        <option value="false" ${!user.active ? 'selected' : ''}>Nonaktif</option>
                    </select>
                </div>
                
                <div class="text-right mt-3">
                    <button type="button" class="btn btn-primary" onclick="updateUser(${user.id})">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        `;
        
        document.getElementById('user-modal').style.display = 'flex';
    }
    
    // Simpan user baru
    function simpanUser() {
        const username = document.getElementById('new-username').value;
        const password = document.getElementById('new-password').value;
        const nama = document.getElementById('new-nama').value;
        const role = document.getElementById('new-role').value;
        const active = document.getElementById('new-status').value === 'true';
        
        // Validasi
        if (!username || !password || !nama) {
            alert('Harap lengkapi semua field yang wajib diisi!');
            return;
        }
        
        // Cek jika username sudah ada
        if (dataApp.users.find(u => u.username === username)) {
            alert('Username sudah digunakan!');
            return;
        }
        
        // Tambahkan user
        const newUser = {
            id: dataApp.users.length > 0 ? Math.max(...dataApp.users.map(u => u.id)) + 1 : 1,
            username,
            password,
            nama,
            role,
            active,
            createdAt: formatDate(new Date())
        };
        
        dataApp.users.push(newUser);
        saveToLocalStorage();
        generateUsersList();
        closeUserModal();
        
        alert('User berhasil ditambahkan!');
    }
    
    // Update user
    function updateUser(userId) {
        const user = dataApp.users.find(u => u.id === userId);
        if (!user) return;
        
        const username = document.getElementById('edit-username').value;
        const password = document.getElementById('edit-password').value;
        const nama = document.getElementById('edit-nama').value;
        const role = document.getElementById('edit-role').value;
        const active = document.getElementById('edit-status').value === 'true';
        
        // Validasi
        if (!username || !nama) {
            alert('Harap lengkapi semua field yang wajib diisi!');
            return;
        }
        
        // Cek jika username sudah ada (kecuali user yang sedang diedit)
        const existingUser = dataApp.users.find(u => u.username === username && u.id !== userId);
        if (existingUser) {
            alert('Username sudah digunakan!');
            return;
        }
        
        // Update user
        user.username = username;
        if (password) {
            user.password = password;
        }
        user.nama = nama;
        user.role = role;
        user.active = active;
        
        // Simpan ke localStorage
        saveToLocalStorage();
        
        // Update current user jika yang diedit adalah user yang sedang login
        if (dataApp.user && dataApp.user.username === user.username) {
            dataApp.user.nama = user.nama;
            dataApp.user.role = user.role;
            updateUIByRole();
        }
        
        generateUsersList();
        closeUserModal();
        
        alert('User berhasil diperbarui!');
    }
    
    // Hapus user
    function hapusUser(userId) {
        const user = dataApp.users.find(u => u.id === userId);
        if (!user) return;
        
        if (user.username === 'admin') {
            alert('User admin tidak dapat dihapus!');
            return;
        }
        
        if (!confirm(`Apakah Anda yakin ingin menghapus user ${user.username}?`)) {
            return;
        }
        
        const index = dataApp.users.findIndex(u => u.id === userId);
        if (index !== -1) {
            dataApp.users.splice(index, 1);
            saveToLocalStorage();
            generateUsersList();
            alert('User berhasil dihapus!');
        }
    }
    
    // Tutup modal user
    function closeUserModal() {
        document.getElementById('user-modal').style.display = 'none';
    }
    
    // Login function
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('login-error');
        
        // Cek kredensial dari dataApp.users
        const user = dataApp.users.find(u => u.username === username && u.password === password && u.active);
        
        if (user) {
            dataApp.user = { 
                username: user.username, 
                role: user.role, 
                nama: user.nama,
                id: user.id
            };
            
            // Simpan session
            localStorage.setItem('camping_user', JSON.stringify(dataApp.user));
            
            // Sembunyikan login, tampilkan aplikasi
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // Set user info
            document.getElementById('current-user').textContent = user.nama;
            document.getElementById('user-role').textContent = user.role.toUpperCase();
            
            // Inisialisasi aplikasi
            initData();
        } else {
            errorDiv.classList.remove('hidden');
        }
    }
    
    // Logout function
    function logout() {
        if (confirm('Apakah Anda yakin ingin logout?')) {
            // Hapus session user saja, data tetap tersimpan
            localStorage.removeItem('camping_user');
            
            // Reset aplikasi
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('login-form').reset();
            document.getElementById('login-error').classList.add('hidden');
            
            // Reset data user saja, data lainnya tetap
            dataApp.user = null;
        }
    }
    
    // Check login status
    function checkLogin() {
        const userData = localStorage.getItem('camping_user');
        if (userData) {
            dataApp.user = JSON.parse(userData);
            
            // Sembunyikan login, tampilkan aplikasi
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            
            // Set user info
            document.getElementById('current-user').textContent = dataApp.user.nama;
            document.getElementById('user-role').textContent = dataApp.user.role.toUpperCase();
            
            // Inisialisasi aplikasi
            initData();
            return true;
        }
        return false;
    }
    
    // Save data to localStorage
    function saveToLocalStorage() {
        localStorage.setItem('camping_data', JSON.stringify({
            lapakTenda: dataApp.lapakTenda,
            glamping: dataApp.glamping,
            barangSewa: dataApp.barangSewa,
            reservasi: dataApp.reservasi,
            invoice: dataApp.invoice,
            pengaturan: dataApp.pengaturan,
            laporan: dataApp.laporan,
            users: dataApp.users
        }));
    }
    
    // Load data from localStorage
    function loadFromLocalStorage() {
        const savedData = localStorage.getItem('camping_data');
        if (savedData) {
            const parsedData = JSON.parse(savedData);
            dataApp.lapakTenda = parsedData.lapakTenda || [];
            dataApp.glamping = parsedData.glamping || [];
            dataApp.barangSewa = parsedData.barangSewa || [];
            dataApp.reservasi = parsedData.reservasi || [];
            dataApp.invoice = parsedData.invoice || [];
            dataApp.pengaturan = parsedData.pengaturan || dataApp.pengaturan;
            dataApp.laporan = parsedData.laporan || [];
            dataApp.users = parsedData.users || dataApp.users;
        }
    }
    
    // Tampilkan modal loading
    function showLoadingModal() {
        document.getElementById('loading-modal').style.display = 'flex';
    }
    
    // Sembunyikan modal loading
    function hideLoadingModal() {
        document.getElementById('loading-modal').style.display = 'none';
    }
    
    // Inisialisasi aplikasi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
        // Cek status login
        if (!checkLogin()) {
            // Jika belum login, tampilkan login screen
            document.getElementById('login-screen').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
        }
        
        // Event listener untuk tab periode laporan
        document.getElementById('periode-laporan').addEventListener('change', toggleTanggalKustom);
        
        // Set tanggal default untuk laporan
        const today = new Date();
        document.getElementById('tanggal-mulai').value = formatDate(new Date(today.getFullYear(), today.getMonth(), 1));
        document.getElementById('tanggal-selesai').value = formatDate(today);
        
        // Tutup modal saat klik di luar modal
        window.onclick = function(event) {
            const invoiceModal = document.getElementById('invoice-modal');
            if (event.target === invoiceModal) {
                closeInvoiceModal();
            }
            
            const userModal = document.getElementById('user-modal');
            if (event.target === userModal) {
                closeUserModal();
            }
            
            const loadingModal = document.getElementById('loading-modal');
            if (event.target === loadingModal) {
                hideLoadingModal();
            }
        };
        
        // Prevent form submission on enter
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName === 'INPUT' && e.target.type !== 'button' && e.target.type !== 'submit') {
                e.preventDefault();
            }
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
            const nav = document.getElementById('main-nav');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (nav.classList.contains('active') && 
                !nav.contains(e.target) && 
                !menuToggle.contains(e.target)) {
                nav.classList.remove('active');
            }
        });
    });
</script>
</body>
</html>